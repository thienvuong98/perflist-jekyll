<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>NameError at &#x2F;playlist&#x2F;singer&#x2F;thien</title>

  <script type="text/javascript">
  //<!--
  function toggle(id) {
    var pre  = document.getElementById("pre-" + id);
    var post = document.getElementById("post-" + id);
    var context = document.getElementById("context-" + id);

    if (pre.style.display == 'block') {
      pre.style.display = 'none';
      post.style.display = 'none';
      context.style.background = "none";
    } else {
      pre.style.display = 'block';
      post.style.display = 'block';
      context.style.background = "#fffed9";
    }
  }

  function toggleBacktrace(){
    var bt = document.getElementById("backtrace");
    var toggler = document.getElementById("expando");

    if (bt.className == 'condensed') {
      bt.className = 'expanded';
      toggler.innerHTML = "(condense)";
    } else {
      bt.className = 'condensed';
      toggler.innerHTML = "(expand)";
    }
  }
  //-->
  </script>

<style type="text/css" media="screen">
  *                   {margin: 0; padding: 0; border: 0; outline: 0;}
  div.clear           {clear: both;}
  body                {background: #EEEEEE; margin: 0; padding: 0;
                       font-family: 'Lucida Grande', 'Lucida Sans Unicode',
                       'Garuda';}
  code                {font-family: 'Lucida Console', monospace;
                       font-size: 12px;}
  li                  {height: 18px;}
  ul                  {list-style: none; margin: 0; padding: 0;}
  ol:hover            {cursor: pointer;}
  ol li               {white-space: pre;}
  #explanation        {font-size: 12px; color: #666666;
                       margin: 20px 0 0 100px;}
/* WRAP */
  #wrap               {width: 1000px; background: #FFFFFF; margin: 0 auto;
                       padding: 30px 50px 20px 50px;
                       border-left: 1px solid #DDDDDD;
                       border-right: 1px solid #DDDDDD;}
/* HEADER */
  #header             {margin: 0 auto 25px auto;}
  #header img         {float: left;}
  #header #summary    {float: left; margin: 12px 0 0 20px; width:660px;
                       font-family: 'Lucida Grande', 'Lucida Sans Unicode';}
  h1                  {margin: 0; font-size: 36px; color: #981919;}
  h2                  {margin: 0; font-size: 22px; color: #333333;}
  #header ul          {margin: 0; font-size: 12px; color: #666666;}
  #header ul li strong{color: #444444;}
  #header ul li       {display: inline; padding: 0 10px;}
  #header ul li.first {padding-left: 0;}
  #header ul li.last  {border: 0; padding-right: 0;}
/* BODY */
  #backtrace,
  #get,
  #post,
  #cookies,
  #rack               {width: 980px; margin: 0 auto 10px auto;}
  p#nav               {float: right; font-size: 14px;}
/* BACKTRACE */
  a#expando           {float: left; padding-left: 5px; color: #666666;
                      font-size: 14px; text-decoration: none; cursor: pointer;}
  a#expando:hover     {text-decoration: underline;}
  h3                  {float: left; width: 100px; margin-bottom: 10px;
                       color: #981919; font-size: 14px; font-weight: bold;}
  #nav a              {color: #666666; text-decoration: none; padding: 0 5px;}
  #backtrace li.frame-info {background: #f7f7f7; padding-left: 10px;
                           font-size: 12px; color: #333333;}
  #backtrace ul       {list-style-position: outside; border: 1px solid #E9E9E9;
                       border-bottom: 0;}
  #backtrace ol       {width: 920px; margin-left: 50px;
                       font: 10px 'Lucida Console', monospace; color: #666666;}
  #backtrace ol li    {border: 0; border-left: 1px solid #E9E9E9;
                       padding: 2px 0;}
  #backtrace ol code  {font-size: 10px; color: #555555; padding-left: 5px;}
  #backtrace-ul li    {border-bottom: 1px solid #E9E9E9; height: auto;
                       padding: 3px 0;}
  #backtrace-ul .code {padding: 6px 0 4px 0;}
  #backtrace.condensed .system,
  #backtrace.condensed .framework {display:none;}
/* REQUEST DATA */
  p.no-data           {padding-top: 2px; font-size: 12px; color: #666666;}
  table.req           {width: 980px; text-align: left; font-size: 12px;
                       color: #666666; padding: 0; border-spacing: 0;
                       border: 1px solid #EEEEEE; border-bottom: 0;
                       border-left: 0;
                       clear:both}
  table.req tr th     {padding: 2px 10px; font-weight: bold;
                       background: #F7F7F7; border-bottom: 1px solid #EEEEEE;
                       border-left: 1px solid #EEEEEE;}
  table.req tr td     {padding: 2px 20px 2px 10px;
                       border-bottom: 1px solid #EEEEEE;
                       border-left: 1px solid #EEEEEE;}
/* HIDE PRE/POST CODE AT START */
  .pre-context,
  .post-context       {display: none;}

  table td.code       {width:750px}
  table td.code div   {width:750px;overflow:hidden}
</style>
</head>
<body>
  <div id="wrap">
    <div id="header">
      <img src="/playlist/__sinatra__/500.png" alt="application error" height="161" width="313" />
      <div id="summary">
        <h1><strong>NameError</strong> at <strong>&#x2F;playlist&#x2F;singer&#x2F;thien
          </strong></h1>
        <h2>undefined local variable or method `qrcode&#x27; for #&lt;PlaylistPortal:0x00007f37b5001380 @current_engine=:ruby, @default_layout=:layout, @preferred_extension=&quot;slim&quot;, @app=nil, @template_cache=#&lt;Sinatra::TemplateCache:0x00007f37b5a22148 @cache={[:slim, :program, {:outvar=&gt;&quot;@_out_buf&quot;, :default_encoding=&gt;&quot;utf-8&quot;}, &quot;&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&quot;]=&gt;#&lt;Slim::Template:0x00007f37b4b69e30 @options={:outvar=&gt;&quot;@_out_buf&quot;}, @line=1, @file=&quot;&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;program.slim&quot;, @compiled_method={[PlaylistPortal, [:content, :extra, :playlists, :program, :range, :title, :type]]=&gt;#&lt;UnboundMethod: Tilt::CompiledTemplates#__tilt_17540(locals) &#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;program.slim:-8&gt;}, @default_encoding=&quot;utf-8&quot;, @skip_compiled_encoding_detection=nil, @data=&quot;&#x2F;! ============================================================ \n&#x2F;! Generates program &#x2F; practice content page\n&#x2F;! ============================================================ \n\n- content_for :css do\n  css:\n    a:link {\n      text-decoration: none;\n    }\n    .loopstyle {\n      font-size: 70%;\n    }\n    .transpose {\n      font-size:        90%;\n      background-color: #ccc;\n      padding-left:     4px;\n      padding-right:    4px;\n    }\n    #list-select {\n      position: absolute;\n      top:      10;\n      right:    10;\n      width:  150;\n    }\n    #youtube {\n      border:   1px solid #aaa;\n      display:  none;\n      z-index:  9999;\n      position: fixed;\n      top:      0;\n      left:     0;\n    }\n    .hidden {\n      color:     #fff;\n      font-size: 10%;\n    }\n    .qrcode svg {\n    }\n\n&#x2F;! Select different playlist\n- ltype = params[:type] || content[:type] || &#x27;list&#x27;\n\n&#x2F;! Video player - hidden until brought up\n- locals = {id: &#x27;youtube&#x27;, width:250, height: 140}\n== partial :_pl_player, locals: locals, template_engine: :slim\n\n&#x2F;! Allow language accent, etc \n- locals = {id: &#x27;lybox&#x27;, ltype: ltype}\n== partial :_lyric_box, locals: locals, template_engine: :slim\n\n.row\n  .col-md-8\n    h2\n      = content[:title]\n    h5\n      a href=content[:source] target=&#x27;sheet&#x27;\n        = \&quot;\#{content[:location]}  - \#{content[:date]}\&quot;\n    - if content[:links]\n      .mark.small\n        - content[:links].each do |name, value|\n          a href=value target=name =name.capitalize\n  .col-md-4\n    select.form-select#list-select onchange=\&quot;window.location.href = &#x27;..&#x2F;\#{ltype}&#x2F;&#x27; + this.options[this.selectedIndex].value\&quot;\n      - playlists.each do |item|\n        option value=item selected=(item == program) = item\n\n.row\n  .col-lg-12\n\n    - ismobile = (params[:static] != nil)\n    table.cell-border.compact.display.dt-responsive#main_table width=\&quot;100%\&quot;\n      thead\n        tr\n          th S-Title\n          th No.\n          th Key.Tr\n          th Title\n          th= ltype == \&quot;list\&quot; ? \&quot;Singer [Backup]\&quot; : \&quot;List\&quot;\n          th Beat [Tempo]\n          th Perf Video&#x2F;Loops\n          th Note\n          th\n      tbody\n        - async = params[:static] ? &#x27;false&#x27; : &#x27;true&#x27;\n        - content[:__list].reject{|r| r[:disable]}.each_with_index do |e, index|\n          tr\n            - perf_url = e[:perf_url] || &#x27;&#x27;\n            - yt_video = nil\n            - tempo = e[:perf_tempo] || e[:tempo]\n            td\n              = e[:stitle]\n            td= index+2\n            td\n              .d-grid.gap-2\n                - if (le = extra[index]) &amp;&amp; le[:lyric] &amp;&amp; !le[:lyric].empty?\n                  - color = tempo_color(tempo)\n                  button.btn.btn-sm.btn-outline-secondary.mtooltip style=\&quot;background-color:\#{color}\&quot; onClick=\&quot;get_lyric(&#x27;\#{program}&#x27;, \#{index + range[0]}, \#{async})\&quot; title=\&quot;Lyric for: \#{e[:title]}, tempo: \#{tempo}\&quot;\n                    b= (e[:key] &amp;&amp; !e[:key].empty?) ? e[:key] : &#x27;?&#x27;\n                    - if e[:transpose]\n                      span.transpose title=\&quot;Transpose\&quot; = e[:transpose]\n                    span.= e[:lead] ? \&quot; (\#{e[:lead]})\&quot; : \&quot;\&quot;\n                - else\n                  = (e[:key] &amp;&amp; !e[:key].empty?) ? e[:key] : &#x27;?&#x27;\n                  - if e[:transpose]\n                    span.transpose title=\&quot;Transpose\&quot; = e[:transpose]\n            td\n              = e[:continue] ? \&quot;++\&quot; : \&quot;\&quot;\n              - if e[:play_url]\n                - if ismobile\n                  a href=e[:play_url] title=\&quot;Source lyrics\&quot;= e[:title]\n                - else\n                  a href=e[:play_url] target=&#x27;Play&#x27; title=\&quot;Source lyrics\&quot;= e[:title]\n              - else\n                = e[:title]\n              - if e[:note] &amp;&amp; !(@isIPhone || @isIPad)\n                = \&quot; (\#{e[:note][0..9]})\&quot;\n              - if e[:has_style]\n                | &amp;nbsp;\n                i.fa.fa-guitar\n            td\n              - if ltype == \&quot;list\&quot;\n                - singer = capwords(to_stitle(e[:singer]))\n                - unless singer.empty?\n                  button.btn onClick=\&quot;return dt_search(&#x27;\#{singer}&#x27;)\&quot; \n                    = \&quot;\#{singer}\&quot; + (e[:backup] ? \&quot; [\#{e[:backup]}]\&quot; : \&quot;\&quot;)\n                  - if !(@isIPad || @isIPhone)\n                    a.chord href=\&quot;..&#x2F;singer&#x2F;\#{singer.downcase}\&quot; Singer\n              - else\n                - list = e[:singer]\n                button.btn onClick=\&quot;return dt_search(&#x27;\#{singer}&#x27;)\&quot; = list\n                a.chord href=\&quot;..&#x2F;list&#x2F;\#{list}\&quot; List\n            td.dt-right\n              button.btn onClick=\&quot;return dt_search(&#x27;\#{e[:beat]}&#x27;)\&quot; = e[:beat]\n              - if tempo &amp;&amp; !(@iPhone || @iPad)\n                span.transpose.text-right title=\&quot;Tempo\&quot;= tempo\n            td\n              - perf_url = e[:perf_url] || &#x27;&#x27;\n              - if (yt_video = extract_yt_video(perf_url))\n                - title = e[:title].gsub(&#x2F;&#x27;&#x2F;, &#x27;&#x27;)\n                button.btn.btn-sm.mtooltip title=\&quot;Play Video\&quot; onClick=\&quot;return play_on_youtube(&#x27;\#{yt_video}&#x27;, &#x27;\#{title}&#x27;, 0, 0)\&quot;\n                  i.fa-solid.fa-video\n                - (e[:perf_loop] || []).each do |els|\n                    - el = els.split(\&quot;-\&quot;).map{|f| f.to_i}\n                    button.btn.btn-sm.mtooltip onClick=\&quot;return play_on_youtube(&#x27;\#{yt_video}&#x27;, &#x27;\#{title}&#x27;, \#{el[0]}, \#{el[1]})\&quot; title=\&quot;Play loops\&quot;\n                      i.fa-solid.fa-undo\n                      div.loopstyle= \&quot;\#{el[0]}.\#{el[1]-el[0]}\&quot;\n              - elsif perf_url.start_with?(&#x27;https:&#x2F;&#x2F;&#x27;)\n                a href=perf_url target=&#x27;Listen (not embed)&#x27; Link\n              - else\n                = perf_url\n            td= e[:note] || e[:perf_note]\n            td\n              .hidden= index\n\n    button.btn.btn-sm.btn-outline-secondary onClick=\&quot;reset_order()\&quot; Reset Order \n    - unless params[:static]\n      button.btn.btn-sm.btn-outline-secondary onClick=\&quot;sv_save_order()\&quot; Save to Server\n\n.qrcode== qrcode\n\nscript\n  == \&quot;extra = \&quot; + extra.to_json\n\n- content_for :javascript do\n  script src=\&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;iframe_api\&quot;\n  javascript:\n\n    var main_table;\n    var myModal;\n\n    $(function() {\n\n      $(&#x27;.mtooltip&#x27;).tooltip()\n\n      main_table = new DataTable(&#x27;#main_table&#x27;, {\n        layout: {\n          topStart:    &#x27;search&#x27;,\n          bottomStart: &#x27;info&#x27;,\n        },\n        search: {\n          search: &#x27;\#{params[:search]}&#x27;,\n          caseInsensitive: true,\n        },\n        responsive: true,\n        paging:     false,\n        columns: [null, {data: &#x27;id&#x27;}, null, {data: &#x27;title&#x27;},\n                  null, null, null, null],\n        order:  [[ 1, \&quot;asc\&quot; ]],\n        columnDefs: [\n          { target: 0, visible: false, searchable: true },\n          { target: 2, visible: true,  searchable: false },\n          { target: 7, visible: false, searchable: true },\n          { target: 8, visible: true,  searchable: false },\n        ],\n        rowReorder: {\n          dataSrc: &#x27;id&#x27;,\n        },\n        initComplete: function(settings, json) {\n          var newkey  = &#x27;&#x27;\n          for (let value of $(&#x27;#main_table tbody tr&#x27;)) {\n            newkey += value.childNodes[4].innerText.replace(&#x2F;[\\(\\) ]&#x2F;g, \&quot;\&quot;)\n          }\n          let curkey = localStorage.getItem(&#x27;pagekey.\#{program}&#x27;)\n          &#x2F;&#x2F; console.log(`\#{program} curkey: ${curkey}`)\n          &#x2F;&#x2F; console.log(`\#{program} newkey: ${newkey}`)\n          localStorage.setItem(\&quot;pagekey.\#{program}\&quot;, newkey)\n          if (curkey == newkey) {\n            restore_order()\n          }\n        }\n      });\n\n      main_table.on(&#x27;row-reorder&#x27;, (e, diff, edit) =&gt; {\n        setTimeout(() =&gt; { save_order() }, 100)\n      })\n\n      myModal  = new bootstrap.Modal(document.getElementById(&#x27;lybox&#x27;))\n    });\n\n    function reset_order() {\n      localStorage.removeItem(\&quot;pageorder.\#{program}\&quot;)\n      location.reload()\n    }\n\n    function current_order() {\n      var olist = []\n      for (value of $(&#x27;#main_table tbody tr&#x27;)) {\n        olist.push(value.childNodes[15].innerText)\n      }\n      return olist\n    }\n\n    &#x2F;&#x2F; Save order to localstore (per device only)\n    function save_order() {\n      var olist = current_order()\n      console.log(&#x27;new_list: &#x27;, olist)\n      localStorage.setItem(\&quot;pageorder.\#{program}\&quot;, JSON.stringify(olist))\n    }\n\n    &#x2F;&#x2F; Save order to server (so it could be shared)\n    function sv_save_order() {\n      var olist = current_order()\n      var url = `..&#x2F;reorder&#x2F;\#{program}&#x2F;${olist.join(&#x27;,&#x27;)}`\n      jQuery.ajax({\n        url:      url,\n        method:   &#x27;POST&#x27;,\n        async:    false,\n        dataType: &#x27;json&#x27;,\n        success:  location.reload(),\n      });\n    }\n\n    function restore_order() {\n      let item = localStorage.getItem(\&quot;pageorder.\#{program}\&quot;)\n      if (item == null) {\n        console.log(\&quot;No order to restore\&quot;)\n        return\n      }\n\n      let olist   = JSON.parse(item)\n      let dt_rows = $(&#x27;#main_table tbody tr&#x27;)\n      var offset  = 2\n      console.log(`Restore olist: ${olist}`)\n\n      for (rowno of olist) {\n        &#x2F;&#x2F; console.log(&#x27;rowno: &#x27;, rowno)\n        &#x2F;&#x2F; console.log(&#x27;dtrow: &#x27;, dt_rows[rowno])\n\n        if (dt_rows[rowno] == null) {\n          continue\n        }\n        let listno = dt_rows[rowno].childNodes[2].innerText\n        dt_rows[rowno].childNodes[2].innerText = offset\n        offset += 1\n      }\n\n      setTimeout(() =&gt; {\n        main_table.rows().invalidate().draw()\n      }, 100)\n    }\n&quot;, @src=&quot;begin; _temple_generators_stringbuffer1 = @_out_buf if defined?(@_out_buf); @_out_buf = &#x27;&#x27;.dup; _temple_html_pretty1 = &#x2F;&lt;code|&lt;pre|&lt;textarea&#x2F;; @_out_buf &lt;&lt; (\&quot;&lt;!--============================================================ --&gt;&lt;!--Generates program &#x2F; practice content page--&gt;&lt;!--============================================================ --&gt;\&quot;.freeze); \n; \n; \n; \n; content_for :css do; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;style&gt;\\n  a:link {\\n    text-decoration: none;\\n  }\\n  .loopstyle {\\n    font-size: 70%;\\n  }\\n  .transpose {\\n    font-size:        90%;\\n    background-color: #ccc;\\n    padding-left:     4px;\\n    padding-right:    4px;\\n  }\\n  #list-select {\\n    position: absolute;\\n    top:      10;\\n    right:    10;\\n    width:  150;\\n  }\\n  #youtube {\\n    border:   1px solid #aaa;\\n    display:  none;\\n    z-index:  9999;\\n    position: fixed;\\n    top:      0;\\n    left:     0;\\n  }\\n  .hidden {\\n    color:     #fff;\\n    font-size: 10%;\\n  }\\n  .qrcode svg {\\n  }\\n&lt;&#x2F;style&gt;\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; end; @_out_buf &lt;&lt; (\&quot;\\n&lt;!--Select different playlist--&gt;\&quot;.freeze); \n; ltype = params[:type] || content[:type] || &#x27;list&#x27;; \n; \n; @_out_buf &lt;&lt; (\&quot;&lt;!--Video player - hidden until brought up--&gt;\&quot;.freeze); \n; locals = {id: &#x27;youtube&#x27;, width:250, height: 140}; \n; @_out_buf &lt;&lt; ((::Temple::Utils.indent_dynamic((partial :_pl_player, locals: locals, template_engine: :slim), false, \&quot;\\n\&quot;, _temple_html_pretty1)).to_s); \n; \n; @_out_buf &lt;&lt; (\&quot;&lt;!--Allow language accent, etc --&gt;\&quot;.freeze); \n; locals = {id: &#x27;lybox&#x27;, ltype: ltype}; \n; @_out_buf &lt;&lt; ((::Temple::Utils.indent_dynamic((partial :_lyric_box, locals: locals, template_engine: :slim), false, \&quot;\\n\&quot;, _temple_html_pretty1)).to_s); \n; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;div class=\\\&quot;row\\\&quot;&gt;\\n  &lt;div class=\\\&quot;col-md-8\\\&quot;&gt;\\n    &lt;h2&gt;\&quot;.freeze); \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((content[:title]), true, \&quot;\\n      \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;\\n    &lt;&#x2F;h2&gt;\\n    &lt;h5&gt;\\n      &lt;a\&quot;.freeze); \n; _slim_codeattributes1 = content[:source]; if _slim_codeattributes1; if _slim_codeattributes1 == true; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes1))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot; target=\\\&quot;sheet\\\&quot;&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((\&quot;\#{content[:location]}  - \#{content[:date]}\&quot;), false, \&quot;\\n        \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;a&gt;\\n    &lt;&#x2F;h5&gt;\&quot;.freeze); if content[:links]; \n; @_out_buf &lt;&lt; (\&quot;\\n    &lt;div class=\\\&quot;mark small\\\&quot;&gt;\&quot;.freeze); \n; content[:links].each do |name, value|; \n; @_out_buf &lt;&lt; (\&quot;\\n      &lt;a\&quot;.freeze); _slim_codeattributes2 = value; if _slim_codeattributes2; if _slim_codeattributes2 == true; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes2))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; _slim_codeattributes3 = name; if _slim_codeattributes3; if _slim_codeattributes3 == true; @_out_buf &lt;&lt; (\&quot; target=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; target=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes3))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((name.capitalize), false, \&quot;\\n        \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;a&gt;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;\\n    &lt;&#x2F;div&gt;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;\\n  &lt;&#x2F;div&gt;\\n  &lt;div class=\\\&quot;col-md-4\\\&quot;&gt;\\n    &lt;select class=\\\&quot;form-select\\\&quot; id=\\\&quot;list-select\\\&quot; onchange=\\\&quot;window.location.href = &amp;#39;..&#x2F;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((ltype))).to_s); @_out_buf &lt;&lt; (\&quot;&#x2F;&amp;#39; + this.options[this.selectedIndex].value\\\&quot;&gt;\&quot;.freeze); \n; playlists.each do |item|; \n; @_out_buf &lt;&lt; (\&quot;\\n      &lt;option\&quot;.freeze); _slim_codeattributes4 = (item == program); if _slim_codeattributes4; if _slim_codeattributes4 == true; @_out_buf &lt;&lt; (\&quot; selected=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; selected=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes4))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; _slim_codeattributes5 = item; if _slim_codeattributes5; if _slim_codeattributes5 == true; @_out_buf &lt;&lt; (\&quot; value=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; value=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes5))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((item), true, \&quot;\\n        \&quot;, _temple_html_pretty1)))).to_s); \n; \n; @_out_buf &lt;&lt; (\&quot;\\n      &lt;&#x2F;option&gt;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;\\n    &lt;&#x2F;select&gt;\\n  &lt;&#x2F;div&gt;\\n&lt;&#x2F;div&gt;\\n&lt;div class=\\\&quot;row\\\&quot;&gt;\\n  &lt;div class=\\\&quot;col-lg-12\\\&quot;&gt;\&quot;.freeze); \n; \n; \n; ismobile = (params[:static] != nil); \n; @_out_buf &lt;&lt; (\&quot;\\n    &lt;table class=\\\&quot;cell-border compact display dt-responsive\\\&quot; id=\\\&quot;main_table\\\&quot; width=\\\&quot;100%\\\&quot;&gt;\\n      &lt;thead&gt;\\n        &lt;tr&gt;\\n          &lt;th&gt;\\n            S-Title\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\\n            No.\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\\n            Key.Tr\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\\n            Title\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((ltype == \&quot;list\&quot; ? \&quot;Singer [Backup]\&quot; : \&quot;List\&quot;), true, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\\n            Beat [Tempo]\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\\n            Perf Video&#x2F;Loops\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\\n            Note\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;&lt;&#x2F;th&gt;\\n        &lt;&#x2F;tr&gt;\\n      &lt;&#x2F;thead&gt;\\n      &lt;tbody&gt;\&quot;.freeze); \n; \n; \n; \n; \n; async = params[:static] ? &#x27;false&#x27; : &#x27;true&#x27;; \n; content[:__list].reject{|r| r[:disable]}.each_with_index do |e, index|; \n; @_out_buf &lt;&lt; (\&quot;\\n        &lt;tr&gt;\&quot;.freeze); \n; perf_url = e[:perf_url] || &#x27;&#x27;; \n; yt_video = nil; \n; tempo = e[:perf_tempo] || e[:tempo]; \n; @_out_buf &lt;&lt; (\&quot;\\n          &lt;td&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:stitle]), true, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((index+2), true, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\\n            &lt;div class=\\\&quot;d-grid gap-2\\\&quot;&gt;\&quot;.freeze); \n; \n; if (le = extra[index]) &amp;&amp; le[:lyric] &amp;&amp; !le[:lyric].empty?; \n; color = tempo_color(tempo); \n; @_out_buf &lt;&lt; (\&quot;\\n              &lt;button class=\\\&quot;btn btn-sm btn-outline-secondary mtooltip\\\&quot; onClick=\\\&quot;get_lyric(&amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((program))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;, \&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((index + range[0]))).to_s); @_out_buf &lt;&lt; (\&quot;, \&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((async))).to_s); @_out_buf &lt;&lt; (\&quot;)\\\&quot; style=\\\&quot;background-color:\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((color))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot; title=\\\&quot;Lyric for: \&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((e[:title]))).to_s); @_out_buf &lt;&lt; (\&quot;, tempo: \&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((tempo))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;&gt;&lt;b&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic(((e[:key] &amp;&amp; !e[:key].empty?) ? e[:key] : &#x27;?&#x27;), false, \&quot;\\n                  \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;b&gt;\&quot;.freeze); if e[:transpose]; \n; @_out_buf &lt;&lt; (\&quot;&lt;span class=\\\&quot;transpose\\\&quot; title=\\\&quot;Transpose\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:transpose]), false, \&quot;\\n                  \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;span&gt;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;&lt;span\&quot;.freeze); _temple_html_attributeremover1 = \&quot;\&quot;; if !_temple_html_attributeremover1.empty?; @_out_buf &lt;&lt; (\&quot; class=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((_temple_html_attributeremover1).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:lead] ? \&quot; (\#{e[:lead]})\&quot; : \&quot;\&quot;), false, \&quot;\\n                  \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;span&gt;&lt;&#x2F;button&gt;\&quot;.freeze); else; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic(((e[:key] &amp;&amp; !e[:key].empty?) ? e[:key] : &#x27;?&#x27;), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; if e[:transpose]; \n; @_out_buf &lt;&lt; (\&quot;&lt;span class=\\\&quot;transpose\\\&quot; title=\\\&quot;Transpose\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:transpose]), false, \&quot;\\n                \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;span&gt;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;\\n            &lt;&#x2F;div&gt;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:continue] ? \&quot;++\&quot; : \&quot;\&quot;), true, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; if e[:play_url]; \n; if ismobile; \n; @_out_buf &lt;&lt; (\&quot;&lt;a\&quot;.freeze); _slim_codeattributes6 = e[:play_url]; if _slim_codeattributes6; if _slim_codeattributes6 == true; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes6))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot; title=\\\&quot;Source lyrics\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:title]), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;a&gt;\&quot;.freeze); else; \n; @_out_buf &lt;&lt; (\&quot;&lt;a\&quot;.freeze); _slim_codeattributes7 = e[:play_url]; if _slim_codeattributes7; if _slim_codeattributes7 == true; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes7))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot; target=\\\&quot;Play\\\&quot; title=\\\&quot;Source lyrics\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:title]), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;a&gt;\&quot;.freeze); end; else; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:title]), false, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; end; if e[:note] &amp;&amp; !(@isIPhone || @isIPad); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((\&quot; (\#{e[:note][0..9]})\&quot;), false, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; end; if e[:has_style]; \n; @_out_buf &lt;&lt; (\&quot;&amp;nbsp;&lt;i class=\\\&quot;fa fa-guitar\\\&quot;&gt;&lt;&#x2F;i&gt;\&quot;.freeze); \n; \n; end; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\&quot;.freeze); \n; if ltype == \&quot;list\&quot;; \n; singer = capwords(to_stitle(e[:singer])); \n; unless singer.empty?; \n; @_out_buf &lt;&lt; (\&quot;\\n            &lt;button class=\\\&quot;btn\\\&quot; onClick=\\\&quot;return dt_search(&amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((singer))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;)\\\&quot;&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((\&quot;\#{singer}\&quot; + (e[:backup] ? \&quot; [\#{e[:backup]}]\&quot; : \&quot;\&quot;)), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;button&gt;\&quot;.freeze); if !(@isIPad || @isIPhone); \n; @_out_buf &lt;&lt; (\&quot;&lt;a class=\\\&quot;chord\\\&quot; href=\\\&quot;..&#x2F;singer&#x2F;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((singer.downcase))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;&gt;Singer&lt;&#x2F;a&gt;\&quot;.freeze); \n; end; end; else; \n; list = e[:singer]; \n; @_out_buf &lt;&lt; (\&quot;&lt;button class=\\\&quot;btn\\\&quot; onClick=\\\&quot;return dt_search(&amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((singer))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;)\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((list), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;button&gt;&lt;a class=\\\&quot;chord\\\&quot; href=\\\&quot;..&#x2F;list&#x2F;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((list))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;&gt;List&lt;&#x2F;a&gt;\&quot;.freeze); \n; end; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td class=\\\&quot;dt-right\\\&quot;&gt;\\n            &lt;button class=\\\&quot;btn\\\&quot; onClick=\\\&quot;return dt_search(&amp;#39;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((e[:beat]))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;)\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:beat]), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;button&gt;\&quot;.freeze); if tempo &amp;&amp; !(@iPhone || @iPad); \n; @_out_buf &lt;&lt; (\&quot;&lt;span class=\\\&quot;transpose text-right\\\&quot; title=\\\&quot;Tempo\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((tempo), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;span&gt;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\&quot;.freeze); \n; perf_url = e[:perf_url] || &#x27;&#x27;; \n; if (yt_video = extract_yt_video(perf_url)); \n; title = e[:title].gsub(&#x2F;&#x27;&#x2F;, &#x27;&#x27;); \n; @_out_buf &lt;&lt; (\&quot;\\n            &lt;button class=\\\&quot;btn btn-sm mtooltip\\\&quot; onClick=\\\&quot;return play_on_youtube(&amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((yt_video))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;, &amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((title))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;, 0, 0)\\\&quot; title=\\\&quot;Play Video\\\&quot;&gt;&lt;i class=\\\&quot;fa-solid fa-video\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;\&quot;.freeze); \n; \n; (e[:perf_loop] || []).each do |els|; \n; el = els.split(\&quot;-\&quot;).map{|f| f.to_i}; \n; @_out_buf &lt;&lt; (\&quot;&lt;button class=\\\&quot;btn btn-sm mtooltip\\\&quot; onClick=\\\&quot;return play_on_youtube(&amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((yt_video))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;, &amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((title))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;, \&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((el[0]))).to_s); @_out_buf &lt;&lt; (\&quot;, \&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((el[1]))).to_s); @_out_buf &lt;&lt; (\&quot;)\\\&quot; title=\\\&quot;Play loops\\\&quot;&gt;&lt;i class=\\\&quot;fa-solid fa-undo\\\&quot;&gt;&lt;&#x2F;i&gt;\\n              &lt;div class=\\\&quot;loopstyle\\\&quot;&gt;\&quot;.freeze); \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((\&quot;\#{el[0]}.\#{el[1]-el[0]}\&quot;), true, \&quot;\\n                \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;\\n              &lt;&#x2F;div&gt;\\n            &lt;&#x2F;button&gt;\&quot;.freeze); end; elsif perf_url.start_with?(&#x27;https:&#x2F;&#x2F;&#x27;); \n; @_out_buf &lt;&lt; (\&quot;&lt;a\&quot;.freeze); _slim_codeattributes8 = perf_url; if _slim_codeattributes8; if _slim_codeattributes8 == true; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes8))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot; target=\\\&quot;Listen (not embed)\\\&quot;&gt;Link&lt;&#x2F;a&gt;\&quot;.freeze); \n; else; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((perf_url), false, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; end; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:note] || e[:perf_note]), true, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\\n            &lt;div class=\\\&quot;hidden\\\&quot;&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((index), true, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; \n; @_out_buf &lt;&lt; (\&quot;\\n            &lt;&#x2F;div&gt;\\n          &lt;&#x2F;td&gt;\\n        &lt;&#x2F;tr&gt;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;\\n      &lt;&#x2F;tbody&gt;\\n    &lt;&#x2F;table&gt;\\n    &lt;button class=\\\&quot;btn btn-sm btn-outline-secondary\\\&quot; onClick=\\\&quot;reset_order()\\\&quot;&gt;Reset Order &lt;&#x2F;button&gt;\&quot;.freeze); \n; unless params[:static]; \n; @_out_buf &lt;&lt; (\&quot;&lt;button class=\\\&quot;btn btn-sm btn-outline-secondary\\\&quot; onClick=\\\&quot;sv_save_order()\\\&quot;&gt;Save to Server&lt;&#x2F;button&gt;\&quot;.freeze); \n; \n; end; @_out_buf &lt;&lt; (\&quot;\\n  &lt;&#x2F;div&gt;\\n&lt;&#x2F;div&gt;\\n&lt;div class=\\\&quot;qrcode\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.indent_dynamic((qrcode), true, \&quot;\\n  \&quot;, _temple_html_pretty1)).to_s); \n; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;&#x2F;div&gt;\\n&lt;script&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.indent_dynamic((\&quot;extra = \&quot; + extra.to_json), true, \&quot;\\n  \&quot;, _temple_html_pretty1)).to_s); \n; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;&#x2F;script&gt;\&quot;.freeze); content_for :javascript do; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;script src=\\\&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;iframe_api\\\&quot;&gt;&lt;&#x2F;script&gt;\\n&lt;script&gt;\\n  var main_table;\\n  var myModal;\\n  \\n  $(function() {\\n  \\n    $(&#x27;.mtooltip&#x27;).tooltip()\\n  \\n    main_table = new DataTable(&#x27;#main_table&#x27;, {\\n      layout: {\\n        topStart:    &#x27;search&#x27;,\\n        bottomStart: &#x27;info&#x27;,\\n      },\\n      search: {\\n        search: &#x27;\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((params[:search]), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;,\\n        caseInsensitive: true,\\n      },\\n      responsive: true,\\n      paging:     false,\\n      columns: [null, {data: &#x27;id&#x27;}, null, {data: &#x27;title&#x27;},\\n                null, null, null, null],\\n      order:  [[ 1, \\\&quot;asc\\\&quot; ]],\\n      columnDefs: [\\n        { target: 0, visible: false, searchable: true },\\n        { target: 2, visible: true,  searchable: false },\\n        { target: 7, visible: false, searchable: true },\\n        { target: 8, visible: true,  searchable: false },\\n      ],\\n      rowReorder: {\\n        dataSrc: &#x27;id&#x27;,\\n      },\\n      initComplete: function(settings, json) {\\n        var newkey  = &#x27;&#x27;\\n        for (let value of $(&#x27;#main_table tbody tr&#x27;)) {\\n          newkey += value.childNodes[4].innerText.replace(&#x2F;[\\\\(\\\\) ]&#x2F;g, \\\&quot;\\\&quot;)\\n        }\\n        let curkey = localStorage.getItem(&#x27;pagekey.\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;)\\n        &#x2F;&#x2F; console.log(`\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; curkey: ${curkey}`)\\n        &#x2F;&#x2F; console.log(`\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; newkey: ${newkey}`)\\n        localStorage.setItem(\\\&quot;pagekey.\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;, newkey)\\n        if (curkey == newkey) {\\n          restore_order()\\n        }\\n      }\\n    });\\n  \\n    main_table.on(&#x27;row-reorder&#x27;, (e, diff, edit) =&gt; {\\n      setTimeout(() =&gt; { save_order() }, 100)\\n    })\\n  \\n    myModal  = new bootstrap.Modal(document.getElementById(&#x27;lybox&#x27;))\\n  });\\n  \\n  function reset_order() {\\n    localStorage.removeItem(\\\&quot;pageorder.\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;)\\n    location.reload()\\n  }\\n  \\n  function current_order() {\\n    var olist = []\\n    for (value of $(&#x27;#main_table tbody tr&#x27;)) {\\n      olist.push(value.childNodes[15].innerText)\\n    }\\n    return olist\\n  }\\n  \\n  &#x2F;&#x2F; Save order to localstore (per device only)\\n  function save_order() {\\n    var olist = current_order()\\n    console.log(&#x27;new_list: &#x27;, olist)\\n    localStorage.setItem(\\\&quot;pageorder.\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;, JSON.stringify(olist))\\n  }\\n  \\n  &#x2F;&#x2F; Save order to server (so it could be shared)\\n  function sv_save_order() {\\n    var olist = current_order()\\n    var url = `..&#x2F;reorder&#x2F;\&quot;.freeze); \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x2F;${olist.join(&#x27;,&#x27;)}`\\n    jQuery.ajax({\\n      url:      url,\\n      method:   &#x27;POST&#x27;,\\n      async:    false,\\n      dataType: &#x27;json&#x27;,\\n      success:  location.reload(),\\n    });\\n  }\\n  \\n  function restore_order() {\\n    let item = localStorage.getItem(\\\&quot;pageorder.\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;)\\n    if (item == null) {\\n      console.log(\\\&quot;No order to restore\\\&quot;)\\n      return\\n    }\\n  \\n    let olist   = JSON.parse(item)\\n    let dt_rows = $(&#x27;#main_table tbody tr&#x27;)\\n    var offset  = 2\\n    console.log(`Restore olist: ${olist}`)\\n  \\n    for (rowno of olist) {\\n      &#x2F;&#x2F; console.log(&#x27;rowno: &#x27;, rowno)\\n      &#x2F;&#x2F; console.log(&#x27;dtrow: &#x27;, dt_rows[rowno])\\n  \\n      if (dt_rows[rowno] == null) {\\n        continue\\n      }\\n      let listno = dt_rows[rowno].childNodes[2].innerText\\n      dt_rows[rowno].childNodes[2].innerText = offset\\n      offset += 1\\n    }\\n  \\n    setTimeout(() =&gt; {\\n      main_table.rows().invalidate().draw()\\n    }, 100)\\n  }\\n&lt;&#x2F;script&gt;\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; end; @_out_buf; ensure; @_out_buf = _temple_generators_stringbuffer1; end&quot;&gt;, [:slim, :_pl_player, {:template_engine=&gt;:slim, :outvar=&gt;&quot;@_out_buf&quot;, :default_encoding=&gt;&quot;utf-8&quot;}, &quot;&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&quot;]=&gt;#&lt;Slim::Template:0x00007f37b5a60dd0 @options={:template_engine=&gt;:slim, :outvar=&gt;&quot;@_out_buf&quot;}, @line=1, @file=&quot;&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;_pl_player.slim&quot;, @compiled_method={[PlaylistPortal, [:height, :id, :width]]=&gt;#&lt;UnboundMethod: Tilt::CompiledTemplates#__tilt_17540(locals) &#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;_pl_player.slim:-4&gt;}, @default_encoding=&quot;utf-8&quot;, @skip_compiled_encoding_detection=nil, @data=&quot;- # Using YT iFrame API, more flexible but cannot deployed as static file\n\n- vtitle  = \&quot;\#{id}-title\&quot;\n- vplayer = \&quot;\#{id}-player\&quot;\n- vcloser = \&quot;\#{id}-closer\&quot;\n\n- content_for :css do\n  css:\n    #\#{vplayer} {\n      width:    \#{width};\n      height:   \#{height};\n      opacity:  0.4;\n    }\n    #\#{vcloser} {\n      position: absolute;\n      top:      0;\n      right:    0;\n      z-index:  99;\n    }\n\ndiv id=id\n  div\n    a id=vcloser href=&#x27;#&#x27; onClick=\&quot;cancel_play(); return false\&quot;\n      i.fa.fa-window-close\n    span id=vtitle style=\&quot;font-size:60%\&quot;\n  div id=vplayer\n\n- content_for :javascript do\n  javascript:\n    var player = null;\n    var play_timer = null;\n\n    &#x2F;&#x2F; This function will be called when the API is ready\n    function onYouTubeIframeAPIReady() {\n      console.log(\&quot;Frame API ready\&quot;)\n      player = new YT.Player(&#x27;\#{vplayer}&#x27;, {\n        videoId: &#x27;&#x27;,\n        playerVars: {\n            autoplay:       1,\n            controls:       0,\n            showinfo:       0,\n            modestbranding: 1,\n        },\n      });\n    }\n\n    function cancel_play() {\n      cancel_play_timer()\n      player.stopVideo();\n      $(&#x27;#\#{id}&#x27;).hide();\n    }\n\n    function cancel_play_timer() {\n      if (play_timer) {\n        clearTimeout(play_timer);\n        play_timer = null\n      }\n    }\n\n    function loopPlay(stime, etime) {\n      console.log(`Seeking to ${stime}. Play for ${etime - stime}`)\n\n      &#x2F;&#x2F; In case a loop play precede.  Must cancel any play timer\n      cancel_play_timer();\n      player.seekTo(stime, true)\n      if (etime &lt;= stime) {\n        return\n      }\n\n      &#x2F;&#x2F; Looping play\n      var duration = etime - stime\n      play_timer = setTimeout(function() {\n        loopPlay(stime, etime);\n      }, duration*1000);\n      &#x2F;&#x2F; console.log(&#x27;Starting timer: &#x27;, play_timer, &#x27; duration: &#x27;, duration)\n    }\n\n    function play_on_youtube(video, title, stime, etime) {\n      if (player == null) {\n        alert(\&quot;Youtube player is not ready\&quot;)\n        return\n      }\n      var href = `https:&#x2F;&#x2F;www.youtube.com&#x2F;embed&#x2F;${video}?autoplay=1&amp;playsinline=1`;\n      console.log(href, stime, etime)\n\n      $(&#x27;#\#{vtitle}&#x27;)[0].innerHTML = title\n      player.loadVideoById(video, stime)\n      player.seekTo(stime, true)\n\n      &#x2F;* Slow down player *&#x2F;\n      if (etime &gt; 0) {\n        const prate = 1\n        player.setPlaybackRate(prate);\n        etime2 = stime + ((etime - stime)&#x2F;prate);\n      }\n\n      &#x2F;&#x2F; 1st seek somehow have to wait a bit ...\n      setTimeout(function() {\n        player.unMute()\n        $(&#x27;#\#{id}&#x27;).show();\n        loopPlay(stime, etime);\n      }, 500)\n    }\n\n  -# Script must be loaded last after trigger is in place\n\n  script src=\&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;iframe_api\&quot;\n&quot;, @src=&quot;begin; _temple_generators_stringbuffer1 = @_out_buf if defined?(@_out_buf); @_out_buf = &#x27;&#x27;.dup; _temple_html_pretty1 = &#x2F;&lt;code|&lt;pre|&lt;textarea&#x2F;; # Using YT iFrame API, more flexible but cannot deployed as static file; \n; \n; vtitle  = \&quot;\#{id}-title\&quot;; \n; vplayer = \&quot;\#{id}-player\&quot;; \n; vcloser = \&quot;\#{id}-closer\&quot;; \n; \n; content_for :css do; \n; @_out_buf &lt;&lt; (\&quot;&lt;style&gt;\\n  #\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vplayer), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; {\\n    width:    \&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((width), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;;\\n    height:   \&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((height), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;;\\n    opacity:  0.4;\\n  }\\n  #\&quot;.freeze); \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vcloser), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; {\\n    position: absolute;\\n    top:      0;\\n    right:    0;\\n    z-index:  99;\\n  }\\n&lt;&#x2F;style&gt;\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; end; @_out_buf &lt;&lt; (\&quot;\\n&lt;div\&quot;.freeze); _slim_codeattributes1 = id; if _slim_codeattributes1; if _slim_codeattributes1 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes1))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;\\n  &lt;div&gt;\\n    &lt;a href=\\\&quot;#\\\&quot;\&quot;.freeze); \n; \n; _slim_codeattributes2 = vcloser; if _slim_codeattributes2; if _slim_codeattributes2 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes2))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot; onClick=\\\&quot;cancel_play(); return false\\\&quot;&gt;&lt;i class=\\\&quot;fa fa-window-close\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;a&gt;&lt;span\&quot;.freeze); \n; \n; _slim_codeattributes3 = vtitle; if _slim_codeattributes3; if _slim_codeattributes3 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes3))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot; style=\\\&quot;font-size:60%\\\&quot;&gt;&lt;&#x2F;span&gt;\\n  &lt;&#x2F;div&gt;\\n  &lt;div\&quot;.freeze); \n; _slim_codeattributes4 = vplayer; if _slim_codeattributes4; if _slim_codeattributes4 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes4))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;&lt;&#x2F;div&gt;\\n&lt;&#x2F;div&gt;\&quot;.freeze); \n; \n; content_for :javascript do; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;script&gt;\\n  var player = null;\\n  var play_timer = null;\\n  \\n  &#x2F;&#x2F; This function will be called when the API is ready\\n  function onYouTubeIframeAPIReady() {\\n    console.log(\\\&quot;Frame API ready\\\&quot;)\\n    player = new YT.Player(&#x27;\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vplayer), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;, {\\n      videoId: &#x27;&#x27;,\\n      playerVars: {\\n          autoplay:       1,\\n          controls:       0,\\n          showinfo:       0,\\n          modestbranding: 1,\\n      },\\n    });\\n  }\\n  \\n  function cancel_play() {\\n    cancel_play_timer()\\n    player.stopVideo();\\n    $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((id), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;).hide();\\n  }\\n  \\n  function cancel_play_timer() {\\n    if (play_timer) {\\n      clearTimeout(play_timer);\\n      play_timer = null\\n    }\\n  }\\n  \\n  function loopPlay(stime, etime) {\\n    console.log(`Seeking to ${stime}. Play for ${etime - stime}`)\\n  \\n    &#x2F;&#x2F; In case a loop play precede.  Must cancel any play timer\\n    cancel_play_timer();\\n    player.seekTo(stime, true)\\n    if (etime &lt;= stime) {\\n      return\\n    }\\n  \\n    &#x2F;&#x2F; Looping play\\n    var duration = etime - stime\\n    play_timer = setTimeout(function() {\\n      loopPlay(stime, etime);\\n    }, duration*1000);\\n    &#x2F;&#x2F; console.log(&#x27;Starting timer: &#x27;, play_timer, &#x27; duration: &#x27;, duration)\\n  }\\n  \\n  function play_on_youtube(video, title, stime, etime) {\\n    if (player == null) {\\n      alert(\\\&quot;Youtube player is not ready\\\&quot;)\\n      return\\n    }\\n    var href = `https:&#x2F;&#x2F;www.youtube.com&#x2F;embed&#x2F;${video}?autoplay=1&amp;playsinline=1`;\\n    console.log(href, stime, etime)\\n  \\n    $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vtitle), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;)[0].innerHTML = title\\n    player.loadVideoById(video, stime)\\n    player.seekTo(stime, true)\\n  \\n    &#x2F;* Slow down player *&#x2F;\\n    if (etime &gt; 0) {\\n      const prate = 1\\n      player.setPlaybackRate(prate);\\n      etime2 = stime + ((etime - stime)&#x2F;prate);\\n    }\\n  \\n    &#x2F;&#x2F; 1st seek somehow have to wait a bit ...\\n    setTimeout(function() {\\n      player.unMute()\\n      $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((id), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;).show();\\n      loopPlay(stime, etime);\\n    }, 500)\\n  }\\n&lt;&#x2F;script&gt;\&quot;.freeze); \n; \n; \n; \n; \n; # Script must be loaded last after trigger is in place; \n; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;script src=\\\&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;iframe_api\\\&quot;&gt;&lt;&#x2F;script&gt;\&quot;.freeze); \n; end; @_out_buf; ensure; @_out_buf = _temple_generators_stringbuffer1; end&quot;&gt;, [:slim, :_lyric_box, {:template_engine=&gt;:slim, :outvar=&gt;&quot;@_out_buf&quot;, :default_encoding=&gt;&quot;utf-8&quot;}, &quot;&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&quot;]=&gt;#&lt;Slim::Template:0x00007f37b5b0b2d0 @options={:template_engine=&gt;:slim, :outvar=&gt;&quot;@_out_buf&quot;}, @line=1, @file=&quot;&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;_lyric_box.slim&quot;, @compiled_method={[PlaylistPortal, [:id, :ltype]]=&gt;#&lt;UnboundMethod: Tilt::CompiledTemplates#__tilt_17540(locals) &#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;_lyric_box.slim:-3&gt;}, @default_encoding=&quot;utf-8&quot;, @skip_compiled_encoding_detection=nil, @data=&quot;- ltitle   = \&quot;\#{id}-title\&quot;\n- ldebug   = \&quot;\#{id}-debug\&quot;\n- lheader  = \&quot;\#{id}-header\&quot;\n- lcontent = \&quot;\#{id}-content\&quot;\n- vctl     = \&quot;\#{id}-vctl\&quot;\n\n- content_for :css do\n  css:\n    .chord {\n      color:            #aa5;\n      vertical-align:   12px;\n      font-family:      monospace;\n      font-weight:      800;\n      padding:          2px;\n      border-left:      1px solid #888;\n      border-bottom:    1px solid #888;\n      font-size:        80%;\n      background-color: #ffc;\n    }\n    #\#{ltitle} {\n      font-size: 80%;\n    }\n    #\#{ldebug} {\n      font-size: 50%;\n    }\n\n&#x2F;! Lyric modal - hidden until brought up\n.modal.fade id=id tabindex=-1\n  .modal-dialog.modal-dialog-centered.modal-dialog-scrollable.modal-xl style=\&quot;max-width:100%; max-height:100%\&quot;\n    .modal-content\n      .modal-header\n        div.small id=lheader\n        div.small id=ldebug\n        div id=vctl\n          button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;play_song()\&quot; title=\&quot;Play full video\&quot;\n            i.fa-solid.fa-headphones\n          button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;play_intro()\&quot; title=\&quot;Play intro\&quot;\n            i.fa-solid.fa-undo\n          button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;cancel_play()\&quot; title=\&quot;Stop plauing\&quot;\n            i.fa-solid.fa-stop\n      .modal-body\n        div id=lcontent\n      .modal-footer\n        div id=ltitle\n        - async = params[:static] ? &#x27;false&#x27; : &#x27;true&#x27;\n        button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;load_lyric(\#{async}, -1)\&quot; title=\&quot;Previous Page\&quot;\n          i.fa.fa-backward\n        - unless params[:static]\n          button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;load_lyric(\#{async}, 0)\&quot; title=\&quot;Reload Page\&quot;\n            i.fa-solid.fa-undo\n        button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;singer_toggle()\&quot; title=\&quot;Toogle chord\&quot;\n          i.fa.fa-music\n        button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;load_lyric(\#{async}, 1)\&quot; title=\&quot;Next Page\&quot;\n          i.fa.fa-forward\n        button.btn.btn-warning type=\&quot;button\&quot; data-bs-dismiss=\&quot;modal\&quot; title=\&quot;Close\&quot;\n          i.fa.fa-sign-out\n\njavascript:\n  function singer_toggle() {\n    $(&#x27;.chord&#x27;).toggle()\n    $(&#x27;#\#{id} .modal-header&#x27;).toggle()\n  }\n\n  function dblog(msg) {\n    console.log(msg)\n    &#x2F;&#x2F; var dbhandle = $(&#x27;#\#{ldebug}&#x27;)\n    &#x2F;&#x2F; dbhandle.html(dbhandle.html() + ` - ${msg}`)\n  }\n\n  function load_lyric(async = true, offset = 0) {\n    var olist = current_order()\n\n    var cur_ofs = olist.indexOf(myModal.item.toString())\n    var new_ofs = cur_ofs + offset\n\n    if ((new_ofs &lt; 0) || (new_ofs &gt;= olist.length)) {\n      return\n    }\n    get_lyric(myModal.program, olist[new_ofs], async)\n  }\n  function play_intro() {\n    var lvideo = $(&#x27;#\#{vctl}&#x27;)\n    var video  = lvideo.attr(&#x27;my_video&#x27;)\n    var stime  = parseInt(lvideo.attr(&#x27;my_vstart&#x27;))\n    var etime  = parseInt(lvideo.attr(&#x27;my_vend&#x27;))\n    var title  = lvideo.attr(&#x27;my_title&#x27;)\n    play_on_youtube(video, title, stime, etime)\n  }\n  function play_song() {\n    var lvideo = $(&#x27;#\#{vctl}&#x27;)\n    var video = lvideo.attr(&#x27;my_video&#x27;)\n    var title = lvideo.attr(&#x27;my_title&#x27;)\n    play_on_youtube(video, title, 0, 0)\n  }\n  function get_lyric(program, item, async = true) {\n    myModal.program = program\n    myModal.item    = item\n\n    dblog(`Getting item # ${myModal.item}`)\n\n    if (async) {\n      var url = `..&#x2F;lyric&#x2F;${program}&#x2F;${item}?type=\#{ltype}`\n      jQuery.ajax({\n        url:      url,\n        async:    true,\n        dataType: &#x27;json&#x27;,\n        success:  show_lyric,\n      });\n    } else {\n      var content  = extra[item]\n      if (content != null) {\n        show_lyric(content)\n      }\n    }\n  }\n  function show_lyric(content) {\n    console.log(&#x27;content &#x27;, content)\n    var lvideo = $(&#x27;#\#{vctl}&#x27;)\n\n    &#x2F;&#x2F; If vintro exist - create button for play&#x2F;stop intro\n    lvideo.attr(&#x27;my_video&#x27;,  content[&#x27;video&#x27;])\n    lvideo.attr(&#x27;my_title&#x27;,  content[&#x27;title&#x27;])\n    lvideo.attr(&#x27;my_item&#x27;,   content[&#x27;item_no&#x27;])\n\n    if (content[&#x27;vintro&#x27;] != null) {\n      lvideo.attr(&#x27;my_vstart&#x27;, content[&#x27;vintro&#x27;][0])\n      lvideo.attr(&#x27;my_vend&#x27;,   content[&#x27;vintro&#x27;][1])\n    }\n    lvideo.show()\n\n    var lyric = content[&#x27;lyric&#x27;].replaceAll(&#x27;\\n&#x27;, &#x27;&lt;br&gt;&#x27;)\n    $(&#x27;#\#{lcontent}&#x27;).html(&#x27;&lt;center&gt;&lt;b&gt;&#x27; + lyric)\n    $(&#x27;#\#{lheader}&#x27;).html(`${content[&#x27;beat&#x27;]}: ${content[&#x27;tokey&#x27;]}.${content[&#x27;transpose&#x27;]}\#${content[&#x27;tempo&#x27;]} - Intro: ${content[&#x27;intro&#x27;]}`)\n    $(&#x27;#\#{ltitle}&#x27;).html(content[&#x27;title&#x27;].substring(0, 19))\n    $(&#x27;.modal-header&#x27;).show()\n    myModal.show()\n  }\n\n\n\n&quot;, @src=&quot;begin; _temple_generators_stringbuffer1 = @_out_buf if defined?(@_out_buf); @_out_buf = &#x27;&#x27;.dup; _temple_html_pretty1 = &#x2F;&lt;code|&lt;pre|&lt;textarea&#x2F;; ltitle   = \&quot;\#{id}-title\&quot;; \n; ldebug   = \&quot;\#{id}-debug\&quot;; \n; lheader  = \&quot;\#{id}-header\&quot;; \n; lcontent = \&quot;\#{id}-content\&quot;; \n; vctl     = \&quot;\#{id}-vctl\&quot;; \n; \n; content_for :css do; \n; @_out_buf &lt;&lt; (\&quot;&lt;style&gt;\\n  .chord {\\n    color:            #aa5;\\n    vertical-align:   12px;\\n    font-family:      monospace;\\n    font-weight:      800;\\n    padding:          2px;\\n    border-left:      1px solid #888;\\n    border-bottom:    1px solid #888;\\n    font-size:        80%;\\n    background-color: #ffc;\\n  }\\n  #\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((ltitle), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; {\\n    font-size: 80%;\\n  }\\n  #\&quot;.freeze); \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((ldebug), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; {\\n    font-size: 50%;\\n  }\\n&lt;&#x2F;style&gt;\&quot;.freeze); \n; \n; \n; \n; end; @_out_buf &lt;&lt; (\&quot;\\n&lt;!--Lyric modal - hidden until brought up--&gt;\\n&lt;div class=\\\&quot;modal fade\\\&quot;\&quot;.freeze); \n; _slim_codeattributes1 = id; if _slim_codeattributes1; if _slim_codeattributes1 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes1))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; _slim_codeattributes2 = -1; if _slim_codeattributes2; if _slim_codeattributes2 == true; @_out_buf &lt;&lt; (\&quot; tabindex=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; tabindex=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes2))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;\\n  &lt;div class=\\\&quot;modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl\\\&quot; style=\\\&quot;max-width:100%; max-height:100%\\\&quot;&gt;\\n    &lt;div class=\\\&quot;modal-content\\\&quot;&gt;\\n      &lt;div class=\\\&quot;modal-header\\\&quot;&gt;\\n        &lt;div class=\\\&quot;small\\\&quot;\&quot;.freeze); \n; \n; \n; \n; _slim_codeattributes3 = lheader; if _slim_codeattributes3; if _slim_codeattributes3 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes3))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;&lt;&#x2F;div&gt;\\n        &lt;div class=\\\&quot;small\\\&quot;\&quot;.freeze); \n; _slim_codeattributes4 = ldebug; if _slim_codeattributes4; if _slim_codeattributes4 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes4))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;&lt;&#x2F;div&gt;\\n        &lt;div\&quot;.freeze); \n; _slim_codeattributes5 = vctl; if _slim_codeattributes5; if _slim_codeattributes5 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes5))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;\\n          &lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;play_song()\\\&quot; title=\\\&quot;Play full video\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa-solid fa-headphones\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;&lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;play_intro()\\\&quot; title=\\\&quot;Play intro\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa-solid fa-undo\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;&lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;cancel_play()\\\&quot; title=\\\&quot;Stop plauing\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa-solid fa-stop\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;\\n        &lt;&#x2F;div&gt;\\n      &lt;&#x2F;div&gt;\\n      &lt;div class=\\\&quot;modal-body\\\&quot;&gt;\\n        &lt;div\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; _slim_codeattributes6 = lcontent; if _slim_codeattributes6; if _slim_codeattributes6 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes6))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;&lt;&#x2F;div&gt;\\n      &lt;&#x2F;div&gt;\\n      &lt;div class=\\\&quot;modal-footer\\\&quot;&gt;\\n        &lt;div\&quot;.freeze); \n; \n; _slim_codeattributes7 = ltitle; if _slim_codeattributes7; if _slim_codeattributes7 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes7))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;&lt;&#x2F;div&gt;\&quot;.freeze); \n; async = params[:static] ? &#x27;false&#x27; : &#x27;true&#x27;; \n; @_out_buf &lt;&lt; (\&quot;\\n        &lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;load_lyric(\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((async))).to_s); @_out_buf &lt;&lt; (\&quot;, -1)\\\&quot; title=\\\&quot;Previous Page\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa fa-backward\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;\&quot;.freeze); \n; \n; unless params[:static]; \n; @_out_buf &lt;&lt; (\&quot;&lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;load_lyric(\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((async))).to_s); @_out_buf &lt;&lt; (\&quot;, 0)\\\&quot; title=\\\&quot;Reload Page\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa-solid fa-undo\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;\&quot;.freeze); \n; \n; end; @_out_buf &lt;&lt; (\&quot;&lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;singer_toggle()\\\&quot; title=\\\&quot;Toogle chord\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa fa-music\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;&lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;load_lyric(\&quot;.freeze); \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((async))).to_s); @_out_buf &lt;&lt; (\&quot;, 1)\\\&quot; title=\\\&quot;Next Page\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa fa-forward\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;&lt;button class=\\\&quot;btn btn-warning\\\&quot; data-bs-dismiss=\\\&quot;modal\\\&quot; title=\\\&quot;Close\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa fa-sign-out\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;\\n      &lt;&#x2F;div&gt;\\n    &lt;&#x2F;div&gt;\\n  &lt;&#x2F;div&gt;\\n&lt;&#x2F;div&gt;\\n&lt;script&gt;\\n  function singer_toggle() {\\n    $(&#x27;.chord&#x27;).toggle()\\n    $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((id), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; .modal-header&#x27;).toggle()\\n  }\\n  \\n  function dblog(msg) {\\n    console.log(msg)\\n    &#x2F;&#x2F; var dbhandle = $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((ldebug), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;)\\n    &#x2F;&#x2F; dbhandle.html(dbhandle.html() + ` - ${msg}`)\\n  }\\n  \\n  function load_lyric(async = true, offset = 0) {\\n    var olist = current_order()\\n  \\n    var cur_ofs = olist.indexOf(myModal.item.toString())\\n    var new_ofs = cur_ofs + offset\\n  \\n    if ((new_ofs &lt; 0) || (new_ofs &gt;= olist.length)) {\\n      return\\n    }\\n    get_lyric(myModal.program, olist[new_ofs], async)\\n  }\\n  function play_intro() {\\n    var lvideo = $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vctl), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;)\\n    var video  = lvideo.attr(&#x27;my_video&#x27;)\\n    var stime  = parseInt(lvideo.attr(&#x27;my_vstart&#x27;))\\n    var etime  = parseInt(lvideo.attr(&#x27;my_vend&#x27;))\\n    var title  = lvideo.attr(&#x27;my_title&#x27;)\\n    play_on_youtube(video, title, stime, etime)\\n  }\\n  function play_song() {\\n    var lvideo = $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vctl), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;)\\n    var video = lvideo.attr(&#x27;my_video&#x27;)\\n    var title = lvideo.attr(&#x27;my_title&#x27;)\\n    play_on_youtube(video, title, 0, 0)\\n  }\\n  function get_lyric(program, item, async = true) {\\n    myModal.program = program\\n    myModal.item    = item\\n  \\n    dblog(`Getting item # ${myModal.item}`)\\n  \\n    if (async) {\\n      var url = `..&#x2F;lyric&#x2F;${program}&#x2F;${item}?type=\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((ltype), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;`\\n      jQuery.ajax({\\n        url:      url,\\n        async:    true,\\n        dataType: &#x27;json&#x27;,\\n        success:  show_lyric,\\n      });\\n    } else {\\n      var content  = extra[item]\\n      if (content != null) {\\n        show_lyric(content)\\n      }\\n    }\\n  }\\n  function show_lyric(content) {\\n    console.log(&#x27;content &#x27;, content)\\n    var lvideo = $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vctl), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;)\\n  \\n    &#x2F;&#x2F; If vintro exist - create button for play&#x2F;stop intro\\n    lvideo.attr(&#x27;my_video&#x27;,  content[&#x27;video&#x27;])\\n    lvideo.attr(&#x27;my_title&#x27;,  content[&#x27;title&#x27;])\\n    lvideo.attr(&#x27;my_item&#x27;,   content[&#x27;item_no&#x27;])\\n  \\n    if (content[&#x27;vintro&#x27;] != null) {\\n      lvideo.attr(&#x27;my_vstart&#x27;, content[&#x27;vintro&#x27;][0])\\n      lvideo.attr(&#x27;my_vend&#x27;,   content[&#x27;vintro&#x27;][1])\\n    }\\n    lvideo.show()\\n  \\n    var lyric = content[&#x27;lyric&#x27;].replaceAll(&#x27;\\\\n&#x27;, &#x27;&lt;br&gt;&#x27;)\\n    $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((lcontent), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;).html(&#x27;&lt;center&gt;&lt;b&gt;&#x27; + lyric)\\n    $(&#x27;#\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((lheader), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;).html(`${content[&#x27;beat&#x27;]}: ${content[&#x27;tokey&#x27;]}.${content[&#x27;transpose&#x27;]}\\\#${content[&#x27;tempo&#x27;]} - Intro: ${content[&#x27;intro&#x27;]}`)\\n    $(&#x27;#\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((ltitle), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;).html(content[&#x27;title&#x27;].substring(0, 19))\\n    $(&#x27;.modal-header&#x27;).show()\\n    myModal.show()\\n  }\\n&lt;&#x2F;script&gt;\&quot;.freeze); \n; \n; \n; \n; @_out_buf; ensure; @_out_buf = _temple_generators_stringbuffer1; end&quot;&gt;}&gt;, @pinned_response=false, @env={&quot;rack.version&quot;=&gt;[1, 6], &quot;rack.errors&quot;=&gt;#&lt;Object:0x00007f37b6b59010&gt;, &quot;rack.multithread&quot;=&gt;true, &quot;rack.multiprocess&quot;=&gt;false, &quot;rack.run_once&quot;=&gt;false, &quot;rack.url_scheme&quot;=&gt;&quot;http&quot;, &quot;SCRIPT_NAME&quot;=&gt;&quot;&#x2F;playlist&quot;, &quot;QUERY_STRING&quot;=&gt;&quot;static=1&amp;iPad=1&quot;, &quot;SERVER_SOFTWARE&quot;=&gt;&quot;puma 6.4.2 The Eagle of Durango&quot;, &quot;GATEWAY_INTERFACE&quot;=&gt;&quot;CGI&#x2F;1.2&quot;, &quot;REQUEST_METHOD&quot;=&gt;&quot;GET&quot;, &quot;REQUEST_PATH&quot;=&gt;&quot;&#x2F;playlist&#x2F;singer&#x2F;thien&quot;, &quot;REQUEST_URI&quot;=&gt;&quot;&#x2F;playlist&#x2F;singer&#x2F;thien?static=1&amp;iPad=1&quot;, &quot;SERVER_PROTOCOL&quot;=&gt;&quot;HTTP&#x2F;1.1&quot;, &quot;HTTP_HOST&quot;=&gt;&quot;localhost:4570&quot;, &quot;HTTP_USER_AGENT&quot;=&gt;&quot;Go-http-client&#x2F;1.1&quot;, &quot;HTTP_ACCEPT_ENCODING&quot;=&gt;&quot;gzip&quot;, &quot;puma.request_body_wait&quot;=&gt;0.006211996078491211, &quot;SERVER_NAME&quot;=&gt;&quot;localhost&quot;, &quot;SERVER_PORT&quot;=&gt;&quot;4570&quot;, &quot;PATH_INFO&quot;=&gt;&quot;&#x2F;singer&#x2F;thien&quot;, &quot;REMOTE_ADDR&quot;=&gt;&quot;127.0.0.1&quot;, &quot;HTTP_VERSION&quot;=&gt;&quot;HTTP&#x2F;1.1&quot;, &quot;puma.socket&quot;=&gt;#&lt;TCPSocket:fd 13, AF_INET, 127.0.0.1, 4570&gt;, &quot;rack.hijack?&quot;=&gt;true, &quot;rack.hijack&quot;=&gt;#&lt;Proc:0x00007f37b4b8fd38 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;lint.rb:553&gt;, &quot;rack.input&quot;=&gt;#&lt;Rack::Lint::InputWrapper:0x00007f37b4b8fc98 @input=#&lt;Puma::NullIO:0x00007f37b51c2ac0&gt;&gt;, &quot;rack.after_reply&quot;=&gt;[], &quot;puma.config&quot;=&gt;#&lt;Puma::Configuration:0x00007f37b4bbc9a0 @options=#&lt;Puma::UserFileDefaultOptions:0x00007f37b53329a0 @user_options={:environment=&gt;&quot;development&quot;, :pid=&gt;nil, :Port=&gt;&quot;4570&quot;, :Host=&gt;&quot;0.0.0.0&quot;, :AccessLog=&gt;[], :config=&gt;&quot;&#x2F;app&#x2F;config.ru&quot;, :quiet=&gt;true, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:4570&quot;], :app=&gt;#&lt;Rack::ContentLength:0x00007f37b52d9620 @app=#&lt;Rack::ShowExceptions:0x00007f37b53105a8 @app=#&lt;Rack::Lint:0x00007f37b5310670 @app=#&lt;Rack::TempfileReaper:0x00007f37b5310738 @app=#&lt;Rack::URLMap:0x00007f37b5b215d0 @known_hosts=#&lt;Set: {}&gt;, @mapping=[[nil, &quot;&#x2F;playlist&quot;, &#x2F;^\&#x2F;+playlist(.*)&#x2F;n, #&lt;PlaylistPortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;images&quot;, &#x2F;^\&#x2F;+images(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d09c0 &#x2F;app&#x2F;config.ru:12 (lambda)&gt;], [nil, &quot;&#x2F;smule&quot;, &#x2F;^\&#x2F;+smule(.*)&#x2F;n, #&lt;SmulePortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;js&quot;, &#x2F;^\&#x2F;+js(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d1028 &#x2F;app&#x2F;config.ru:9 (lambda)&gt;]]&gt;&gt;, @content_length=nil&gt;&gt;&gt;, :log_writer=&gt;#&lt;Puma::LogWriter:0x00007f37b4bbc950 @formatter=#&lt;Puma::LogWriter::DefaultFormatter:0x00007f37b5331848&gt;, @custom_logger=nil, @stdout=#&lt;IO:&lt;STDOUT&gt;&gt;, @stderr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false, @error_logger=#&lt;Puma::ErrorLogger:0x00007f37b5331820 @ioerr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false&gt;&gt;}, @file_options={}, @default_options={:auto_trim_time=&gt;30, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:9292&quot;], :clean_thread_locals=&gt;false, :debug=&gt;false, :early_hints=&gt;nil, :environment=&gt;&quot;development&quot;, :first_data_timeout=&gt;30, :idle_timeout=&gt;nil, :io_selector_backend=&gt;:auto, :log_requests=&gt;false, :logger=&gt;#&lt;IO:&lt;STDOUT&gt;&gt;, :max_fast_inline=&gt;10, :max_threads=&gt;5, :min_threads=&gt;0, :mode=&gt;:http, :mutate_stdout_and_stderr_to_sync_on_write=&gt;true, :out_of_band=&gt;[], :persistent_timeout=&gt;20, :queue_requests=&gt;true, :rackup=&gt;&quot;config.ru&quot;, :raise_exception_on_sigterm=&gt;true, :reaping_time=&gt;1, :remote_address=&gt;:socket, :silence_single_worker_warning=&gt;false, :silence_fork_callback_warning=&gt;false, :tag=&gt;&quot;app&quot;, :tcp_host=&gt;&quot;0.0.0.0&quot;, :tcp_port=&gt;9292, :wait_for_less_busy_worker=&gt;0.005, :worker_boot_timeout=&gt;60, :worker_check_interval=&gt;5, :worker_culling_strategy=&gt;:youngest, :worker_shutdown_timeout=&gt;30, :worker_timeout=&gt;60, :workers=&gt;0, :http_content_length_limit=&gt;nil, :Verbose=&gt;false, :Silent=&gt;false, :events=&gt;#&lt;Puma::Events:0x00007f37b5332e28 @hooks={:state=&gt;[], :on_booted=&gt;[]}&gt;, :preload_app=&gt;false}&gt;, @plugins=#&lt;Puma::PluginLoader:0x00007f37b53328d8 @instances=[]&gt;, @user_dsl=#&lt;Puma::DSL:0x00007f37b53327e8 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={:environment=&gt;&quot;development&quot;, :pid=&gt;nil, :Port=&gt;&quot;4570&quot;, :Host=&gt;&quot;0.0.0.0&quot;, :AccessLog=&gt;[], :config=&gt;&quot;&#x2F;app&#x2F;config.ru&quot;, :quiet=&gt;true, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:4570&quot;], :app=&gt;#&lt;Rack::ContentLength:0x00007f37b52d9620 @app=#&lt;Rack::ShowExceptions:0x00007f37b53105a8 @app=#&lt;Rack::Lint:0x00007f37b5310670 @app=#&lt;Rack::TempfileReaper:0x00007f37b5310738 @app=#&lt;Rack::URLMap:0x00007f37b5b215d0 @known_hosts=#&lt;Set: {}&gt;, @mapping=[[nil, &quot;&#x2F;playlist&quot;, &#x2F;^\&#x2F;+playlist(.*)&#x2F;n, #&lt;PlaylistPortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;images&quot;, &#x2F;^\&#x2F;+images(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d09c0 &#x2F;app&#x2F;config.ru:12 (lambda)&gt;], [nil, &quot;&#x2F;smule&quot;, &#x2F;^\&#x2F;+smule(.*)&#x2F;n, #&lt;SmulePortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;js&quot;, &#x2F;^\&#x2F;+js(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d1028 &#x2F;app&#x2F;config.ru:9 (lambda)&gt;]]&gt;&gt;, @content_length=nil&gt;&gt;&gt;, :log_writer=&gt;#&lt;Puma::LogWriter:0x00007f37b4bbc950 @formatter=#&lt;Puma::LogWriter::DefaultFormatter:0x00007f37b5331848&gt;, @custom_logger=nil, @stdout=#&lt;IO:&lt;STDOUT&gt;&gt;, @stderr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false, @error_logger=#&lt;Puma::ErrorLogger:0x00007f37b5331820 @ioerr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false&gt;&gt;}, @plugins=[]&gt;, @file_dsl=#&lt;Puma::DSL:0x00007f37b5332720 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={}, @plugins=[]&gt;, @default_dsl=#&lt;Puma::DSL:0x00007f37b5332680 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={:auto_trim_time=&gt;30, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:9292&quot;], :clean_thread_locals=&gt;false, :debug=&gt;false, :early_hints=&gt;nil, :environment=&gt;&quot;development&quot;, :first_data_timeout=&gt;30, :idle_timeout=&gt;nil, :io_selector_backend=&gt;:auto, :log_requests=&gt;false, :logger=&gt;#&lt;IO:&lt;STDOUT&gt;&gt;, :max_fast_inline=&gt;10, :max_threads=&gt;5, :min_threads=&gt;0, :mode=&gt;:http, :mutate_stdout_and_stderr_to_sync_on_write=&gt;true, :out_of_band=&gt;[], :persistent_timeout=&gt;20, :queue_requests=&gt;true, :rackup=&gt;&quot;config.ru&quot;, :raise_exception_on_sigterm=&gt;true, :reaping_time=&gt;1, :remote_address=&gt;:socket, :silence_single_worker_warning=&gt;false, :silence_fork_callback_warning=&gt;false, :tag=&gt;&quot;app&quot;, :tcp_host=&gt;&quot;0.0.0.0&quot;, :tcp_port=&gt;9292, :wait_for_less_busy_worker=&gt;0.005, :worker_boot_timeout=&gt;60, :worker_check_interval=&gt;5, :worker_culling_strategy=&gt;:youngest, :worker_shutdown_timeout=&gt;30, :worker_timeout=&gt;60, :workers=&gt;0, :http_content_length_limit=&gt;nil, :Verbose=&gt;false, :Silent=&gt;false, :events=&gt;#&lt;Puma::Events:0x00007f37b5332e28 @hooks={:state=&gt;[], :on_booted=&gt;[]}&gt;, :preload_app=&gt;false}, @plugins=[]&gt;&gt;, &quot;rack.tempfiles&quot;=&gt;[], &quot;sinatra.commonlogger&quot;=&gt;true, &quot;rack.logger&quot;=&gt;#&lt;Logger:0x00007f37b5902628 @level=1, @progname=nil, @default_formatter=#&lt;Logger::Formatter:0x00007f37b4b8fb30 @datetime_format=nil&gt;, @formatter=nil, @logdev=#&lt;Logger::LogDevice:0x00007f37b5001600 @shift_period_suffix=nil, @shift_size=nil, @shift_age=nil, @filename=nil, @dev=#&lt;Rack::Lint::ErrorWrapper:0x00007f37b4b8fc70 @error=#&lt;IO:&lt;STDERR&gt;&gt;&gt;, @binmode=false, @mon_data=#&lt;Monitor:0x00007f37b4b8fae0&gt;, @mon_data_owner_object_id=18000&gt;&gt;, &quot;rack.session&quot;=&gt;{&quot;session_id&quot;=&gt;&quot;60b74e15fca8c3792a7679bd7f877f68e64be7263502697594bfbf75e29d0aab&quot;, &quot;csrf&quot;=&gt;&quot;K7SMyJrG_R5TwdId-MRmbYhnrrh5tDZvHRSBPEClbYA=&quot;, &quot;tracking&quot;=&gt;{&quot;HTTP_USER_AGENT&quot;=&gt;&quot;go-http-client&#x2F;1.1&quot;}}, &quot;rack.session.options&quot;=&gt;{:path=&gt;&quot;&#x2F;&quot;, :domain=&gt;nil, :expire_after=&gt;nil, :secure=&gt;false, :httponly=&gt;true, :defer=&gt;false, :renew=&gt;false, :sidbits=&gt;128, :secure_random=&gt;SecureRandom, :secret=&gt;&quot;3497f17e60d812214822aaa69830915a7adc20136c728baa59803aaacb18d243d19434db5f77bcdddb196b400b71f10be8b76ed1ee80205ad01c48d304566336&quot;, :coder=&gt;#&lt;Rack::Protection::EncryptedCookie::Marshal:0x00007f37b5b2d768&gt;}, &quot;rack.request.cookie_hash&quot;=&gt;{}, &quot;rack.session.unpacked_cookie_data&quot;=&gt;{&quot;session_id&quot;=&gt;&quot;60b74e15fca8c3792a7679bd7f877f68e64be7263502697594bfbf75e29d0aab&quot;}, &quot;rack.request.query_string&quot;=&gt;&quot;static=1&amp;iPad=1&quot;, &quot;rack.request.query_hash&quot;=&gt;{&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;}, &quot;sinatra.route&quot;=&gt;&quot;GET &#x2F;singer&#x2F;:singer&quot;, &quot;sinatra.error.params&quot;=&gt;{&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;, &quot;singer&quot;=&gt;&quot;thien&quot;}, &quot;sinatra.error&quot;=&gt;#&lt;NameError: undefined local variable or method `qrcode&#x27; for #&lt;PlaylistPortal:0x00007f37b5001380 ...&gt;&gt;, &quot;sinatra.accept&quot;=&gt;[#&lt;Sinatra::Request::AcceptEntry:0x00007f37b69e9d38 @entry=&quot;*&#x2F;*&quot;, @type=&quot;*&#x2F;*&quot;, @params={}, @q=1.0&gt;]}, @params={&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;, &quot;singer&quot;=&gt;&quot;thien&quot;}, @request=#&lt;Sinatra::Request:0x00007f37b4b8f310 @params={&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;}, @env={&quot;rack.version&quot;=&gt;[1, 6], &quot;rack.errors&quot;=&gt;#&lt;Object:0x00007f37b6b59010&gt;, &quot;rack.multithread&quot;=&gt;true, &quot;rack.multiprocess&quot;=&gt;false, &quot;rack.run_once&quot;=&gt;false, &quot;rack.url_scheme&quot;=&gt;&quot;http&quot;, &quot;SCRIPT_NAME&quot;=&gt;&quot;&#x2F;playlist&quot;, &quot;QUERY_STRING&quot;=&gt;&quot;static=1&amp;iPad=1&quot;, &quot;SERVER_SOFTWARE&quot;=&gt;&quot;puma 6.4.2 The Eagle of Durango&quot;, &quot;GATEWAY_INTERFACE&quot;=&gt;&quot;CGI&#x2F;1.2&quot;, &quot;REQUEST_METHOD&quot;=&gt;&quot;GET&quot;, &quot;REQUEST_PATH&quot;=&gt;&quot;&#x2F;playlist&#x2F;singer&#x2F;thien&quot;, &quot;REQUEST_URI&quot;=&gt;&quot;&#x2F;playlist&#x2F;singer&#x2F;thien?static=1&amp;iPad=1&quot;, &quot;SERVER_PROTOCOL&quot;=&gt;&quot;HTTP&#x2F;1.1&quot;, &quot;HTTP_HOST&quot;=&gt;&quot;localhost:4570&quot;, &quot;HTTP_USER_AGENT&quot;=&gt;&quot;Go-http-client&#x2F;1.1&quot;, &quot;HTTP_ACCEPT_ENCODING&quot;=&gt;&quot;gzip&quot;, &quot;puma.request_body_wait&quot;=&gt;0.006211996078491211, &quot;SERVER_NAME&quot;=&gt;&quot;localhost&quot;, &quot;SERVER_PORT&quot;=&gt;&quot;4570&quot;, &quot;PATH_INFO&quot;=&gt;&quot;&#x2F;singer&#x2F;thien&quot;, &quot;REMOTE_ADDR&quot;=&gt;&quot;127.0.0.1&quot;, &quot;HTTP_VERSION&quot;=&gt;&quot;HTTP&#x2F;1.1&quot;, &quot;puma.socket&quot;=&gt;#&lt;TCPSocket:fd 13, AF_INET, 127.0.0.1, 4570&gt;, &quot;rack.hijack?&quot;=&gt;true, &quot;rack.hijack&quot;=&gt;#&lt;Proc:0x00007f37b4b8fd38 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;lint.rb:553&gt;, &quot;rack.input&quot;=&gt;#&lt;Rack::Lint::InputWrapper:0x00007f37b4b8fc98 @input=#&lt;Puma::NullIO:0x00007f37b51c2ac0&gt;&gt;, &quot;rack.after_reply&quot;=&gt;[], &quot;puma.config&quot;=&gt;#&lt;Puma::Configuration:0x00007f37b4bbc9a0 @options=#&lt;Puma::UserFileDefaultOptions:0x00007f37b53329a0 @user_options={:environment=&gt;&quot;development&quot;, :pid=&gt;nil, :Port=&gt;&quot;4570&quot;, :Host=&gt;&quot;0.0.0.0&quot;, :AccessLog=&gt;[], :config=&gt;&quot;&#x2F;app&#x2F;config.ru&quot;, :quiet=&gt;true, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:4570&quot;], :app=&gt;#&lt;Rack::ContentLength:0x00007f37b52d9620 @app=#&lt;Rack::ShowExceptions:0x00007f37b53105a8 @app=#&lt;Rack::Lint:0x00007f37b5310670 @app=#&lt;Rack::TempfileReaper:0x00007f37b5310738 @app=#&lt;Rack::URLMap:0x00007f37b5b215d0 @known_hosts=#&lt;Set: {}&gt;, @mapping=[[nil, &quot;&#x2F;playlist&quot;, &#x2F;^\&#x2F;+playlist(.*)&#x2F;n, #&lt;PlaylistPortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;images&quot;, &#x2F;^\&#x2F;+images(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d09c0 &#x2F;app&#x2F;config.ru:12 (lambda)&gt;], [nil, &quot;&#x2F;smule&quot;, &#x2F;^\&#x2F;+smule(.*)&#x2F;n, #&lt;SmulePortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;js&quot;, &#x2F;^\&#x2F;+js(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d1028 &#x2F;app&#x2F;config.ru:9 (lambda)&gt;]]&gt;&gt;, @content_length=nil&gt;&gt;&gt;, :log_writer=&gt;#&lt;Puma::LogWriter:0x00007f37b4bbc950 @formatter=#&lt;Puma::LogWriter::DefaultFormatter:0x00007f37b5331848&gt;, @custom_logger=nil, @stdout=#&lt;IO:&lt;STDOUT&gt;&gt;, @stderr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false, @error_logger=#&lt;Puma::ErrorLogger:0x00007f37b5331820 @ioerr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false&gt;&gt;}, @file_options={}, @default_options={:auto_trim_time=&gt;30, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:9292&quot;], :clean_thread_locals=&gt;false, :debug=&gt;false, :early_hints=&gt;nil, :environment=&gt;&quot;development&quot;, :first_data_timeout=&gt;30, :idle_timeout=&gt;nil, :io_selector_backend=&gt;:auto, :log_requests=&gt;false, :logger=&gt;#&lt;IO:&lt;STDOUT&gt;&gt;, :max_fast_inline=&gt;10, :max_threads=&gt;5, :min_threads=&gt;0, :mode=&gt;:http, :mutate_stdout_and_stderr_to_sync_on_write=&gt;true, :out_of_band=&gt;[], :persistent_timeout=&gt;20, :queue_requests=&gt;true, :rackup=&gt;&quot;config.ru&quot;, :raise_exception_on_sigterm=&gt;true, :reaping_time=&gt;1, :remote_address=&gt;:socket, :silence_single_worker_warning=&gt;false, :silence_fork_callback_warning=&gt;false, :tag=&gt;&quot;app&quot;, :tcp_host=&gt;&quot;0.0.0.0&quot;, :tcp_port=&gt;9292, :wait_for_less_busy_worker=&gt;0.005, :worker_boot_timeout=&gt;60, :worker_check_interval=&gt;5, :worker_culling_strategy=&gt;:youngest, :worker_shutdown_timeout=&gt;30, :worker_timeout=&gt;60, :workers=&gt;0, :http_content_length_limit=&gt;nil, :Verbose=&gt;false, :Silent=&gt;false, :events=&gt;#&lt;Puma::Events:0x00007f37b5332e28 @hooks={:state=&gt;[], :on_booted=&gt;[]}&gt;, :preload_app=&gt;false}&gt;, @plugins=#&lt;Puma::PluginLoader:0x00007f37b53328d8 @instances=[]&gt;, @user_dsl=#&lt;Puma::DSL:0x00007f37b53327e8 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={:environment=&gt;&quot;development&quot;, :pid=&gt;nil, :Port=&gt;&quot;4570&quot;, :Host=&gt;&quot;0.0.0.0&quot;, :AccessLog=&gt;[], :config=&gt;&quot;&#x2F;app&#x2F;config.ru&quot;, :quiet=&gt;true, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:4570&quot;], :app=&gt;#&lt;Rack::ContentLength:0x00007f37b52d9620 @app=#&lt;Rack::ShowExceptions:0x00007f37b53105a8 @app=#&lt;Rack::Lint:0x00007f37b5310670 @app=#&lt;Rack::TempfileReaper:0x00007f37b5310738 @app=#&lt;Rack::URLMap:0x00007f37b5b215d0 @known_hosts=#&lt;Set: {}&gt;, @mapping=[[nil, &quot;&#x2F;playlist&quot;, &#x2F;^\&#x2F;+playlist(.*)&#x2F;n, #&lt;PlaylistPortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;images&quot;, &#x2F;^\&#x2F;+images(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d09c0 &#x2F;app&#x2F;config.ru:12 (lambda)&gt;], [nil, &quot;&#x2F;smule&quot;, &#x2F;^\&#x2F;+smule(.*)&#x2F;n, #&lt;SmulePortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;js&quot;, &#x2F;^\&#x2F;+js(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d1028 &#x2F;app&#x2F;config.ru:9 (lambda)&gt;]]&gt;&gt;, @content_length=nil&gt;&gt;&gt;, :log_writer=&gt;#&lt;Puma::LogWriter:0x00007f37b4bbc950 @formatter=#&lt;Puma::LogWriter::DefaultFormatter:0x00007f37b5331848&gt;, @custom_logger=nil, @stdout=#&lt;IO:&lt;STDOUT&gt;&gt;, @stderr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false, @error_logger=#&lt;Puma::ErrorLogger:0x00007f37b5331820 @ioerr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false&gt;&gt;}, @plugins=[]&gt;, @file_dsl=#&lt;Puma::DSL:0x00007f37b5332720 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={}, @plugins=[]&gt;, @default_dsl=#&lt;Puma::DSL:0x00007f37b5332680 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={:auto_trim_time=&gt;30, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:9292&quot;], :clean_thread_locals=&gt;false, :debug=&gt;false, :early_hints=&gt;nil, :environment=&gt;&quot;development&quot;, :first_data_timeout=&gt;30, :idle_timeout=&gt;nil, :io_selector_backend=&gt;:auto, :log_requests=&gt;false, :logger=&gt;#&lt;IO:&lt;STDOUT&gt;&gt;, :max_fast_inline=&gt;10, :max_threads=&gt;5, :min_threads=&gt;0, :mode=&gt;:http, :mutate_stdout_and_stderr_to_sync_on_write=&gt;true, :out_of_band=&gt;[], :persistent_timeout=&gt;20, :queue_requests=&gt;true, :rackup=&gt;&quot;config.ru&quot;, :raise_exception_on_sigterm=&gt;true, :reaping_time=&gt;1, :remote_address=&gt;:socket, :silence_single_worker_warning=&gt;false, :silence_fork_callback_warning=&gt;false, :tag=&gt;&quot;app&quot;, :tcp_host=&gt;&quot;0.0.0.0&quot;, :tcp_port=&gt;9292, :wait_for_less_busy_worker=&gt;0.005, :worker_boot_timeout=&gt;60, :worker_check_interval=&gt;5, :worker_culling_strategy=&gt;:youngest, :worker_shutdown_timeout=&gt;30, :worker_timeout=&gt;60, :workers=&gt;0, :http_content_length_limit=&gt;nil, :Verbose=&gt;false, :Silent=&gt;false, :events=&gt;#&lt;Puma::Events:0x00007f37b5332e28 @hooks={:state=&gt;[], :on_booted=&gt;[]}&gt;, :preload_app=&gt;false}, @plugins=[]&gt;&gt;, &quot;rack.tempfiles&quot;=&gt;[], &quot;sinatra.commonlogger&quot;=&gt;true, &quot;rack.logger&quot;=&gt;#&lt;Logger:0x00007f37b5902628 @level=1, @progname=nil, @default_formatter=#&lt;Logger::Formatter:0x00007f37b4b8fb30 @datetime_format=nil&gt;, @formatter=nil, @logdev=#&lt;Logger::LogDevice:0x00007f37b5001600 @shift_period_suffix=nil, @shift_size=nil, @shift_age=nil, @filename=nil, @dev=#&lt;Rack::Lint::ErrorWrapper:0x00007f37b4b8fc70 @error=#&lt;IO:&lt;STDERR&gt;&gt;&gt;, @binmode=false, @mon_data=#&lt;Monitor:0x00007f37b4b8fae0&gt;, @mon_data_owner_object_id=18000&gt;&gt;, &quot;rack.session&quot;=&gt;{&quot;session_id&quot;=&gt;&quot;60b74e15fca8c3792a7679bd7f877f68e64be7263502697594bfbf75e29d0aab&quot;, &quot;csrf&quot;=&gt;&quot;K7SMyJrG_R5TwdId-MRmbYhnrrh5tDZvHRSBPEClbYA=&quot;, &quot;tracking&quot;=&gt;{&quot;HTTP_USER_AGENT&quot;=&gt;&quot;go-http-client&#x2F;1.1&quot;}}, &quot;rack.session.options&quot;=&gt;{:path=&gt;&quot;&#x2F;&quot;, :domain=&gt;nil, :expire_after=&gt;nil, :secure=&gt;false, :httponly=&gt;true, :defer=&gt;false, :renew=&gt;false, :sidbits=&gt;128, :secure_random=&gt;SecureRandom, :secret=&gt;&quot;3497f17e60d812214822aaa69830915a7adc20136c728baa59803aaacb18d243d19434db5f77bcdddb196b400b71f10be8b76ed1ee80205ad01c48d304566336&quot;, :coder=&gt;#&lt;Rack::Protection::EncryptedCookie::Marshal:0x00007f37b5b2d768&gt;}, &quot;rack.request.cookie_hash&quot;=&gt;{}, &quot;rack.session.unpacked_cookie_data&quot;=&gt;{&quot;session_id&quot;=&gt;&quot;60b74e15fca8c3792a7679bd7f877f68e64be7263502697594bfbf75e29d0aab&quot;}, &quot;rack.request.query_string&quot;=&gt;&quot;static=1&amp;iPad=1&quot;, &quot;rack.request.query_hash&quot;=&gt;{&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;}, &quot;sinatra.route&quot;=&gt;&quot;GET &#x2F;singer&#x2F;:singer&quot;, &quot;sinatra.error.params&quot;=&gt;{&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;, &quot;singer&quot;=&gt;&quot;thien&quot;}, &quot;sinatra.error&quot;=&gt;#&lt;NameError: undefined local variable or method `qrcode&#x27; for #&lt;PlaylistPortal:0x00007f37b5001380 ...&gt;&gt;, &quot;sinatra.accept&quot;=&gt;[#&lt;Sinatra::Request::AcceptEntry:0x00007f37b69e9d38 @entry=&quot;*&#x2F;*&quot;, @type=&quot;*&#x2F;*&quot;, @params={}, @q=1.0&gt;]}&gt;, @response=#&lt;Sinatra::Response:0x00007f37b59023a8 @status=500, @headers={&quot;Access-Control-Allow-Origin&quot;=&gt;&quot;*&quot;}, @writer=#&lt;Method: Sinatra::Response(Rack::Response::Helpers)#append(chunk) &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;response.rb:287&gt;, @block=nil, @body=[], @buffered=true, @length=0&gt;, @isIPhone=nil, @isIPad=&quot;1&quot;, @_out_buf=nil, @content_blocks={:css=&gt;[#&lt;Proc:0x00007f37b38c3e20 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-contrib-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;capture.rb:108&gt;, #&lt;Proc:0x00007f37b5eb4d28 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-contrib-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;capture.rb:108&gt;, #&lt;Proc:0x00007f37b37d8718 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-contrib-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;capture.rb:108&gt;], :javascript=&gt;[#&lt;Proc:0x00007f37b5f4d370 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-contrib-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;capture.rb:108&gt;]}&gt;</h2>
        <ul>
          <li class="first"><strong>file:</strong> <code>
            program.slim</code></li>
          <li><strong>location:</strong> <code>__tilt_17540
            </code></li>
          <li class="last"><strong>line:
            </strong> 159</li>
        </ul>
      </div>
      <div class="clear"></div>
    </div>

    <div id="backtrace" class='condensed'>
      <h3>BACKTRACE</h3>
      <p><a href="#" id="expando"
            onclick="toggleBacktrace(); return false">(expand)</a></p>
      <p id="nav"><strong>JUMP TO:</strong>
         
            <a href="#get-info">GET</a>
            <a href="#post-info">POST</a>
         
         <a href="#cookie-info">COOKIES</a>
         <a href="#env-info">ENV</a>
      </p>
      <div class="clear"></div>

      <ul id="backtrace-ul">

      
      
          

            <li class="frame-info app">
              <code>&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;program.slim</code> in
                <code><strong>__tilt_17540</strong></code>
            </li>

            <li class="code app">
              
              <ol start="152"
                  class="pre-context" id="pre-1"
                  onclick="toggle(1);">
                
                <li class="pre-context-line"><code>            td
</code></li>
                
                <li class="pre-context-line"><code>              .hidden= index
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    button.btn.btn-sm.btn-outline-secondary onClick=&quot;reset_order()&quot; Reset Order 
</code></li>
                
                <li class="pre-context-line"><code>    - unless params[:static]
</code></li>
                
                <li class="pre-context-line"><code>      button.btn.btn-sm.btn-outline-secondary onClick=&quot;sv_save_order()&quot; Save to Server
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="159" class="context" id="1"
                  onclick="toggle(1);">
                <li class="context-line" id="context-1"><code>.qrcode== qrcode</code></li>
              </ol>

              
              <ol start="160" class="post-context"
                  id="post-1" onclick="toggle(1);">
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>script
</code></li>
                
                <li class="post-context-line"><code>  == &quot;extra = &quot; + extra.to_json
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>- content_for :javascript do
</code></li>
                
                <li class="post-context-line"><code>  script src=&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;iframe_api&quot;
</code></li>
                
                <li class="post-context-line"><code>  javascript:
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;tilt-2.4.0&#x2F;lib&#x2F;tilt&#x2F;template.rb</code> in
                <code><strong>bind_call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="200"
                  class="pre-context" id="pre-2"
                  onclick="toggle(2);">
                
                <li class="pre-context-line"><code>        # :nocov:
</code></li>
                
                <li class="pre-context-line"><code>        scope_class = USE_BIND_CALL ? CLASS_METHOD.bind_call(scope) : CLASS_METHOD.bind(scope).call
</code></li>
                
                <li class="pre-context-line"><code>        # :nocov:
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>      method = compiled_method(locals_keys, scope_class)
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      if USE_BIND_CALL
</code></li>
                
              </ol>
              

              <ol start="207" class="context" id="2"
                  onclick="toggle(2);">
                <li class="context-line" id="context-2"><code>        method.bind_call(scope, locals, &amp;block)</code></li>
              </ol>

              
              <ol start="208" class="post-context"
                  id="post-2" onclick="toggle(2);">
                
                <li class="post-context-line"><code>      # :nocov:
</code></li>
                
                <li class="post-context-line"><code>      else
</code></li>
                
                <li class="post-context-line"><code>        method.bind(scope).call(locals, &amp;block)
</code></li>
                
                <li class="post-context-line"><code>      # :nocov:
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;tilt-2.4.0&#x2F;lib&#x2F;tilt&#x2F;template.rb</code> in
                <code><strong>evaluate</strong></code>
            </li>

            <li class="code system">
              
              <ol start="200"
                  class="pre-context" id="pre-3"
                  onclick="toggle(3);">
                
                <li class="pre-context-line"><code>        # :nocov:
</code></li>
                
                <li class="pre-context-line"><code>        scope_class = USE_BIND_CALL ? CLASS_METHOD.bind_call(scope) : CLASS_METHOD.bind(scope).call
</code></li>
                
                <li class="pre-context-line"><code>        # :nocov:
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>      method = compiled_method(locals_keys, scope_class)
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      if USE_BIND_CALL
</code></li>
                
              </ol>
              

              <ol start="207" class="context" id="3"
                  onclick="toggle(3);">
                <li class="context-line" id="context-3"><code>        method.bind_call(scope, locals, &amp;block)</code></li>
              </ol>

              
              <ol start="208" class="post-context"
                  id="post-3" onclick="toggle(3);">
                
                <li class="post-context-line"><code>      # :nocov:
</code></li>
                
                <li class="post-context-line"><code>      else
</code></li>
                
                <li class="post-context-line"><code>        method.bind(scope).call(locals, &amp;block)
</code></li>
                
                <li class="post-context-line"><code>      # :nocov:
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;tilt-2.4.0&#x2F;lib&#x2F;tilt&#x2F;template.rb</code> in
                <code><strong>render</strong></code>
            </li>

            <li class="code system">
              
              <ol start="95"
                  class="pre-context" id="pre-4"
                  onclick="toggle(4);">
                
                <li class="pre-context-line"><code>      prepare
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Render the template in the given scope with the locals specified. If a
</code></li>
                
                <li class="pre-context-line"><code>    # block is given, it is typically available within the template via
</code></li>
                
                <li class="pre-context-line"><code>    # +yield+.
</code></li>
                
                <li class="pre-context-line"><code>    def render(scope=nil, locals=nil, &amp;block)
</code></li>
                
              </ol>
              

              <ol start="102" class="context" id="4"
                  onclick="toggle(4);">
                <li class="context-line" id="context-4"><code>      evaluate(scope || Object.new, locals || EMPTY_HASH, &amp;block)</code></li>
              </ol>

              
              <ol start="103" class="post-context"
                  id="post-4" onclick="toggle(4);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    # The basename of the template file.
</code></li>
                
                <li class="post-context-line"><code>    def basename(suffix=&#x27;&#x27;)
</code></li>
                
                <li class="post-context-line"><code>      File.basename(@file, suffix) if @file
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>render</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="858"
                  class="pre-context" id="pre-5"
                  onclick="toggle(5);">
                
                <li class="pre-context-line"><code>      options[:default_encoding] ||= settings.default_encoding
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      # compile and render template
</code></li>
                
                <li class="pre-context-line"><code>      begin
</code></li>
                
                <li class="pre-context-line"><code>        layout_was      = @default_layout
</code></li>
                
                <li class="pre-context-line"><code>        @default_layout = false
</code></li>
                
                <li class="pre-context-line"><code>        template        = compile_template(engine, data, options, views)
</code></li>
                
              </ol>
              

              <ol start="865" class="context" id="5"
                  onclick="toggle(5);">
                <li class="context-line" id="context-5"><code>        output          = template.render(scope, locals, &amp;block)</code></li>
              </ol>

              
              <ol start="866" class="post-context"
                  id="post-5" onclick="toggle(5);">
                
                <li class="post-context-line"><code>      ensure
</code></li>
                
                <li class="post-context-line"><code>        @default_layout = layout_was
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # render layout
</code></li>
                
                <li class="post-context-line"><code>      if layout
</code></li>
                
                <li class="post-context-line"><code>        extra_options = { views: views, layout: false, eat_errors: eat_errors, scope: scope }
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-contrib-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;engine_tracking.rb</code> in
                <code><strong>block in render</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="90"
                  class="pre-context" id="pre-6"
                  onclick="toggle(6);">
                
                <li class="pre-context-line"><code>    ensure
</code></li>
                
                <li class="pre-context-line"><code>      @current_engine = engine_was
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    private
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def render(engine, *)
</code></li>
                
              </ol>
              

              <ol start="97" class="context" id="6"
                  onclick="toggle(6);">
                <li class="context-line" id="context-6"><code>      with_engine(engine) { super }</code></li>
              </ol>

              
              <ol start="98" class="post-context"
                  id="post-6" onclick="toggle(6);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>  helpers EngineTracking
</code></li>
                
                <li class="post-context-line"><code>end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-contrib-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;engine_tracking.rb</code> in
                <code><strong>with_engine</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="82"
                  class="pre-context" id="pre-7"
                  onclick="toggle(7);">
                
                <li class="pre-context-line"><code>      super
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # @param engine [Symbol, String] Name of Engine to shift to.
</code></li>
                
                <li class="pre-context-line"><code>    def with_engine(engine)
</code></li>
                
                <li class="pre-context-line"><code>      engine_was = @current_engine
</code></li>
                
                <li class="pre-context-line"><code>      @current_engine = engine.to_sym
</code></li>
                
              </ol>
              

              <ol start="89" class="context" id="7"
                  onclick="toggle(7);">
                <li class="context-line" id="context-7"><code>      yield</code></li>
              </ol>

              
              <ol start="90" class="post-context"
                  id="post-7" onclick="toggle(7);">
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      @current_engine = engine_was
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    private
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def render(engine, *)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-contrib-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;engine_tracking.rb</code> in
                <code><strong>render</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="90"
                  class="pre-context" id="pre-8"
                  onclick="toggle(8);">
                
                <li class="pre-context-line"><code>    ensure
</code></li>
                
                <li class="pre-context-line"><code>      @current_engine = engine_was
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    private
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def render(engine, *)
</code></li>
                
              </ol>
              

              <ol start="97" class="context" id="8"
                  onclick="toggle(8);">
                <li class="context-line" id="context-8"><code>      with_engine(engine) { super }</code></li>
              </ol>

              
              <ol start="98" class="post-context"
                  id="post-8" onclick="toggle(8);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>  helpers EngineTracking
</code></li>
                
                <li class="post-context-line"><code>end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>slim</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="793"
                  class="pre-context" id="pre-9"
                  onclick="toggle(9);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def nokogiri(template = nil, options = {}, locals = {}, &amp;block)
</code></li>
                
                <li class="pre-context-line"><code>      options[:default_content_type] = :xml
</code></li>
                
                <li class="pre-context-line"><code>      render_ruby(:nokogiri, template, options, locals, &amp;block)
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def slim(template, options = {}, locals = {}, &amp;block)
</code></li>
                
              </ol>
              

              <ol start="800" class="context" id="9"
                  onclick="toggle(9);">
                <li class="context-line" id="context-9"><code>      render(:slim, template, options, locals, &amp;block)</code></li>
              </ol>

              
              <ol start="801" class="post-context"
                  id="post-9" onclick="toggle(9);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def yajl(template, options = {}, locals = {})
</code></li>
                
                <li class="post-context-line"><code>      options[:default_content_type] = :json
</code></li>
                
                <li class="post-context-line"><code>      render :yajl, template, options, locals
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info app">
              <code>&#x2F;app&#x2F;controllers&#x2F;playlist.rb</code> in
                <code><strong>block in &lt;class:PlaylistPortal&gt;</strong></code>
            </li>

            <li class="code app">
              
              <ol start="191"
                  class="pre-context" id="pre-10"
                  onclick="toggle(10);">
                
                <li class="pre-context-line"><code>  get &#x27;&#x2F;singer&#x2F;:singer&#x27; do |singer|
</code></li>
                
                <li class="pre-context-line"><code>    Plog.info(params: params)
</code></li>
                
                <li class="pre-context-line"><code>    content = get_songs_of(singer)
</code></li>
                
                <li class="pre-context-line"><code>    extra   = get_extra_info(content[:__list])
</code></li>
                
                <li class="pre-context-line"><code>    range   = [0, -1]
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    singers = content[:singers].map { |r| to_stitle(r).downcase }.uniq.sort
</code></li>
                
              </ol>
              

              <ol start="198" class="context" id="10"
                  onclick="toggle(10);">
                <li class="context-line" id="context-10"><code>    slim :program, locals: { program: singer, content: content, range: range,</code></li>
              </ol>

              
              <ol start="199" class="post-context"
                  id="post-10" onclick="toggle(10);">
                
                <li class="post-context-line"><code>                             extra: extra, playlists: singers,
</code></li>
                
                <li class="post-context-line"><code>                             type: :singer, title: &quot;Singer: #{singer}&quot;, }
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>  get &#x27;&#x2F;fragment_upload&#x2F;:user_name&#x2F;:song_id&#x2F;:song_name&#x27; do |_user_name, _song_id, _song_name|
</code></li>
                
                <li class="post-context-line"><code>    locals = params.dup
</code></li>
                
                <li class="post-context-line"><code>    haml :fragment_upload, locals: locals
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1769"
                  class="pre-context" id="pre-11"
                  onclick="toggle(11);">
                
                <li class="pre-context-line"><code>        pattern                 = compile(path, route_mustermann_opts)
</code></li>
                
                <li class="pre-context-line"><code>        method_name             = &quot;#{verb} #{path}&quot;
</code></li>
                
                <li class="pre-context-line"><code>        unbound_method          = generate_method(method_name, &amp;block)
</code></li>
                
                <li class="pre-context-line"><code>        conditions = @conditions
</code></li>
                
                <li class="pre-context-line"><code>        @conditions = []
</code></li>
                
                <li class="pre-context-line"><code>        wrapper = block.arity.zero? ?
</code></li>
                
                <li class="pre-context-line"><code>          proc { |a, _p| unbound_method.bind(a).call } :
</code></li>
                
              </ol>
              

              <ol start="1776" class="context" id="11"
                  onclick="toggle(11);">
                <li class="context-line" id="context-11"><code>          proc { |a, p| unbound_method.bind(a).call(*p) }</code></li>
              </ol>

              
              <ol start="1777" class="post-context"
                  id="post-11" onclick="toggle(11);">
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        [pattern, conditions, wrapper]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def compile(path, route_mustermann_opts = {})
</code></li>
                
                <li class="post-context-line"><code>        Mustermann.new(path, **mustermann_opts.merge(route_mustermann_opts))
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in compile!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1769"
                  class="pre-context" id="pre-12"
                  onclick="toggle(12);">
                
                <li class="pre-context-line"><code>        pattern                 = compile(path, route_mustermann_opts)
</code></li>
                
                <li class="pre-context-line"><code>        method_name             = &quot;#{verb} #{path}&quot;
</code></li>
                
                <li class="pre-context-line"><code>        unbound_method          = generate_method(method_name, &amp;block)
</code></li>
                
                <li class="pre-context-line"><code>        conditions = @conditions
</code></li>
                
                <li class="pre-context-line"><code>        @conditions = []
</code></li>
                
                <li class="pre-context-line"><code>        wrapper = block.arity.zero? ?
</code></li>
                
                <li class="pre-context-line"><code>          proc { |a, _p| unbound_method.bind(a).call } :
</code></li>
                
              </ol>
              

              <ol start="1776" class="context" id="12"
                  onclick="toggle(12);">
                <li class="context-line" id="context-12"><code>          proc { |a, p| unbound_method.bind(a).call(*p) }</code></li>
              </ol>

              
              <ol start="1777" class="post-context"
                  id="post-12" onclick="toggle(12);">
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        [pattern, conditions, wrapper]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def compile(path, route_mustermann_opts = {})
</code></li>
                
                <li class="post-context-line"><code>        Mustermann.new(path, **mustermann_opts.merge(route_mustermann_opts))
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block (3 levels) in route!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1058"
                  class="pre-context" id="pre-13"
                  onclick="toggle(13);">
                
                <li class="pre-context-line"><code>      routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      routes&amp;.each do |pattern, conditions, block|
</code></li>
                
                <li class="pre-context-line"><code>        response.delete_header(&#x27;Content-Type&#x27;) unless @pinned_response
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        returned_pass_block = process_route(pattern, conditions) do |*args|
</code></li>
                
                <li class="pre-context-line"><code>          env[&#x27;sinatra.route&#x27;] = &quot;#{@request.request_method} #{pattern}&quot;
</code></li>
                
              </ol>
              

              <ol start="1065" class="context" id="13"
                  onclick="toggle(13);">
                <li class="context-line" id="context-13"><code>          route_eval { block[*args] }</code></li>
              </ol>

              
              <ol start="1066" class="post-context"
                  id="post-13" onclick="toggle(13);">
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        # don&#x27;t wipe out pass_block in superclass
</code></li>
                
                <li class="post-context-line"><code>        pass_block = returned_pass_block if returned_pass_block
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>route_eval</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1076"
                  class="pre-context" id="pre-14"
                  onclick="toggle(14);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      route_eval(&amp;pass_block) if pass_block
</code></li>
                
                <li class="pre-context-line"><code>      route_missing
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run a route block and throw :halt with the result.
</code></li>
                
                <li class="pre-context-line"><code>    def route_eval
</code></li>
                
              </ol>
              

              <ol start="1083" class="context" id="14"
                  onclick="toggle(14);">
                <li class="context-line" id="context-14"><code>      throw :halt, yield</code></li>
              </ol>

              
              <ol start="1084" class="post-context"
                  id="post-14" onclick="toggle(14);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    # If the current request matches pattern and conditions, fill params
</code></li>
                
                <li class="post-context-line"><code>    # with keys and call the given block.
</code></li>
                
                <li class="post-context-line"><code>    # Revert params afterwards.
</code></li>
                
                <li class="post-context-line"><code>    #
</code></li>
                
                <li class="post-context-line"><code>    # Returns pass block.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block (2 levels) in route!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1058"
                  class="pre-context" id="pre-15"
                  onclick="toggle(15);">
                
                <li class="pre-context-line"><code>      routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      routes&amp;.each do |pattern, conditions, block|
</code></li>
                
                <li class="pre-context-line"><code>        response.delete_header(&#x27;Content-Type&#x27;) unless @pinned_response
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        returned_pass_block = process_route(pattern, conditions) do |*args|
</code></li>
                
                <li class="pre-context-line"><code>          env[&#x27;sinatra.route&#x27;] = &quot;#{@request.request_method} #{pattern}&quot;
</code></li>
                
              </ol>
              

              <ol start="1065" class="context" id="15"
                  onclick="toggle(15);">
                <li class="context-line" id="context-15"><code>          route_eval { block[*args] }</code></li>
              </ol>

              
              <ol start="1066" class="post-context"
                  id="post-15" onclick="toggle(15);">
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        # don&#x27;t wipe out pass_block in superclass
</code></li>
                
                <li class="post-context-line"><code>        pass_block = returned_pass_block if returned_pass_block
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      # Run routes defined in superclass.
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in process_route</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1107"
                  class="pre-context" id="pre-16"
                  onclick="toggle(16);">
                
                <li class="pre-context-line"><code>        @params[:captures] = force_encoding(captures) unless captures.nil? || captures.empty?
</code></li>
                
                <li class="pre-context-line"><code>      else
</code></li>
                
                <li class="pre-context-line"><code>        values += params.values.flatten
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      catch(:pass) do
</code></li>
                
                <li class="pre-context-line"><code>        conditions.each { |c| throw :pass if c.bind(self).call == false }
</code></li>
                
              </ol>
              

              <ol start="1114" class="context" id="16"
                  onclick="toggle(16);">
                <li class="context-line" id="context-16"><code>        block ? block[self, values] : yield(self, values)</code></li>
              </ol>

              
              <ol start="1115" class="post-context"
                  id="post-16" onclick="toggle(16);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    rescue StandardError
</code></li>
                
                <li class="post-context-line"><code>      @env[&#x27;sinatra.error.params&#x27;] = @params
</code></li>
                
                <li class="post-context-line"><code>      raise
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      params ||= {}
</code></li>
                
                <li class="post-context-line"><code>      params.each { |k, _| @params.delete(k) } unless @env[&#x27;sinatra.error.params&#x27;]
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>catch</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1105"
                  class="pre-context" id="pre-17"
                  onclick="toggle(17);">
                
                <li class="pre-context-line"><code>        captures           = pattern.match(route).captures.map { |c| URI_INSTANCE.unescape(c) if c }
</code></li>
                
                <li class="pre-context-line"><code>        values            += captures
</code></li>
                
                <li class="pre-context-line"><code>        @params[:captures] = force_encoding(captures) unless captures.nil? || captures.empty?
</code></li>
                
                <li class="pre-context-line"><code>      else
</code></li>
                
                <li class="pre-context-line"><code>        values += params.values.flatten
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="1112" class="context" id="17"
                  onclick="toggle(17);">
                <li class="context-line" id="context-17"><code>      catch(:pass) do</code></li>
              </ol>

              
              <ol start="1113" class="post-context"
                  id="post-17" onclick="toggle(17);">
                
                <li class="post-context-line"><code>        conditions.each { |c| throw :pass if c.bind(self).call == false }
</code></li>
                
                <li class="post-context-line"><code>        block ? block[self, values] : yield(self, values)
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    rescue StandardError
</code></li>
                
                <li class="post-context-line"><code>      @env[&#x27;sinatra.error.params&#x27;] = @params
</code></li>
                
                <li class="post-context-line"><code>      raise
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>process_route</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1105"
                  class="pre-context" id="pre-18"
                  onclick="toggle(18);">
                
                <li class="pre-context-line"><code>        captures           = pattern.match(route).captures.map { |c| URI_INSTANCE.unescape(c) if c }
</code></li>
                
                <li class="pre-context-line"><code>        values            += captures
</code></li>
                
                <li class="pre-context-line"><code>        @params[:captures] = force_encoding(captures) unless captures.nil? || captures.empty?
</code></li>
                
                <li class="pre-context-line"><code>      else
</code></li>
                
                <li class="pre-context-line"><code>        values += params.values.flatten
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="1112" class="context" id="18"
                  onclick="toggle(18);">
                <li class="context-line" id="context-18"><code>      catch(:pass) do</code></li>
              </ol>

              
              <ol start="1113" class="post-context"
                  id="post-18" onclick="toggle(18);">
                
                <li class="post-context-line"><code>        conditions.each { |c| throw :pass if c.bind(self).call == false }
</code></li>
                
                <li class="post-context-line"><code>        block ? block[self, values] : yield(self, values)
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    rescue StandardError
</code></li>
                
                <li class="post-context-line"><code>      @env[&#x27;sinatra.error.params&#x27;] = @params
</code></li>
                
                <li class="post-context-line"><code>      raise
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in route!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1056"
                  class="pre-context" id="pre-19"
                  onclick="toggle(19);">
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block = nil)
</code></li>
                
                <li class="pre-context-line"><code>      routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      routes&amp;.each do |pattern, conditions, block|
</code></li>
                
                <li class="pre-context-line"><code>        response.delete_header(&#x27;Content-Type&#x27;) unless @pinned_response
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="1063" class="context" id="19"
                  onclick="toggle(19);">
                <li class="context-line" id="context-19"><code>        returned_pass_block = process_route(pattern, conditions) do |*args|</code></li>
              </ol>

              
              <ol start="1064" class="post-context"
                  id="post-19" onclick="toggle(19);">
                
                <li class="post-context-line"><code>          env[&#x27;sinatra.route&#x27;] = &quot;#{@request.request_method} #{pattern}&quot;
</code></li>
                
                <li class="post-context-line"><code>          route_eval { block[*args] }
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        # don&#x27;t wipe out pass_block in superclass
</code></li>
                
                <li class="post-context-line"><code>        pass_block = returned_pass_block if returned_pass_block
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>each</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1053"
                  class="pre-context" id="pre-20"
                  onclick="toggle(20);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block = nil)
</code></li>
                
                <li class="pre-context-line"><code>      routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="1060" class="context" id="20"
                  onclick="toggle(20);">
                <li class="context-line" id="context-20"><code>      routes&amp;.each do |pattern, conditions, block|</code></li>
              </ol>

              
              <ol start="1061" class="post-context"
                  id="post-20" onclick="toggle(20);">
                
                <li class="post-context-line"><code>        response.delete_header(&#x27;Content-Type&#x27;) unless @pinned_response
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        returned_pass_block = process_route(pattern, conditions) do |*args|
</code></li>
                
                <li class="post-context-line"><code>          env[&#x27;sinatra.route&#x27;] = &quot;#{@request.request_method} #{pattern}&quot;
</code></li>
                
                <li class="post-context-line"><code>          route_eval { block[*args] }
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>route!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1053"
                  class="pre-context" id="pre-21"
                  onclick="toggle(21);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run routes defined on the class and all superclasses.
</code></li>
                
                <li class="pre-context-line"><code>    def route!(base = settings, pass_block = nil)
</code></li>
                
                <li class="pre-context-line"><code>      routes = base.routes[@request.request_method]
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="1060" class="context" id="21"
                  onclick="toggle(21);">
                <li class="context-line" id="context-21"><code>      routes&amp;.each do |pattern, conditions, block|</code></li>
              </ol>

              
              <ol start="1061" class="post-context"
                  id="post-21" onclick="toggle(21);">
                
                <li class="post-context-line"><code>        response.delete_header(&#x27;Content-Type&#x27;) unless @pinned_response
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        returned_pass_block = process_route(pattern, conditions) do |*args|
</code></li>
                
                <li class="post-context-line"><code>          env[&#x27;sinatra.route&#x27;] = &quot;#{@request.request_method} #{pattern}&quot;
</code></li>
                
                <li class="post-context-line"><code>          route_eval { block[*args] }
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in dispatch!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1177"
                  class="pre-context" id="pre-22"
                  onclick="toggle(22);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      invoke do
</code></li>
                
                <li class="pre-context-line"><code>        static! if settings.static? &amp;&amp; (request.get? || request.head?)
</code></li>
                
                <li class="pre-context-line"><code>        filter! :before do
</code></li>
                
                <li class="pre-context-line"><code>          @pinned_response = !response[&#x27;Content-Type&#x27;].nil?
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
              </ol>
              

              <ol start="1184" class="context" id="22"
                  onclick="toggle(22);">
                <li class="context-line" id="context-22"><code>        route!</code></li>
              </ol>

              
              <ol start="1185" class="post-context"
                  id="post-22" onclick="toggle(22);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    rescue ::Exception =&gt; e
</code></li>
                
                <li class="post-context-line"><code>      invoke { handle_exception!(e) }
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      begin
</code></li>
                
                <li class="post-context-line"><code>        filter! :after unless env[&#x27;sinatra.static_file&#x27;]
</code></li>
                
                <li class="post-context-line"><code>      rescue ::Exception =&gt; e
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>catch</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1148"
                  class="pre-context" id="pre-23"
                  onclick="toggle(23);">
                
                <li class="pre-context-line"><code>      env[&#x27;sinatra.static_file&#x27;] = path
</code></li>
                
                <li class="pre-context-line"><code>      cache_control(*settings.static_cache_control) if settings.static_cache_control?
</code></li>
                
                <li class="pre-context-line"><code>      send_file path, options.merge(disposition: nil)
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run the block with &#x27;throw :halt&#x27; support and apply result to the response.
</code></li>
                
                <li class="pre-context-line"><code>    def invoke(&amp;block)
</code></li>
                
              </ol>
              

              <ol start="1155" class="context" id="23"
                  onclick="toggle(23);">
                <li class="context-line" id="context-23"><code>      res = catch(:halt, &amp;block)</code></li>
              </ol>

              
              <ol start="1156" class="post-context"
                  id="post-23" onclick="toggle(23);">
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      res = [res] if (Integer === res) || (String === res)
</code></li>
                
                <li class="post-context-line"><code>      if (Array === res) &amp;&amp; (Integer === res.first)
</code></li>
                
                <li class="post-context-line"><code>        res = res.dup
</code></li>
                
                <li class="post-context-line"><code>        status(res.shift)
</code></li>
                
                <li class="post-context-line"><code>        body(res.pop)
</code></li>
                
                <li class="post-context-line"><code>        headers(*res)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>invoke</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1148"
                  class="pre-context" id="pre-24"
                  onclick="toggle(24);">
                
                <li class="pre-context-line"><code>      env[&#x27;sinatra.static_file&#x27;] = path
</code></li>
                
                <li class="pre-context-line"><code>      cache_control(*settings.static_cache_control) if settings.static_cache_control?
</code></li>
                
                <li class="pre-context-line"><code>      send_file path, options.merge(disposition: nil)
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run the block with &#x27;throw :halt&#x27; support and apply result to the response.
</code></li>
                
                <li class="pre-context-line"><code>    def invoke(&amp;block)
</code></li>
                
              </ol>
              

              <ol start="1155" class="context" id="24"
                  onclick="toggle(24);">
                <li class="context-line" id="context-24"><code>      res = catch(:halt, &amp;block)</code></li>
              </ol>

              
              <ol start="1156" class="post-context"
                  id="post-24" onclick="toggle(24);">
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      res = [res] if (Integer === res) || (String === res)
</code></li>
                
                <li class="post-context-line"><code>      if (Array === res) &amp;&amp; (Integer === res.first)
</code></li>
                
                <li class="post-context-line"><code>        res = res.dup
</code></li>
                
                <li class="post-context-line"><code>        status(res.shift)
</code></li>
                
                <li class="post-context-line"><code>        body(res.pop)
</code></li>
                
                <li class="post-context-line"><code>        headers(*res)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>dispatch!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1172"
                  class="pre-context" id="pre-25"
                  onclick="toggle(25);">
                
                <li class="pre-context-line"><code>      @params.merge!(@request.params).each do |key, val|
</code></li>
                
                <li class="pre-context-line"><code>        next unless val.respond_to?(:force_encoding)
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        val = val.dup if val.frozen?
</code></li>
                
                <li class="pre-context-line"><code>        @params[key] = force_encoding(val)
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="1179" class="context" id="25"
                  onclick="toggle(25);">
                <li class="context-line" id="context-25"><code>      invoke do</code></li>
              </ol>

              
              <ol start="1180" class="post-context"
                  id="post-25" onclick="toggle(25);">
                
                <li class="post-context-line"><code>        static! if settings.static? &amp;&amp; (request.get? || request.head?)
</code></li>
                
                <li class="post-context-line"><code>        filter! :before do
</code></li>
                
                <li class="post-context-line"><code>          @pinned_response = !response[&#x27;Content-Type&#x27;].nil?
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>        route!
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    rescue ::Exception =&gt; e
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>block in call!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="988"
                  class="pre-context" id="pre-26"
                  onclick="toggle(26);">
                
                <li class="pre-context-line"><code>      @env      = env
</code></li>
                
                <li class="pre-context-line"><code>      @params   = IndifferentHash.new
</code></li>
                
                <li class="pre-context-line"><code>      @request  = Request.new(env)
</code></li>
                
                <li class="pre-context-line"><code>      @response = Response.new
</code></li>
                
                <li class="pre-context-line"><code>      @pinned_response = nil
</code></li>
                
                <li class="pre-context-line"><code>      template_cache.clear if settings.reload_templates
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="995" class="context" id="26"
                  onclick="toggle(26);">
                <li class="context-line" id="context-26"><code>      invoke { dispatch! }</code></li>
              </ol>

              
              <ol start="996" class="post-context"
                  id="post-26" onclick="toggle(26);">
                
                <li class="post-context-line"><code>      invoke { error_block!(response.status) } unless @env[&#x27;sinatra.error&#x27;]
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      unless @response[&#x27;Content-Type&#x27;]
</code></li>
                
                <li class="post-context-line"><code>        if Array === body &amp;&amp; body[0].respond_to?(:content_type)
</code></li>
                
                <li class="post-context-line"><code>          content_type body[0].content_type
</code></li>
                
                <li class="post-context-line"><code>        elsif (default = settings.default_content_type)
</code></li>
                
                <li class="post-context-line"><code>          content_type default
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>catch</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1148"
                  class="pre-context" id="pre-27"
                  onclick="toggle(27);">
                
                <li class="pre-context-line"><code>      env[&#x27;sinatra.static_file&#x27;] = path
</code></li>
                
                <li class="pre-context-line"><code>      cache_control(*settings.static_cache_control) if settings.static_cache_control?
</code></li>
                
                <li class="pre-context-line"><code>      send_file path, options.merge(disposition: nil)
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run the block with &#x27;throw :halt&#x27; support and apply result to the response.
</code></li>
                
                <li class="pre-context-line"><code>    def invoke(&amp;block)
</code></li>
                
              </ol>
              

              <ol start="1155" class="context" id="27"
                  onclick="toggle(27);">
                <li class="context-line" id="context-27"><code>      res = catch(:halt, &amp;block)</code></li>
              </ol>

              
              <ol start="1156" class="post-context"
                  id="post-27" onclick="toggle(27);">
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      res = [res] if (Integer === res) || (String === res)
</code></li>
                
                <li class="post-context-line"><code>      if (Array === res) &amp;&amp; (Integer === res.first)
</code></li>
                
                <li class="post-context-line"><code>        res = res.dup
</code></li>
                
                <li class="post-context-line"><code>        status(res.shift)
</code></li>
                
                <li class="post-context-line"><code>        body(res.pop)
</code></li>
                
                <li class="post-context-line"><code>        headers(*res)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>invoke</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="1148"
                  class="pre-context" id="pre-28"
                  onclick="toggle(28);">
                
                <li class="pre-context-line"><code>      env[&#x27;sinatra.static_file&#x27;] = path
</code></li>
                
                <li class="pre-context-line"><code>      cache_control(*settings.static_cache_control) if settings.static_cache_control?
</code></li>
                
                <li class="pre-context-line"><code>      send_file path, options.merge(disposition: nil)
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Run the block with &#x27;throw :halt&#x27; support and apply result to the response.
</code></li>
                
                <li class="pre-context-line"><code>    def invoke(&amp;block)
</code></li>
                
              </ol>
              

              <ol start="1155" class="context" id="28"
                  onclick="toggle(28);">
                <li class="context-line" id="context-28"><code>      res = catch(:halt, &amp;block)</code></li>
              </ol>

              
              <ol start="1156" class="post-context"
                  id="post-28" onclick="toggle(28);">
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      res = [res] if (Integer === res) || (String === res)
</code></li>
                
                <li class="post-context-line"><code>      if (Array === res) &amp;&amp; (Integer === res.first)
</code></li>
                
                <li class="post-context-line"><code>        res = res.dup
</code></li>
                
                <li class="post-context-line"><code>        status(res.shift)
</code></li>
                
                <li class="post-context-line"><code>        body(res.pop)
</code></li>
                
                <li class="post-context-line"><code>        headers(*res)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call!</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="988"
                  class="pre-context" id="pre-29"
                  onclick="toggle(29);">
                
                <li class="pre-context-line"><code>      @env      = env
</code></li>
                
                <li class="pre-context-line"><code>      @params   = IndifferentHash.new
</code></li>
                
                <li class="pre-context-line"><code>      @request  = Request.new(env)
</code></li>
                
                <li class="pre-context-line"><code>      @response = Response.new
</code></li>
                
                <li class="pre-context-line"><code>      @pinned_response = nil
</code></li>
                
                <li class="pre-context-line"><code>      template_cache.clear if settings.reload_templates
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="995" class="context" id="29"
                  onclick="toggle(29);">
                <li class="context-line" id="context-29"><code>      invoke { dispatch! }</code></li>
              </ol>

              
              <ol start="996" class="post-context"
                  id="post-29" onclick="toggle(29);">
                
                <li class="post-context-line"><code>      invoke { error_block!(response.status) } unless @env[&#x27;sinatra.error&#x27;]
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      unless @response[&#x27;Content-Type&#x27;]
</code></li>
                
                <li class="post-context-line"><code>        if Array === body &amp;&amp; body[0].respond_to?(:content_type)
</code></li>
                
                <li class="post-context-line"><code>          content_type body[0].content_type
</code></li>
                
                <li class="post-context-line"><code>        elsif (default = settings.default_content_type)
</code></li>
                
                <li class="post-context-line"><code>          content_type default
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="977"
                  class="pre-context" id="pre-30"
                  onclick="toggle(30);">
                
                <li class="pre-context-line"><code>      @template_cache = TemplateCache.new
</code></li>
                
                <li class="pre-context-line"><code>      @pinned_response = nil # whether a before! filter pinned the content-type
</code></li>
                
                <li class="pre-context-line"><code>      yield self if block_given?
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    # Rack call interface.
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
              </ol>
              

              <ol start="984" class="context" id="30"
                  onclick="toggle(30);">
                <li class="context-line" id="context-30"><code>      dup.call!(env)</code></li>
              </ol>

              
              <ol start="985" class="post-context"
                  id="post-30" onclick="toggle(30);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def call!(env) # :nodoc:
</code></li>
                
                <li class="post-context-line"><code>      @env      = env
</code></li>
                
                <li class="post-context-line"><code>      @params   = IndifferentHash.new
</code></li>
                
                <li class="post-context-line"><code>      @request  = Request.new(env)
</code></li>
                
                <li class="post-context-line"><code>      @response = Response.new
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-protection-3.2.0&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;xss_header.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="13"
                  class="pre-context" id="pre-31"
                  onclick="toggle(31);">
                
                <li class="pre-context-line"><code>    #
</code></li>
                
                <li class="pre-context-line"><code>    # Options:
</code></li>
                
                <li class="pre-context-line"><code>    # xss_mode:: How the browser should prevent the attack (default: :block)
</code></li>
                
                <li class="pre-context-line"><code>    class XSSHeader &lt; Base
</code></li>
                
                <li class="pre-context-line"><code>      default_options xss_mode: :block, nosniff: true
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
              </ol>
              

              <ol start="20" class="context" id="31"
                  onclick="toggle(31);">
                <li class="context-line" id="context-31"><code>        status, headers, body = @app.call(env)</code></li>
              </ol>

              
              <ol start="21" class="post-context"
                  id="post-31" onclick="toggle(31);">
                
                <li class="post-context-line"><code>        headers[&#x27;X-XSS-Protection&#x27;]       ||= &quot;1; mode=#{options[:xss_mode]}&quot; if html? headers
</code></li>
                
                <li class="post-context-line"><code>        headers[&#x27;X-Content-Type-Options&#x27;] ||= &#x27;nosniff&#x27;                       if options[:nosniff]
</code></li>
                
                <li class="post-context-line"><code>        [status, headers, body]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-protection-3.2.0&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="46"
                  class="pre-context" id="pre-32"
                  onclick="toggle(32);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
                <li class="pre-context-line"><code>        unless accepts? env
</code></li>
                
                <li class="pre-context-line"><code>          instrument env
</code></li>
                
                <li class="pre-context-line"><code>          result = react env
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
              </ol>
              

              <ol start="53" class="context" id="32"
                  onclick="toggle(32);">
                <li class="context-line" id="context-32"><code>        result or app.call(env)</code></li>
              </ol>

              
              <ol start="54" class="post-context"
                  id="post-32" onclick="toggle(32);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def react(env)
</code></li>
                
                <li class="post-context-line"><code>        result = send(options[:reaction], env)
</code></li>
                
                <li class="post-context-line"><code>        result if (Array === result) &amp;&amp; (result.size == 3)
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-protection-3.2.0&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="46"
                  class="pre-context" id="pre-33"
                  onclick="toggle(33);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
                <li class="pre-context-line"><code>        unless accepts? env
</code></li>
                
                <li class="pre-context-line"><code>          instrument env
</code></li>
                
                <li class="pre-context-line"><code>          result = react env
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
              </ol>
              

              <ol start="53" class="context" id="33"
                  onclick="toggle(33);">
                <li class="context-line" id="context-33"><code>        result or app.call(env)</code></li>
              </ol>

              
              <ol start="54" class="post-context"
                  id="post-33" onclick="toggle(33);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def react(env)
</code></li>
                
                <li class="post-context-line"><code>        result = send(options[:reaction], env)
</code></li>
                
                <li class="post-context-line"><code>        result if (Array === result) &amp;&amp; (result.size == 3)
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-protection-3.2.0&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;path_traversal.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="11"
                  class="pre-context" id="pre-34"
                  onclick="toggle(34);">
                
                <li class="pre-context-line"><code>    #
</code></li>
                
                <li class="pre-context-line"><code>    # Unescapes &#x27;&#x2F;&#x27; and &#x27;.&#x27;, expands +path_info+.
</code></li>
                
                <li class="pre-context-line"><code>    # Thus &lt;tt&gt;GET &#x2F;foo&#x2F;%2e%2e%2fbar&lt;&#x2F;tt&gt; becomes &lt;tt&gt;GET &#x2F;bar&lt;&#x2F;tt&gt;.
</code></li>
                
                <li class="pre-context-line"><code>    class PathTraversal &lt; Base
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
                <li class="pre-context-line"><code>        path_was         = env[&#x27;PATH_INFO&#x27;]
</code></li>
                
                <li class="pre-context-line"><code>        env[&#x27;PATH_INFO&#x27;] = cleanup path_was if path_was &amp;&amp; !path_was.empty?
</code></li>
                
              </ol>
              

              <ol start="18" class="context" id="34"
                  onclick="toggle(34);">
                <li class="context-line" id="context-34"><code>        app.call env</code></li>
              </ol>

              
              <ol start="19" class="post-context"
                  id="post-34" onclick="toggle(34);">
                
                <li class="post-context-line"><code>      ensure
</code></li>
                
                <li class="post-context-line"><code>        env[&#x27;PATH_INFO&#x27;] = path_was
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def cleanup(path)
</code></li>
                
                <li class="post-context-line"><code>        encoding = path.encoding
</code></li>
                
                <li class="post-context-line"><code>        dot   = &#x27;.&#x27;.encode(encoding)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-protection-3.2.0&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;json_csrf.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="21"
                  class="pre-context" id="pre-35"
                  onclick="toggle(35);">
                
                <li class="pre-context-line"><code>    class JsonCsrf &lt; Base
</code></li>
                
                <li class="pre-context-line"><code>      default_options allow_if: nil
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      alias react deny
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
                <li class="pre-context-line"><code>        request               = Request.new(env)
</code></li>
                
              </ol>
              

              <ol start="28" class="context" id="35"
                  onclick="toggle(35);">
                <li class="context-line" id="context-35"><code>        status, headers, body = app.call(env)</code></li>
              </ol>

              
              <ol start="29" class="post-context"
                  id="post-35" onclick="toggle(35);">
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        if has_vector?(request, headers)
</code></li>
                
                <li class="post-context-line"><code>          warn env, &quot;attack prevented by #{self.class}&quot;
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>          react_and_close(env, body) or [status, headers, body]
</code></li>
                
                <li class="post-context-line"><code>        else
</code></li>
                
                <li class="post-context-line"><code>          [status, headers, body]
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-protection-3.2.0&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="46"
                  class="pre-context" id="pre-36"
                  onclick="toggle(36);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
                <li class="pre-context-line"><code>        unless accepts? env
</code></li>
                
                <li class="pre-context-line"><code>          instrument env
</code></li>
                
                <li class="pre-context-line"><code>          result = react env
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
              </ol>
              

              <ol start="53" class="context" id="36"
                  onclick="toggle(36);">
                <li class="context-line" id="context-36"><code>        result or app.call(env)</code></li>
              </ol>

              
              <ol start="54" class="post-context"
                  id="post-36" onclick="toggle(36);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def react(env)
</code></li>
                
                <li class="post-context-line"><code>        result = send(options[:reaction], env)
</code></li>
                
                <li class="post-context-line"><code>        result if (Array === result) &amp;&amp; (result.size == 3)
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-protection-3.2.0&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="46"
                  class="pre-context" id="pre-37"
                  onclick="toggle(37);">
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
                <li class="pre-context-line"><code>        unless accepts? env
</code></li>
                
                <li class="pre-context-line"><code>          instrument env
</code></li>
                
                <li class="pre-context-line"><code>          result = react env
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
              </ol>
              

              <ol start="53" class="context" id="37"
                  onclick="toggle(37);">
                <li class="context-line" id="context-37"><code>        result or app.call(env)</code></li>
              </ol>

              
              <ol start="54" class="post-context"
                  id="post-37" onclick="toggle(37);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      def react(env)
</code></li>
                
                <li class="post-context-line"><code>        result = send(options[:reaction], env)
</code></li>
                
                <li class="post-context-line"><code>        result if (Array === result) &amp;&amp; (result.size == 3)
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-protection-3.2.0&#x2F;lib&#x2F;rack&#x2F;protection&#x2F;frame_options.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="26"
                  class="pre-context" id="pre-38"
                  onclick="toggle(38);">
                
                <li class="pre-context-line"><code>          frame_options = options[:frame_options]
</code></li>
                
                <li class="pre-context-line"><code>          frame_options = options[:frame_options].to_s.upcase unless frame_options.respond_to? :to_str
</code></li>
                
                <li class="pre-context-line"><code>          frame_options.to_str
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
              </ol>
              

              <ol start="33" class="context" id="38"
                  onclick="toggle(38);">
                <li class="context-line" id="context-38"><code>        status, headers, body        = @app.call(env)</code></li>
              </ol>

              
              <ol start="34" class="post-context"
                  id="post-38" onclick="toggle(38);">
                
                <li class="post-context-line"><code>        headers[&#x27;X-Frame-Options&#x27;] ||= frame_options if html? headers
</code></li>
                
                <li class="post-context-line"><code>        [status, headers, body]
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;session&#x2F;abstract&#x2F;id.rb</code> in
                <code><strong>context</strong></code>
            </li>

            <li class="code system">
              
              <ol start="259"
                  class="pre-context" id="pre-39"
                  onclick="toggle(39);">
                
                <li class="pre-context-line"><code>        def call(env)
</code></li>
                
                <li class="pre-context-line"><code>          context(env)
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        def context(env, app = @app)
</code></li>
                
                <li class="pre-context-line"><code>          req = make_request env
</code></li>
                
                <li class="pre-context-line"><code>          prepare_session(req)
</code></li>
                
              </ol>
              

              <ol start="266" class="context" id="39"
                  onclick="toggle(39);">
                <li class="context-line" id="context-39"><code>          status, headers, body = app.call(req.env)</code></li>
              </ol>

              
              <ol start="267" class="post-context"
                  id="post-39" onclick="toggle(39);">
                
                <li class="post-context-line"><code>          res = Rack::Response::Raw.new status, headers
</code></li>
                
                <li class="post-context-line"><code>          commit_session(req, res)
</code></li>
                
                <li class="post-context-line"><code>          [status, headers, body]
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        private
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;session&#x2F;abstract&#x2F;id.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="253"
                  class="pre-context" id="pre-40"
                  onclick="toggle(40);">
                
                <li class="pre-context-line"><code>          @key = @default_options.delete(:key)
</code></li>
                
                <li class="pre-context-line"><code>          @cookie_only = @default_options.delete(:cookie_only)
</code></li>
                
                <li class="pre-context-line"><code>          @same_site = @default_options.delete(:same_site)
</code></li>
                
                <li class="pre-context-line"><code>          initialize_sid
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        def call(env)
</code></li>
                
              </ol>
              

              <ol start="260" class="context" id="40"
                  onclick="toggle(40);">
                <li class="context-line" id="context-40"><code>          context(env)</code></li>
              </ol>

              
              <ol start="261" class="post-context"
                  id="post-40" onclick="toggle(40);">
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        def context(env, app = @app)
</code></li>
                
                <li class="post-context-line"><code>          req = make_request env
</code></li>
                
                <li class="post-context-line"><code>          prepare_session(req)
</code></li>
                
                <li class="post-context-line"><code>          status, headers, body = app.call(req.env)
</code></li>
                
                <li class="post-context-line"><code>          res = Rack::Response::Raw.new status, headers
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;logger.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="10"
                  class="pre-context" id="pre-41"
                  onclick="toggle(41);">
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
                <li class="pre-context-line"><code>      logger = ::Logger.new(env[RACK_ERRORS])
</code></li>
                
                <li class="pre-context-line"><code>      logger.level = @level
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      env[RACK_LOGGER] = logger
</code></li>
                
              </ol>
              

              <ol start="17" class="context" id="41"
                  onclick="toggle(41);">
                <li class="context-line" id="context-41"><code>      @app.call(env)</code></li>
              </ol>

              
              <ol start="18" class="post-context"
                  id="post-41" onclick="toggle(41);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;common_logger.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="31"
                  class="pre-context" id="pre-42"
                  onclick="toggle(42);">
                
                <li class="pre-context-line"><code>    # will not be logged, so if exception handling middleware are used,
</code></li>
                
                <li class="pre-context-line"><code>    # they should be loaded after this middleware.  Additionally, because
</code></li>
                
                <li class="pre-context-line"><code>    # the logging happens after the request body has been fully sent, any
</code></li>
                
                <li class="pre-context-line"><code>    # exceptions raised during the sending of the response body will
</code></li>
                
                <li class="pre-context-line"><code>    # cause the request not to be logged.
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
                <li class="pre-context-line"><code>      began_at = Utils.clock_time
</code></li>
                
              </ol>
              

              <ol start="38" class="context" id="42"
                  onclick="toggle(42);">
                <li class="context-line" id="context-42"><code>      status, headers, body = @app.call(env)</code></li>
              </ol>

              
              <ol start="39" class="post-context"
                  id="post-42" onclick="toggle(42);">
                
                <li class="post-context-line"><code>      headers = Utils::HeaderHash[headers]
</code></li>
                
                <li class="post-context-line"><code>      body = BodyProxy.new(body) { log(env, status, headers, began_at) }
</code></li>
                
                <li class="post-context-line"><code>      [status, headers, body]
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    private
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="254"
                  class="pre-context" id="pre-43"
                  onclick="toggle(43);">
                
                <li class="pre-context-line"><code>      env[&#x27;sinatra.commonlogger&#x27;] ? @app.call(env) : super
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    superclass.class_eval do
</code></li>
                
                <li class="pre-context-line"><code>      alias_method :call_without_check, :call unless method_defined? :call_without_check
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
                <li class="pre-context-line"><code>        env[&#x27;sinatra.commonlogger&#x27;] = true
</code></li>
                
              </ol>
              

              <ol start="261" class="context" id="43"
                  onclick="toggle(43);">
                <li class="context-line" id="context-43"><code>        call_without_check(env)</code></li>
              </ol>

              
              <ol start="262" class="post-context"
                  id="post-43" onclick="toggle(43);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>  class Error &lt; StandardError # :nodoc:
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="247"
                  class="pre-context" id="pre-44"
                  onclick="toggle(44);">
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>  end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>  # Behaves exactly like Rack::CommonLogger with the notable exception that it does nothing,
</code></li>
                
                <li class="pre-context-line"><code>  # if another CommonLogger is already in the middleware chain.
</code></li>
                
                <li class="pre-context-line"><code>  class CommonLogger &lt; Rack::CommonLogger
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
              </ol>
              

              <ol start="254" class="context" id="44"
                  onclick="toggle(44);">
                <li class="context-line" id="context-44"><code>      env[&#x27;sinatra.commonlogger&#x27;] ? @app.call(env) : super</code></li>
              </ol>

              
              <ol start="255" class="post-context"
                  id="post-44" onclick="toggle(44);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    superclass.class_eval do
</code></li>
                
                <li class="post-context-line"><code>      alias_method :call_without_check, :call unless method_defined? :call_without_check
</code></li>
                
                <li class="post-context-line"><code>      def call(env)
</code></li>
                
                <li class="post-context-line"><code>        env[&#x27;sinatra.commonlogger&#x27;] = true
</code></li>
                
                <li class="post-context-line"><code>        call_without_check(env)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;head.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="5"
                  class="pre-context" id="pre-45"
                  onclick="toggle(45);">
                
                <li class="pre-context-line"><code>  # all other requests unchanged.
</code></li>
                
                <li class="pre-context-line"><code>  class Head
</code></li>
                
                <li class="pre-context-line"><code>    def initialize(app)
</code></li>
                
                <li class="pre-context-line"><code>      @app = app
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
              </ol>
              

              <ol start="12" class="context" id="45"
                  onclick="toggle(45);">
                <li class="context-line" id="context-45"><code>      status, headers, body = @app.call(env)</code></li>
              </ol>

              
              <ol start="13" class="post-context"
                  id="post-45" onclick="toggle(45);">
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      if env[REQUEST_METHOD] == HEAD
</code></li>
                
                <li class="post-context-line"><code>        [
</code></li>
                
                <li class="post-context-line"><code>          status, headers, Rack::BodyProxy.new([]) do
</code></li>
                
                <li class="post-context-line"><code>            body.close if body.respond_to? :close
</code></li>
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        ]
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;show_exceptions.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="16"
                  class="pre-context" id="pre-46"
                  onclick="toggle(46);">
                
                <li class="pre-context-line"><code>    def @@eats_errors.puts(*) end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def initialize(app)
</code></li>
                
                <li class="pre-context-line"><code>      @app = app
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
              </ol>
              

              <ol start="23" class="context" id="46"
                  onclick="toggle(46);">
                <li class="context-line" id="context-46"><code>      @app.call(env)</code></li>
              </ol>

              
              <ol start="24" class="post-context"
                  id="post-46" onclick="toggle(46);">
                
                <li class="post-context-line"><code>    rescue Exception =&gt; e
</code></li>
                
                <li class="post-context-line"><code>      errors = env[&#x27;rack.errors&#x27;]
</code></li>
                
                <li class="post-context-line"><code>      env[&#x27;rack.errors&#x27;] = @@eats_errors
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      if prefers_plain_text?(env)
</code></li>
                
                <li class="post-context-line"><code>        content_type = &#x27;text&#x2F;plain&#x27;
</code></li>
                
                <li class="post-context-line"><code>        body = dump_exception(e)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="212"
                  class="pre-context" id="pre-47"
                  onclick="toggle(47);">
                
                <li class="pre-context-line"><code>  # Some Rack handlers implement an extended body object protocol, however,
</code></li>
                
                <li class="pre-context-line"><code>  # some middleware (namely Rack::Lint) will break it by not mirroring the methods in question.
</code></li>
                
                <li class="pre-context-line"><code>  # This middleware will detect an extended body object and will make sure it reaches the
</code></li>
                
                <li class="pre-context-line"><code>  # handler directly. We do this here, so our middleware and middleware set up by the app will
</code></li>
                
                <li class="pre-context-line"><code>  # still be able to run.
</code></li>
                
                <li class="pre-context-line"><code>  class ExtendedRack &lt; Struct.new(:app)
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
              </ol>
              

              <ol start="219" class="context" id="47"
                  onclick="toggle(47);">
                <li class="context-line" id="context-47"><code>      result = app.call(env)</code></li>
              </ol>

              
              <ol start="220" class="post-context"
                  id="post-47" onclick="toggle(47);">
                
                <li class="post-context-line"><code>      callback = env[&#x27;async.callback&#x27;]
</code></li>
                
                <li class="post-context-line"><code>      return result unless callback &amp;&amp; async?(*result)
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      after_response { callback.call result }
</code></li>
                
                <li class="post-context-line"><code>      setup_close(env, *result)
</code></li>
                
                <li class="post-context-line"><code>      throw :async
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info framework">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;base.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code framework">
              
              <ol start="2079"
                  class="pre-context" id="pre-48"
                  onclick="toggle(48);">
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def helpers
</code></li>
                
                <li class="pre-context-line"><code>      @instance
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
              </ol>
              

              <ol start="2086" class="context" id="48"
                  onclick="toggle(48);">
                <li class="context-line" id="context-48"><code>      @stack.call(env)</code></li>
              </ol>

              
              <ol start="2087" class="post-context"
                  id="post-48" onclick="toggle(48);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def inspect
</code></li>
                
                <li class="post-context-line"><code>      &quot;#&lt;#{@instance.class} app_file=#{settings.app_file.inspect}&gt;&quot;
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;urlmap.rb</code> in
                <code><strong>block in call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="67"
                  class="pre-context" id="pre-49"
                  onclick="toggle(49);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        rest = m[1]
</code></li>
                
                <li class="pre-context-line"><code>        next unless !rest || rest.empty? || rest[0] == ?&#x2F;
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        env[SCRIPT_NAME] = (script_name + location)
</code></li>
                
                <li class="pre-context-line"><code>        env[PATH_INFO] = rest
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="74" class="context" id="49"
                  onclick="toggle(49);">
                <li class="context-line" id="context-49"><code>        return app.call(env)</code></li>
              </ol>

              
              <ol start="75" class="post-context"
                  id="post-49" onclick="toggle(49);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      [404, { CONTENT_TYPE =&gt; &quot;text&#x2F;plain&quot;, &quot;X-Cascade&quot; =&gt; &quot;pass&quot; }, [&quot;Not Found: #{path}&quot;]]
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      env[PATH_INFO]   = path
</code></li>
                
                <li class="post-context-line"><code>      env[SCRIPT_NAME] = script_name
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;urlmap.rb</code> in
                <code><strong>each</strong></code>
            </li>

            <li class="code system">
              
              <ol start="51"
                  class="pre-context" id="pre-50"
                  onclick="toggle(50);">
                
                <li class="pre-context-line"><code>      server_port = env[SERVER_PORT]
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      is_same_server = casecmp?(http_host, server_name) ||
</code></li>
                
                <li class="pre-context-line"><code>                       casecmp?(http_host, &quot;#{server_name}:#{server_port}&quot;)
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      is_host_known = @known_hosts.include? http_host
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="58" class="context" id="50"
                  onclick="toggle(50);">
                <li class="context-line" id="context-50"><code>      @mapping.each do |host, location, match, app|</code></li>
              </ol>

              
              <ol start="59" class="post-context"
                  id="post-50" onclick="toggle(50);">
                
                <li class="post-context-line"><code>        unless casecmp?(http_host, host) \
</code></li>
                
                <li class="post-context-line"><code>            || casecmp?(server_name, host) \
</code></li>
                
                <li class="post-context-line"><code>            || (!host &amp;&amp; is_same_server) \
</code></li>
                
                <li class="post-context-line"><code>            || (!host &amp;&amp; !is_host_known) # If we don&#x27;t have a matching host, default to the first without a specified host
</code></li>
                
                <li class="post-context-line"><code>          next
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;urlmap.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="51"
                  class="pre-context" id="pre-51"
                  onclick="toggle(51);">
                
                <li class="pre-context-line"><code>      server_port = env[SERVER_PORT]
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      is_same_server = casecmp?(http_host, server_name) ||
</code></li>
                
                <li class="pre-context-line"><code>                       casecmp?(http_host, &quot;#{server_name}:#{server_port}&quot;)
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      is_host_known = @known_hosts.include? http_host
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="58" class="context" id="51"
                  onclick="toggle(51);">
                <li class="context-line" id="context-51"><code>      @mapping.each do |host, location, match, app|</code></li>
              </ol>

              
              <ol start="59" class="post-context"
                  id="post-51" onclick="toggle(51);">
                
                <li class="post-context-line"><code>        unless casecmp?(http_host, host) \
</code></li>
                
                <li class="post-context-line"><code>            || casecmp?(server_name, host) \
</code></li>
                
                <li class="post-context-line"><code>            || (!host &amp;&amp; is_same_server) \
</code></li>
                
                <li class="post-context-line"><code>            || (!host &amp;&amp; !is_host_known) # If we don&#x27;t have a matching host, default to the first without a specified host
</code></li>
                
                <li class="post-context-line"><code>          next
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;tempfile_reaper.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="8"
                  class="pre-context" id="pre-52"
                  onclick="toggle(52);">
                
                <li class="pre-context-line"><code>  class TempfileReaper
</code></li>
                
                <li class="pre-context-line"><code>    def initialize(app)
</code></li>
                
                <li class="pre-context-line"><code>      @app = app
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
                <li class="pre-context-line"><code>      env[RACK_TEMPFILES] ||= []
</code></li>
                
              </ol>
              

              <ol start="15" class="context" id="52"
                  onclick="toggle(52);">
                <li class="context-line" id="context-52"><code>      status, headers, body = @app.call(env)</code></li>
              </ol>

              
              <ol start="16" class="post-context"
                  id="post-52" onclick="toggle(52);">
                
                <li class="post-context-line"><code>      body_proxy = BodyProxy.new(body) do
</code></li>
                
                <li class="post-context-line"><code>        env[RACK_TEMPFILES].each(&amp;:close!) unless env[RACK_TEMPFILES].nil?
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>      [status, headers, body_proxy]
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>  end
</code></li>
                
                <li class="post-context-line"><code>end
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;lint.rb</code> in
                <code><strong>_call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="43"
                  class="pre-context" id="pre-53"
                  onclick="toggle(53);">
                
                <li class="pre-context-line"><code>      raise LintError, &quot;No env given&quot; unless env
</code></li>
                
                <li class="pre-context-line"><code>      check_env env
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      env[RACK_INPUT] = InputWrapper.new(env[RACK_INPUT])
</code></li>
                
                <li class="pre-context-line"><code>      env[RACK_ERRORS] = ErrorWrapper.new(env[RACK_ERRORS])
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      ## and returns an Array of exactly three values:
</code></li>
                
              </ol>
              

              <ol start="50" class="context" id="53"
                  onclick="toggle(53);">
                <li class="context-line" id="context-53"><code>      ary = @app.call(env)</code></li>
              </ol>

              
              <ol start="51" class="post-context"
                  id="post-53" onclick="toggle(53);">
                
                <li class="post-context-line"><code>      raise LintError, &quot;response is not an Array, but #{ary.class}&quot; unless ary.kind_of? Array
</code></li>
                
                <li class="post-context-line"><code>      raise LintError, &quot;response array has #{ary.size} elements instead of 3&quot; unless ary.size == 3
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      status, headers, @body = ary
</code></li>
                
                <li class="post-context-line"><code>      ## The *status*,
</code></li>
                
                <li class="post-context-line"><code>      check_status status
</code></li>
                
                <li class="post-context-line"><code>      ## the *headers*,
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;lint.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="31"
                  class="pre-context" id="pre-54"
                  onclick="toggle(54);">
                
                <li class="pre-context-line"><code>    ## after to catch all mistakes.
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    ## = Rack applications
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    ## A Rack application is a Ruby object (not a class) that
</code></li>
                
                <li class="pre-context-line"><code>    ## responds to +call+.
</code></li>
                
                <li class="pre-context-line"><code>    def call(env = nil)
</code></li>
                
              </ol>
              

              <ol start="38" class="context" id="54"
                  onclick="toggle(54);">
                <li class="context-line" id="context-54"><code>      dup._call(env)</code></li>
              </ol>

              
              <ol start="39" class="post-context"
                  id="post-54" onclick="toggle(54);">
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    def _call(env)
</code></li>
                
                <li class="post-context-line"><code>      ## It takes exactly one argument, the *environment*
</code></li>
                
                <li class="post-context-line"><code>      raise LintError, &quot;No env given&quot; unless env
</code></li>
                
                <li class="post-context-line"><code>      check_env env
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;show_exceptions.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="16"
                  class="pre-context" id="pre-55"
                  onclick="toggle(55);">
                
                <li class="pre-context-line"><code>    CONTEXT = 7
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def initialize(app)
</code></li>
                
                <li class="pre-context-line"><code>      @app = app
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
              </ol>
              

              <ol start="23" class="context" id="55"
                  onclick="toggle(55);">
                <li class="context-line" id="context-55"><code>      @app.call(env)</code></li>
              </ol>

              
              <ol start="24" class="post-context"
                  id="post-55" onclick="toggle(55);">
                
                <li class="post-context-line"><code>    rescue StandardError, LoadError, SyntaxError =&gt; e
</code></li>
                
                <li class="post-context-line"><code>      exception_string = dump_exception(e)
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      env[RACK_ERRORS].puts(exception_string)
</code></li>
                
                <li class="post-context-line"><code>      env[RACK_ERRORS].flush
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      if accepts_html?(env)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;content_length.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="10"
                  class="pre-context" id="pre-56"
                  onclick="toggle(56);">
                
                <li class="pre-context-line"><code>    include Rack::Utils
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def initialize(app)
</code></li>
                
                <li class="pre-context-line"><code>      @app = app
</code></li>
                
                <li class="pre-context-line"><code>    end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>    def call(env)
</code></li>
                
              </ol>
              

              <ol start="17" class="context" id="56"
                  onclick="toggle(56);">
                <li class="context-line" id="context-56"><code>      status, headers, body = @app.call(env)</code></li>
              </ol>

              
              <ol start="18" class="post-context"
                  id="post-56" onclick="toggle(56);">
                
                <li class="post-context-line"><code>      headers = HeaderHash[headers]
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      if !STATUS_WITH_NO_ENTITY_BODY.key?(status.to_i) &amp;&amp;
</code></li>
                
                <li class="post-context-line"><code>         !headers[CONTENT_LENGTH] &amp;&amp;
</code></li>
                
                <li class="post-context-line"><code>         !headers[TRANSFER_ENCODING]
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        obody = body
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;puma-6.4.2&#x2F;lib&#x2F;puma&#x2F;configuration.rb</code> in
                <code><strong>call</strong></code>
            </li>

            <li class="code system">
              
              <ol start="265"
                  class="pre-context" id="pre-57"
                  onclick="toggle(57);">
                
                <li class="pre-context-line"><code>      def initialize(config, app)
</code></li>
                
                <li class="pre-context-line"><code>        @config = config
</code></li>
                
                <li class="pre-context-line"><code>        @app = app
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      def call(env)
</code></li>
                
                <li class="pre-context-line"><code>        env[Const::PUMA_CONFIG] = @config
</code></li>
                
              </ol>
              

              <ol start="272" class="context" id="57"
                  onclick="toggle(57);">
                <li class="context-line" id="context-57"><code>        @app.call(env)</code></li>
              </ol>

              
              <ol start="273" class="post-context"
                  id="post-57" onclick="toggle(57);">
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    # Indicate if there is a properly configured app
</code></li>
                
                <li class="post-context-line"><code>    #
</code></li>
                
                <li class="post-context-line"><code>    def app_configured?
</code></li>
                
                <li class="post-context-line"><code>      @options[:app] || File.exist?(rackup)
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;puma-6.4.2&#x2F;lib&#x2F;puma&#x2F;request.rb</code> in
                <code><strong>block in handle_request</strong></code>
            </li>

            <li class="code system">
              
              <ol start="93"
                  class="pre-context" id="pre-58"
                  onclick="toggle(58);">
                
                <li class="pre-context-line"><code>      # array, we will invoke them when the request is done.
</code></li>
                
                <li class="pre-context-line"><code>      #
</code></li>
                
                <li class="pre-context-line"><code>      env[RACK_AFTER_REPLY] ||= []
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      begin
</code></li>
                
                <li class="pre-context-line"><code>        if @supported_http_methods == :any || @supported_http_methods.key?(env[REQUEST_METHOD])
</code></li>
                
                <li class="pre-context-line"><code>          status, headers, app_body = @thread_pool.with_force_shutdown do
</code></li>
                
              </ol>
              

              <ol start="100" class="context" id="58"
                  onclick="toggle(58);">
                <li class="context-line" id="context-58"><code>            @app.call(env)</code></li>
              </ol>

              
              <ol start="101" class="post-context"
                  id="post-58" onclick="toggle(58);">
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        else
</code></li>
                
                <li class="post-context-line"><code>          @log_writer.log &quot;Unsupported HTTP method used: #{env[REQUEST_METHOD]}&quot;
</code></li>
                
                <li class="post-context-line"><code>          status, headers, app_body = [501, {}, [&quot;#{env[REQUEST_METHOD]} method is not supported&quot;]]
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>        # app_body needs to always be closed, hold value in case lowlevel_error
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;puma-6.4.2&#x2F;lib&#x2F;puma&#x2F;thread_pool.rb</code> in
                <code><strong>with_force_shutdown</strong></code>
            </li>

            <li class="code system">
              
              <ol start="371"
                  class="pre-context" id="pre-59"
                  onclick="toggle(59);">
                
                <li class="pre-context-line"><code>    # provided block if the thread is forced to shutdown during execution.
</code></li>
                
                <li class="pre-context-line"><code>    def with_force_shutdown
</code></li>
                
                <li class="pre-context-line"><code>      t = Thread.current
</code></li>
                
                <li class="pre-context-line"><code>      @shutdown_mutex.synchronize do
</code></li>
                
                <li class="pre-context-line"><code>        raise ForceShutdown if @force_shutdown
</code></li>
                
                <li class="pre-context-line"><code>        t[:with_force_shutdown] = true
</code></li>
                
                <li class="pre-context-line"><code>      end
</code></li>
                
              </ol>
              

              <ol start="378" class="context" id="59"
                  onclick="toggle(59);">
                <li class="context-line" id="context-59"><code>      yield</code></li>
              </ol>

              
              <ol start="379" class="post-context"
                  id="post-59" onclick="toggle(59);">
                
                <li class="post-context-line"><code>    ensure
</code></li>
                
                <li class="post-context-line"><code>      t[:with_force_shutdown] = false
</code></li>
                
                <li class="post-context-line"><code>    end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>    # Tell all threads in the pool to exit and wait for them to finish.
</code></li>
                
                <li class="post-context-line"><code>    # Wait +timeout+ seconds then raise +ForceShutdown+ in remaining threads.
</code></li>
                
                <li class="post-context-line"><code>    # Next, wait an extra +@shutdown_grace_time+ seconds then force-kill remaining
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;puma-6.4.2&#x2F;lib&#x2F;puma&#x2F;request.rb</code> in
                <code><strong>handle_request</strong></code>
            </li>

            <li class="code system">
              
              <ol start="92"
                  class="pre-context" id="pre-60"
                  onclick="toggle(60);">
                
                <li class="pre-context-line"><code>      # A rack extension. If the app writes #call&#x27;ables to this
</code></li>
                
                <li class="pre-context-line"><code>      # array, we will invoke them when the request is done.
</code></li>
                
                <li class="pre-context-line"><code>      #
</code></li>
                
                <li class="pre-context-line"><code>      env[RACK_AFTER_REPLY] ||= []
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      begin
</code></li>
                
                <li class="pre-context-line"><code>        if @supported_http_methods == :any || @supported_http_methods.key?(env[REQUEST_METHOD])
</code></li>
                
              </ol>
              

              <ol start="99" class="context" id="60"
                  onclick="toggle(60);">
                <li class="context-line" id="context-60"><code>          status, headers, app_body = @thread_pool.with_force_shutdown do</code></li>
              </ol>

              
              <ol start="100" class="post-context"
                  id="post-60" onclick="toggle(60);">
                
                <li class="post-context-line"><code>            @app.call(env)
</code></li>
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        else
</code></li>
                
                <li class="post-context-line"><code>          @log_writer.log &quot;Unsupported HTTP method used: #{env[REQUEST_METHOD]}&quot;
</code></li>
                
                <li class="post-context-line"><code>          status, headers, app_body = [501, {}, [&quot;#{env[REQUEST_METHOD]} method is not supported&quot;]]
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;puma-6.4.2&#x2F;lib&#x2F;puma&#x2F;server.rb</code> in
                <code><strong>process_client</strong></code>
            </li>

            <li class="code system">
              
              <ol start="457"
                  class="pre-context" id="pre-61"
                  onclick="toggle(61);">
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        with_force_shutdown(client) do
</code></li>
                
                <li class="pre-context-line"><code>          client.finish(@first_data_timeout)
</code></li>
                
                <li class="pre-context-line"><code>        end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>        while true
</code></li>
                
                <li class="pre-context-line"><code>          @requests_count += 1
</code></li>
                
              </ol>
              

              <ol start="464" class="context" id="61"
                  onclick="toggle(61);">
                <li class="context-line" id="context-61"><code>          case handle_request(client, requests + 1)</code></li>
              </ol>

              
              <ol start="465" class="post-context"
                  id="post-61" onclick="toggle(61);">
                
                <li class="post-context-line"><code>          when false
</code></li>
                
                <li class="post-context-line"><code>            break
</code></li>
                
                <li class="post-context-line"><code>          when :async
</code></li>
                
                <li class="post-context-line"><code>            close_socket = false
</code></li>
                
                <li class="post-context-line"><code>            break
</code></li>
                
                <li class="post-context-line"><code>          when true
</code></li>
                
                <li class="post-context-line"><code>            ThreadPool.clean_thread_locals if clean_thread_locals
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;puma-6.4.2&#x2F;lib&#x2F;puma&#x2F;server.rb</code> in
                <code><strong>block in run</strong></code>
            </li>

            <li class="code system">
              
              <ol start="238"
                  class="pre-context" id="pre-62"
                  onclick="toggle(62);">
                
                <li class="pre-context-line"><code>    def run(background=true, thread_name: &#x27;srv&#x27;)
</code></li>
                
                <li class="pre-context-line"><code>      BasicSocket.do_not_reverse_lookup = true
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      @events.fire :state, :booting
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>      @status = :run
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
              </ol>
              

              <ol start="245" class="context" id="62"
                  onclick="toggle(62);">
                <li class="context-line" id="context-62"><code>      @thread_pool = ThreadPool.new(thread_name, @options) { |client| process_client client }</code></li>
              </ol>

              
              <ol start="246" class="post-context"
                  id="post-62" onclick="toggle(62);">
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      if @queue_requests
</code></li>
                
                <li class="post-context-line"><code>        @reactor = Reactor.new(@io_selector_backend) { |c| reactor_wakeup c }
</code></li>
                
                <li class="post-context-line"><code>        @reactor.run
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      
          

            <li class="frame-info system">
              <code>&#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;puma-6.4.2&#x2F;lib&#x2F;puma&#x2F;thread_pool.rb</code> in
                <code><strong>block in spawn_thread</strong></code>
            </li>

            <li class="code system">
              
              <ol start="148"
                  class="pre-context" id="pre-63"
                  onclick="toggle(63);">
                
                <li class="pre-context-line"><code>          end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>          if @clean_thread_locals
</code></li>
                
                <li class="pre-context-line"><code>            ThreadPool.clean_thread_locals
</code></li>
                
                <li class="pre-context-line"><code>          end
</code></li>
                
                <li class="pre-context-line"><code>
</code></li>
                
                <li class="pre-context-line"><code>          begin
</code></li>
                
              </ol>
              

              <ol start="155" class="context" id="63"
                  onclick="toggle(63);">
                <li class="context-line" id="context-63"><code>            @out_of_band_pending = true if block.call(work)</code></li>
              </ol>

              
              <ol start="156" class="post-context"
                  id="post-63" onclick="toggle(63);">
                
                <li class="post-context-line"><code>          rescue Exception =&gt; e
</code></li>
                
                <li class="post-context-line"><code>            STDERR.puts &quot;Error reached top of thread-pool: #{e.message} (#{e.class})&quot;
</code></li>
                
                <li class="post-context-line"><code>          end
</code></li>
                
                <li class="post-context-line"><code>        end
</code></li>
                
                <li class="post-context-line"><code>      end
</code></li>
                
                <li class="post-context-line"><code>
</code></li>
                
                <li class="post-context-line"><code>      @workers &lt;&lt; th
</code></li>
                
              </ol>
              
              <div class="clear"></div>
            </li>

          

        
      

      </ul>
    </div> <!-- /BACKTRACE -->

    
      <div id="get">
        <h3 id="get-info">GET</h3>
        
          <table class="req">
            <tr>
              <th>Variable</th>
              <th>Value</th>
            </tr>
             
            <tr>
              <td>iPad</td>
              <td class="code"><div>&quot;1&quot;</div></td>
            </tr>
            
            <tr>
              <td>static</td>
              <td class="code"><div>&quot;1&quot;</div></td>
            </tr>
            
          </table>
        
        <div class="clear"></div>
      </div> <!-- /GET -->

      <div id="post">
        <h3 id="post-info">POST</h3>
        
          <p class="no-data">No POST data.</p>
        
        <div class="clear"></div>
      </div> <!-- /POST -->
    

    <div id="cookies">
      <h3 id="cookie-info">COOKIES</h3>
      
        <p class="no-data">No cookie data.</p>
      
      <div class="clear"></div>
    </div> <!-- /COOKIES -->

    <div id="rack">
      <h3 id="env-info">Rack ENV</h3>
      <table class="req">
        <tr>
          <th>Variable</th>
          <th>Value</th>
        </tr>
         
         <tr>
           <td>GATEWAY_INTERFACE</td>
           <td class="code"><div>CGI&#x2F;1.2</div></td>
         </tr>
         
         <tr>
           <td>HTTP_ACCEPT_ENCODING</td>
           <td class="code"><div>gzip</div></td>
         </tr>
         
         <tr>
           <td>HTTP_HOST</td>
           <td class="code"><div>localhost:4570</div></td>
         </tr>
         
         <tr>
           <td>HTTP_USER_AGENT</td>
           <td class="code"><div>Go-http-client&#x2F;1.1</div></td>
         </tr>
         
         <tr>
           <td>HTTP_VERSION</td>
           <td class="code"><div>HTTP&#x2F;1.1</div></td>
         </tr>
         
         <tr>
           <td>PATH_INFO</td>
           <td class="code"><div>&#x2F;singer&#x2F;thien</div></td>
         </tr>
         
         <tr>
           <td>QUERY_STRING</td>
           <td class="code"><div>static=1&amp;iPad=1</div></td>
         </tr>
         
         <tr>
           <td>REMOTE_ADDR</td>
           <td class="code"><div>127.0.0.1</div></td>
         </tr>
         
         <tr>
           <td>REQUEST_METHOD</td>
           <td class="code"><div>GET</div></td>
         </tr>
         
         <tr>
           <td>REQUEST_PATH</td>
           <td class="code"><div>&#x2F;playlist&#x2F;singer&#x2F;thien</div></td>
         </tr>
         
         <tr>
           <td>REQUEST_URI</td>
           <td class="code"><div>&#x2F;playlist&#x2F;singer&#x2F;thien?static=1&amp;iPad=1</div></td>
         </tr>
         
         <tr>
           <td>SCRIPT_NAME</td>
           <td class="code"><div>&#x2F;playlist</div></td>
         </tr>
         
         <tr>
           <td>SERVER_NAME</td>
           <td class="code"><div>localhost</div></td>
         </tr>
         
         <tr>
           <td>SERVER_PORT</td>
           <td class="code"><div>4570</div></td>
         </tr>
         
         <tr>
           <td>SERVER_PROTOCOL</td>
           <td class="code"><div>HTTP&#x2F;1.1</div></td>
         </tr>
         
         <tr>
           <td>SERVER_SOFTWARE</td>
           <td class="code"><div>puma 6.4.2 The Eagle of Durango</div></td>
         </tr>
         
         <tr>
           <td>puma.config</td>
           <td class="code"><div>#&lt;Puma::Configuration:0x00007f37b4bbc9a0 @options=#&lt;Puma::UserFileDefaultOptions:0x00007f37b53329a0 @user_options={:environment=&gt;&quot;development&quot;, :pid=&gt;nil, :Port=&gt;&quot;4570&quot;, :Host=&gt;&quot;0.0.0.0&quot;, :AccessLog=&gt;[], :config=&gt;&quot;&#x2F;app&#x2F;config.ru&quot;, :quiet=&gt;true, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:4570&quot;], :app=&gt;#&lt;Rack::ContentLength:0x00007f37b52d9620 @app=#&lt;Rack::ShowExceptions:0x00007f37b53105a8 @app=#&lt;Rack::Lint:0x00007f37b5310670 @app=#&lt;Rack::TempfileReaper:0x00007f37b5310738 @app=#&lt;Rack::URLMap:0x00007f37b5b215d0 @known_hosts=#&lt;Set: {}&gt;, @mapping=[[nil, &quot;&#x2F;playlist&quot;, &#x2F;^\&#x2F;+playlist(.*)&#x2F;n, #&lt;PlaylistPortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;images&quot;, &#x2F;^\&#x2F;+images(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d09c0 &#x2F;app&#x2F;config.ru:12 (lambda)&gt;], [nil, &quot;&#x2F;smule&quot;, &#x2F;^\&#x2F;+smule(.*)&#x2F;n, #&lt;SmulePortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;js&quot;, &#x2F;^\&#x2F;+js(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d1028 &#x2F;app&#x2F;config.ru:9 (lambda)&gt;]]&gt;&gt;, @content_length=nil&gt;&gt;&gt;, :log_writer=&gt;#&lt;Puma::LogWriter:0x00007f37b4bbc950 @formatter=#&lt;Puma::LogWriter::DefaultFormatter:0x00007f37b5331848&gt;, @custom_logger=nil, @stdout=#&lt;IO:&lt;STDOUT&gt;&gt;, @stderr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false, @error_logger=#&lt;Puma::ErrorLogger:0x00007f37b5331820 @ioerr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false&gt;&gt;}, @file_options={}, @default_options={:auto_trim_time=&gt;30, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:9292&quot;], :clean_thread_locals=&gt;false, :debug=&gt;false, :early_hints=&gt;nil, :environment=&gt;&quot;development&quot;, :first_data_timeout=&gt;30, :idle_timeout=&gt;nil, :io_selector_backend=&gt;:auto, :log_requests=&gt;false, :logger=&gt;#&lt;IO:&lt;STDOUT&gt;&gt;, :max_fast_inline=&gt;10, :max_threads=&gt;5, :min_threads=&gt;0, :mode=&gt;:http, :mutate_stdout_and_stderr_to_sync_on_write=&gt;true, :out_of_band=&gt;[], :persistent_timeout=&gt;20, :queue_requests=&gt;true, :rackup=&gt;&quot;config.ru&quot;, :raise_exception_on_sigterm=&gt;true, :reaping_time=&gt;1, :remote_address=&gt;:socket, :silence_single_worker_warning=&gt;false, :silence_fork_callback_warning=&gt;false, :tag=&gt;&quot;app&quot;, :tcp_host=&gt;&quot;0.0.0.0&quot;, :tcp_port=&gt;9292, :wait_for_less_busy_worker=&gt;0.005, :worker_boot_timeout=&gt;60, :worker_check_interval=&gt;5, :worker_culling_strategy=&gt;:youngest, :worker_shutdown_timeout=&gt;30, :worker_timeout=&gt;60, :workers=&gt;0, :http_content_length_limit=&gt;nil, :Verbose=&gt;false, :Silent=&gt;false, :events=&gt;#&lt;Puma::Events:0x00007f37b5332e28 @hooks={:state=&gt;[], :on_booted=&gt;[]}&gt;, :preload_app=&gt;false}&gt;, @plugins=#&lt;Puma::PluginLoader:0x00007f37b53328d8 @instances=[]&gt;, @user_dsl=#&lt;Puma::DSL:0x00007f37b53327e8 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={:environment=&gt;&quot;development&quot;, :pid=&gt;nil, :Port=&gt;&quot;4570&quot;, :Host=&gt;&quot;0.0.0.0&quot;, :AccessLog=&gt;[], :config=&gt;&quot;&#x2F;app&#x2F;config.ru&quot;, :quiet=&gt;true, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:4570&quot;], :app=&gt;#&lt;Rack::ContentLength:0x00007f37b52d9620 @app=#&lt;Rack::ShowExceptions:0x00007f37b53105a8 @app=#&lt;Rack::Lint:0x00007f37b5310670 @app=#&lt;Rack::TempfileReaper:0x00007f37b5310738 @app=#&lt;Rack::URLMap:0x00007f37b5b215d0 @known_hosts=#&lt;Set: {}&gt;, @mapping=[[nil, &quot;&#x2F;playlist&quot;, &#x2F;^\&#x2F;+playlist(.*)&#x2F;n, #&lt;PlaylistPortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;images&quot;, &#x2F;^\&#x2F;+images(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d09c0 &#x2F;app&#x2F;config.ru:12 (lambda)&gt;], [nil, &quot;&#x2F;smule&quot;, &#x2F;^\&#x2F;+smule(.*)&#x2F;n, #&lt;SmulePortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;js&quot;, &#x2F;^\&#x2F;+js(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d1028 &#x2F;app&#x2F;config.ru:9 (lambda)&gt;]]&gt;&gt;, @content_length=nil&gt;&gt;&gt;, :log_writer=&gt;#&lt;Puma::LogWriter:0x00007f37b4bbc950 @formatter=#&lt;Puma::LogWriter::DefaultFormatter:0x00007f37b5331848&gt;, @custom_logger=nil, @stdout=#&lt;IO:&lt;STDOUT&gt;&gt;, @stderr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false, @error_logger=#&lt;Puma::ErrorLogger:0x00007f37b5331820 @ioerr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false&gt;&gt;}, @plugins=[]&gt;, @file_dsl=#&lt;Puma::DSL:0x00007f37b5332720 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={}, @plugins=[]&gt;, @default_dsl=#&lt;Puma::DSL:0x00007f37b5332680 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={:auto_trim_time=&gt;30, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:9292&quot;], :clean_thread_locals=&gt;false, :debug=&gt;false, :early_hints=&gt;nil, :environment=&gt;&quot;development&quot;, :first_data_timeout=&gt;30, :idle_timeout=&gt;nil, :io_selector_backend=&gt;:auto, :log_requests=&gt;false, :logger=&gt;#&lt;IO:&lt;STDOUT&gt;&gt;, :max_fast_inline=&gt;10, :max_threads=&gt;5, :min_threads=&gt;0, :mode=&gt;:http, :mutate_stdout_and_stderr_to_sync_on_write=&gt;true, :out_of_band=&gt;[], :persistent_timeout=&gt;20, :queue_requests=&gt;true, :rackup=&gt;&quot;config.ru&quot;, :raise_exception_on_sigterm=&gt;true, :reaping_time=&gt;1, :remote_address=&gt;:socket, :silence_single_worker_warning=&gt;false, :silence_fork_callback_warning=&gt;false, :tag=&gt;&quot;app&quot;, :tcp_host=&gt;&quot;0.0.0.0&quot;, :tcp_port=&gt;9292, :wait_for_less_busy_worker=&gt;0.005, :worker_boot_timeout=&gt;60, :worker_check_interval=&gt;5, :worker_culling_strategy=&gt;:youngest, :worker_shutdown_timeout=&gt;30, :worker_timeout=&gt;60, :workers=&gt;0, :http_content_length_limit=&gt;nil, :Verbose=&gt;false, :Silent=&gt;false, :events=&gt;#&lt;Puma::Events:0x00007f37b5332e28 @hooks={:state=&gt;[], :on_booted=&gt;[]}&gt;, :preload_app=&gt;false}, @plugins=[]&gt;&gt;</div></td>
         </tr>
         
         <tr>
           <td>puma.request_body_wait</td>
           <td class="code"><div>0.006211996078491211</div></td>
         </tr>
         
         <tr>
           <td>puma.socket</td>
           <td class="code"><div>#&lt;TCPSocket:fd 13, AF_INET, 127.0.0.1, 4570&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.after_reply</td>
           <td class="code"><div>[]</div></td>
         </tr>
         
         <tr>
           <td>rack.errors</td>
           <td class="code"><div>#&lt;Object:0x00007f37b6b59010&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.hijack</td>
           <td class="code"><div>#&lt;Proc:0x00007f37b4b8fd38 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;lint.rb:553&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.hijack?</td>
           <td class="code"><div>true</div></td>
         </tr>
         
         <tr>
           <td>rack.input</td>
           <td class="code"><div>#&lt;Rack::Lint::InputWrapper:0x00007f37b4b8fc98 @input=#&lt;Puma::NullIO:0x00007f37b51c2ac0&gt;&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.logger</td>
           <td class="code"><div>#&lt;Logger:0x00007f37b5902628 @level=1, @progname=nil, @default_formatter=#&lt;Logger::Formatter:0x00007f37b4b8fb30 @datetime_format=nil&gt;, @formatter=nil, @logdev=#&lt;Logger::LogDevice:0x00007f37b5001600 @shift_period_suffix=nil, @shift_size=nil, @shift_age=nil, @filename=nil, @dev=#&lt;Rack::Lint::ErrorWrapper:0x00007f37b4b8fc70 @error=#&lt;IO:&lt;STDERR&gt;&gt;&gt;, @binmode=false, @mon_data=#&lt;Monitor:0x00007f37b4b8fae0&gt;, @mon_data_owner_object_id=18000&gt;&gt;</div></td>
         </tr>
         
         <tr>
           <td>rack.multiprocess</td>
           <td class="code"><div>false</div></td>
         </tr>
         
         <tr>
           <td>rack.multithread</td>
           <td class="code"><div>true</div></td>
         </tr>
         
         <tr>
           <td>rack.request.cookie_hash</td>
           <td class="code"><div>{}</div></td>
         </tr>
         
         <tr>
           <td>rack.request.query_hash</td>
           <td class="code"><div>{&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;}</div></td>
         </tr>
         
         <tr>
           <td>rack.request.query_string</td>
           <td class="code"><div>static=1&amp;iPad=1</div></td>
         </tr>
         
         <tr>
           <td>rack.run_once</td>
           <td class="code"><div>false</div></td>
         </tr>
         
         <tr>
           <td>rack.session</td>
           <td class="code"><div>{&quot;session_id&quot;=&gt;&quot;60b74e15fca8c3792a7679bd7f877f68e64be7263502697594bfbf75e29d0aab&quot;, &quot;csrf&quot;=&gt;&quot;K7SMyJrG_R5TwdId-MRmbYhnrrh5tDZvHRSBPEClbYA=&quot;, &quot;tracking&quot;=&gt;{&quot;HTTP_USER_AGENT&quot;=&gt;&quot;go-http-client&#x2F;1.1&quot;}}</div></td>
         </tr>
         
         <tr>
           <td>rack.session.options</td>
           <td class="code"><div>{:path=&gt;&quot;&#x2F;&quot;, :domain=&gt;nil, :expire_after=&gt;nil, :secure=&gt;false, :httponly=&gt;true, :defer=&gt;false, :renew=&gt;false, :sidbits=&gt;128, :secure_random=&gt;SecureRandom, :secret=&gt;&quot;3497f17e60d812214822aaa69830915a7adc20136c728baa59803aaacb18d243d19434db5f77bcdddb196b400b71f10be8b76ed1ee80205ad01c48d304566336&quot;, :coder=&gt;#&lt;Rack::Protection::EncryptedCookie::Marshal:0x00007f37b5b2d768&gt;}</div></td>
         </tr>
         
         <tr>
           <td>rack.session.unpacked_cookie_data</td>
           <td class="code"><div>{&quot;session_id&quot;=&gt;&quot;60b74e15fca8c3792a7679bd7f877f68e64be7263502697594bfbf75e29d0aab&quot;}</div></td>
         </tr>
         
         <tr>
           <td>rack.tempfiles</td>
           <td class="code"><div>[]</div></td>
         </tr>
         
         <tr>
           <td>rack.url_scheme</td>
           <td class="code"><div>http</div></td>
         </tr>
         
         <tr>
           <td>rack.version</td>
           <td class="code"><div>[1, 6]</div></td>
         </tr>
         
         <tr>
           <td>sinatra.accept</td>
           <td class="code"><div>[#&lt;Sinatra::Request::AcceptEntry:0x00007f37b69e9d38 @entry=&quot;*&#x2F;*&quot;, @type=&quot;*&#x2F;*&quot;, @params={}, @q=1.0&gt;]</div></td>
         </tr>
         
         <tr>
           <td>sinatra.commonlogger</td>
           <td class="code"><div>true</div></td>
         </tr>
         
         <tr>
           <td>sinatra.error</td>
           <td class="code"><div>#&lt;NameError: undefined local variable or method `qrcode&#x27; for #&lt;PlaylistPortal:0x00007f37b5001380 @current_engine=:ruby, @default_layout=:layout, @preferred_extension=&quot;slim&quot;, @app=nil, @template_cache=#&lt;Sinatra::TemplateCache:0x00007f37b5a22148 @cache={[:slim, :program, {:outvar=&gt;&quot;@_out_buf&quot;, :default_encoding=&gt;&quot;utf-8&quot;}, &quot;&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&quot;]=&gt;#&lt;Slim::Template:0x00007f37b4b69e30 @options={:outvar=&gt;&quot;@_out_buf&quot;}, @line=1, @file=&quot;&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;program.slim&quot;, @compiled_method={[PlaylistPortal, [:content, :extra, :playlists, :program, :range, :title, :type]]=&gt;#&lt;UnboundMethod: Tilt::CompiledTemplates#__tilt_17540(locals) &#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;program.slim:-8&gt;}, @default_encoding=&quot;utf-8&quot;, @skip_compiled_encoding_detection=nil, @data=&quot;&#x2F;! ============================================================ \n&#x2F;! Generates program &#x2F; practice content page\n&#x2F;! ============================================================ \n\n- content_for :css do\n  css:\n    a:link {\n      text-decoration: none;\n    }\n    .loopstyle {\n      font-size: 70%;\n    }\n    .transpose {\n      font-size:        90%;\n      background-color: #ccc;\n      padding-left:     4px;\n      padding-right:    4px;\n    }\n    #list-select {\n      position: absolute;\n      top:      10;\n      right:    10;\n      width:  150;\n    }\n    #youtube {\n      border:   1px solid #aaa;\n      display:  none;\n      z-index:  9999;\n      position: fixed;\n      top:      0;\n      left:     0;\n    }\n    .hidden {\n      color:     #fff;\n      font-size: 10%;\n    }\n    .qrcode svg {\n    }\n\n&#x2F;! Select different playlist\n- ltype = params[:type] || content[:type] || &#x27;list&#x27;\n\n&#x2F;! Video player - hidden until brought up\n- locals = {id: &#x27;youtube&#x27;, width:250, height: 140}\n== partial :_pl_player, locals: locals, template_engine: :slim\n\n&#x2F;! Allow language accent, etc \n- locals = {id: &#x27;lybox&#x27;, ltype: ltype}\n== partial :_lyric_box, locals: locals, template_engine: :slim\n\n.row\n  .col-md-8\n    h2\n      = content[:title]\n    h5\n      a href=content[:source] target=&#x27;sheet&#x27;\n        = \&quot;\#{content[:location]}  - \#{content[:date]}\&quot;\n    - if content[:links]\n      .mark.small\n        - content[:links].each do |name, value|\n          a href=value target=name =name.capitalize\n  .col-md-4\n    select.form-select#list-select onchange=\&quot;window.location.href = &#x27;..&#x2F;\#{ltype}&#x2F;&#x27; + this.options[this.selectedIndex].value\&quot;\n      - playlists.each do |item|\n        option value=item selected=(item == program) = item\n\n.row\n  .col-lg-12\n\n    - ismobile = (params[:static] != nil)\n    table.cell-border.compact.display.dt-responsive#main_table width=\&quot;100%\&quot;\n      thead\n        tr\n          th S-Title\n          th No.\n          th Key.Tr\n          th Title\n          th= ltype == \&quot;list\&quot; ? \&quot;Singer [Backup]\&quot; : \&quot;List\&quot;\n          th Beat [Tempo]\n          th Perf Video&#x2F;Loops\n          th Note\n          th\n      tbody\n        - async = params[:static] ? &#x27;false&#x27; : &#x27;true&#x27;\n        - content[:__list].reject{|r| r[:disable]}.each_with_index do |e, index|\n          tr\n            - perf_url = e[:perf_url] || &#x27;&#x27;\n            - yt_video = nil\n            - tempo = e[:perf_tempo] || e[:tempo]\n            td\n              = e[:stitle]\n            td= index+2\n            td\n              .d-grid.gap-2\n                - if (le = extra[index]) &amp;&amp; le[:lyric] &amp;&amp; !le[:lyric].empty?\n                  - color = tempo_color(tempo)\n                  button.btn.btn-sm.btn-outline-secondary.mtooltip style=\&quot;background-color:\#{color}\&quot; onClick=\&quot;get_lyric(&#x27;\#{program}&#x27;, \#{index + range[0]}, \#{async})\&quot; title=\&quot;Lyric for: \#{e[:title]}, tempo: \#{tempo}\&quot;\n                    b= (e[:key] &amp;&amp; !e[:key].empty?) ? e[:key] : &#x27;?&#x27;\n                    - if e[:transpose]\n                      span.transpose title=\&quot;Transpose\&quot; = e[:transpose]\n                    span.= e[:lead] ? \&quot; (\#{e[:lead]})\&quot; : \&quot;\&quot;\n                - else\n                  = (e[:key] &amp;&amp; !e[:key].empty?) ? e[:key] : &#x27;?&#x27;\n                  - if e[:transpose]\n                    span.transpose title=\&quot;Transpose\&quot; = e[:transpose]\n            td\n              = e[:continue] ? \&quot;++\&quot; : \&quot;\&quot;\n              - if e[:play_url]\n                - if ismobile\n                  a href=e[:play_url] title=\&quot;Source lyrics\&quot;= e[:title]\n                - else\n                  a href=e[:play_url] target=&#x27;Play&#x27; title=\&quot;Source lyrics\&quot;= e[:title]\n              - else\n                = e[:title]\n              - if e[:note] &amp;&amp; !(@isIPhone || @isIPad)\n                = \&quot; (\#{e[:note][0..9]})\&quot;\n              - if e[:has_style]\n                | &amp;nbsp;\n                i.fa.fa-guitar\n            td\n              - if ltype == \&quot;list\&quot;\n                - singer = capwords(to_stitle(e[:singer]))\n                - unless singer.empty?\n                  button.btn onClick=\&quot;return dt_search(&#x27;\#{singer}&#x27;)\&quot; \n                    = \&quot;\#{singer}\&quot; + (e[:backup] ? \&quot; [\#{e[:backup]}]\&quot; : \&quot;\&quot;)\n                  - if !(@isIPad || @isIPhone)\n                    a.chord href=\&quot;..&#x2F;singer&#x2F;\#{singer.downcase}\&quot; Singer\n              - else\n                - list = e[:singer]\n                button.btn onClick=\&quot;return dt_search(&#x27;\#{singer}&#x27;)\&quot; = list\n                a.chord href=\&quot;..&#x2F;list&#x2F;\#{list}\&quot; List\n            td.dt-right\n              button.btn onClick=\&quot;return dt_search(&#x27;\#{e[:beat]}&#x27;)\&quot; = e[:beat]\n              - if tempo &amp;&amp; !(@iPhone || @iPad)\n                span.transpose.text-right title=\&quot;Tempo\&quot;= tempo\n            td\n              - perf_url = e[:perf_url] || &#x27;&#x27;\n              - if (yt_video = extract_yt_video(perf_url))\n                - title = e[:title].gsub(&#x2F;&#x27;&#x2F;, &#x27;&#x27;)\n                button.btn.btn-sm.mtooltip title=\&quot;Play Video\&quot; onClick=\&quot;return play_on_youtube(&#x27;\#{yt_video}&#x27;, &#x27;\#{title}&#x27;, 0, 0)\&quot;\n                  i.fa-solid.fa-video\n                - (e[:perf_loop] || []).each do |els|\n                    - el = els.split(\&quot;-\&quot;).map{|f| f.to_i}\n                    button.btn.btn-sm.mtooltip onClick=\&quot;return play_on_youtube(&#x27;\#{yt_video}&#x27;, &#x27;\#{title}&#x27;, \#{el[0]}, \#{el[1]})\&quot; title=\&quot;Play loops\&quot;\n                      i.fa-solid.fa-undo\n                      div.loopstyle= \&quot;\#{el[0]}.\#{el[1]-el[0]}\&quot;\n              - elsif perf_url.start_with?(&#x27;https:&#x2F;&#x2F;&#x27;)\n                a href=perf_url target=&#x27;Listen (not embed)&#x27; Link\n              - else\n                = perf_url\n            td= e[:note] || e[:perf_note]\n            td\n              .hidden= index\n\n    button.btn.btn-sm.btn-outline-secondary onClick=\&quot;reset_order()\&quot; Reset Order \n    - unless params[:static]\n      button.btn.btn-sm.btn-outline-secondary onClick=\&quot;sv_save_order()\&quot; Save to Server\n\n.qrcode== qrcode\n\nscript\n  == \&quot;extra = \&quot; + extra.to_json\n\n- content_for :javascript do\n  script src=\&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;iframe_api\&quot;\n  javascript:\n\n    var main_table;\n    var myModal;\n\n    $(function() {\n\n      $(&#x27;.mtooltip&#x27;).tooltip()\n\n      main_table = new DataTable(&#x27;#main_table&#x27;, {\n        layout: {\n          topStart:    &#x27;search&#x27;,\n          bottomStart: &#x27;info&#x27;,\n        },\n        search: {\n          search: &#x27;\#{params[:search]}&#x27;,\n          caseInsensitive: true,\n        },\n        responsive: true,\n        paging:     false,\n        columns: [null, {data: &#x27;id&#x27;}, null, {data: &#x27;title&#x27;},\n                  null, null, null, null],\n        order:  [[ 1, \&quot;asc\&quot; ]],\n        columnDefs: [\n          { target: 0, visible: false, searchable: true },\n          { target: 2, visible: true,  searchable: false },\n          { target: 7, visible: false, searchable: true },\n          { target: 8, visible: true,  searchable: false },\n        ],\n        rowReorder: {\n          dataSrc: &#x27;id&#x27;,\n        },\n        initComplete: function(settings, json) {\n          var newkey  = &#x27;&#x27;\n          for (let value of $(&#x27;#main_table tbody tr&#x27;)) {\n            newkey += value.childNodes[4].innerText.replace(&#x2F;[\\(\\) ]&#x2F;g, \&quot;\&quot;)\n          }\n          let curkey = localStorage.getItem(&#x27;pagekey.\#{program}&#x27;)\n          &#x2F;&#x2F; console.log(`\#{program} curkey: ${curkey}`)\n          &#x2F;&#x2F; console.log(`\#{program} newkey: ${newkey}`)\n          localStorage.setItem(\&quot;pagekey.\#{program}\&quot;, newkey)\n          if (curkey == newkey) {\n            restore_order()\n          }\n        }\n      });\n\n      main_table.on(&#x27;row-reorder&#x27;, (e, diff, edit) =&gt; {\n        setTimeout(() =&gt; { save_order() }, 100)\n      })\n\n      myModal  = new bootstrap.Modal(document.getElementById(&#x27;lybox&#x27;))\n    });\n\n    function reset_order() {\n      localStorage.removeItem(\&quot;pageorder.\#{program}\&quot;)\n      location.reload()\n    }\n\n    function current_order() {\n      var olist = []\n      for (value of $(&#x27;#main_table tbody tr&#x27;)) {\n        olist.push(value.childNodes[15].innerText)\n      }\n      return olist\n    }\n\n    &#x2F;&#x2F; Save order to localstore (per device only)\n    function save_order() {\n      var olist = current_order()\n      console.log(&#x27;new_list: &#x27;, olist)\n      localStorage.setItem(\&quot;pageorder.\#{program}\&quot;, JSON.stringify(olist))\n    }\n\n    &#x2F;&#x2F; Save order to server (so it could be shared)\n    function sv_save_order() {\n      var olist = current_order()\n      var url = `..&#x2F;reorder&#x2F;\#{program}&#x2F;${olist.join(&#x27;,&#x27;)}`\n      jQuery.ajax({\n        url:      url,\n        method:   &#x27;POST&#x27;,\n        async:    false,\n        dataType: &#x27;json&#x27;,\n        success:  location.reload(),\n      });\n    }\n\n    function restore_order() {\n      let item = localStorage.getItem(\&quot;pageorder.\#{program}\&quot;)\n      if (item == null) {\n        console.log(\&quot;No order to restore\&quot;)\n        return\n      }\n\n      let olist   = JSON.parse(item)\n      let dt_rows = $(&#x27;#main_table tbody tr&#x27;)\n      var offset  = 2\n      console.log(`Restore olist: ${olist}`)\n\n      for (rowno of olist) {\n        &#x2F;&#x2F; console.log(&#x27;rowno: &#x27;, rowno)\n        &#x2F;&#x2F; console.log(&#x27;dtrow: &#x27;, dt_rows[rowno])\n\n        if (dt_rows[rowno] == null) {\n          continue\n        }\n        let listno = dt_rows[rowno].childNodes[2].innerText\n        dt_rows[rowno].childNodes[2].innerText = offset\n        offset += 1\n      }\n\n      setTimeout(() =&gt; {\n        main_table.rows().invalidate().draw()\n      }, 100)\n    }\n&quot;, @src=&quot;begin; _temple_generators_stringbuffer1 = @_out_buf if defined?(@_out_buf); @_out_buf = &#x27;&#x27;.dup; _temple_html_pretty1 = &#x2F;&lt;code|&lt;pre|&lt;textarea&#x2F;; @_out_buf &lt;&lt; (\&quot;&lt;!--============================================================ --&gt;&lt;!--Generates program &#x2F; practice content page--&gt;&lt;!--============================================================ --&gt;\&quot;.freeze); \n; \n; \n; \n; content_for :css do; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;style&gt;\\n  a:link {\\n    text-decoration: none;\\n  }\\n  .loopstyle {\\n    font-size: 70%;\\n  }\\n  .transpose {\\n    font-size:        90%;\\n    background-color: #ccc;\\n    padding-left:     4px;\\n    padding-right:    4px;\\n  }\\n  #list-select {\\n    position: absolute;\\n    top:      10;\\n    right:    10;\\n    width:  150;\\n  }\\n  #youtube {\\n    border:   1px solid #aaa;\\n    display:  none;\\n    z-index:  9999;\\n    position: fixed;\\n    top:      0;\\n    left:     0;\\n  }\\n  .hidden {\\n    color:     #fff;\\n    font-size: 10%;\\n  }\\n  .qrcode svg {\\n  }\\n&lt;&#x2F;style&gt;\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; end; @_out_buf &lt;&lt; (\&quot;\\n&lt;!--Select different playlist--&gt;\&quot;.freeze); \n; ltype = params[:type] || content[:type] || &#x27;list&#x27;; \n; \n; @_out_buf &lt;&lt; (\&quot;&lt;!--Video player - hidden until brought up--&gt;\&quot;.freeze); \n; locals = {id: &#x27;youtube&#x27;, width:250, height: 140}; \n; @_out_buf &lt;&lt; ((::Temple::Utils.indent_dynamic((partial :_pl_player, locals: locals, template_engine: :slim), false, \&quot;\\n\&quot;, _temple_html_pretty1)).to_s); \n; \n; @_out_buf &lt;&lt; (\&quot;&lt;!--Allow language accent, etc --&gt;\&quot;.freeze); \n; locals = {id: &#x27;lybox&#x27;, ltype: ltype}; \n; @_out_buf &lt;&lt; ((::Temple::Utils.indent_dynamic((partial :_lyric_box, locals: locals, template_engine: :slim), false, \&quot;\\n\&quot;, _temple_html_pretty1)).to_s); \n; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;div class=\\\&quot;row\\\&quot;&gt;\\n  &lt;div class=\\\&quot;col-md-8\\\&quot;&gt;\\n    &lt;h2&gt;\&quot;.freeze); \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((content[:title]), true, \&quot;\\n      \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;\\n    &lt;&#x2F;h2&gt;\\n    &lt;h5&gt;\\n      &lt;a\&quot;.freeze); \n; _slim_codeattributes1 = content[:source]; if _slim_codeattributes1; if _slim_codeattributes1 == true; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes1))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot; target=\\\&quot;sheet\\\&quot;&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((\&quot;\#{content[:location]}  - \#{content[:date]}\&quot;), false, \&quot;\\n        \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;a&gt;\\n    &lt;&#x2F;h5&gt;\&quot;.freeze); if content[:links]; \n; @_out_buf &lt;&lt; (\&quot;\\n    &lt;div class=\\\&quot;mark small\\\&quot;&gt;\&quot;.freeze); \n; content[:links].each do |name, value|; \n; @_out_buf &lt;&lt; (\&quot;\\n      &lt;a\&quot;.freeze); _slim_codeattributes2 = value; if _slim_codeattributes2; if _slim_codeattributes2 == true; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes2))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; _slim_codeattributes3 = name; if _slim_codeattributes3; if _slim_codeattributes3 == true; @_out_buf &lt;&lt; (\&quot; target=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; target=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes3))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((name.capitalize), false, \&quot;\\n        \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;a&gt;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;\\n    &lt;&#x2F;div&gt;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;\\n  &lt;&#x2F;div&gt;\\n  &lt;div class=\\\&quot;col-md-4\\\&quot;&gt;\\n    &lt;select class=\\\&quot;form-select\\\&quot; id=\\\&quot;list-select\\\&quot; onchange=\\\&quot;window.location.href = &amp;#39;..&#x2F;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((ltype))).to_s); @_out_buf &lt;&lt; (\&quot;&#x2F;&amp;#39; + this.options[this.selectedIndex].value\\\&quot;&gt;\&quot;.freeze); \n; playlists.each do |item|; \n; @_out_buf &lt;&lt; (\&quot;\\n      &lt;option\&quot;.freeze); _slim_codeattributes4 = (item == program); if _slim_codeattributes4; if _slim_codeattributes4 == true; @_out_buf &lt;&lt; (\&quot; selected=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; selected=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes4))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; _slim_codeattributes5 = item; if _slim_codeattributes5; if _slim_codeattributes5 == true; @_out_buf &lt;&lt; (\&quot; value=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; value=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes5))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((item), true, \&quot;\\n        \&quot;, _temple_html_pretty1)))).to_s); \n; \n; @_out_buf &lt;&lt; (\&quot;\\n      &lt;&#x2F;option&gt;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;\\n    &lt;&#x2F;select&gt;\\n  &lt;&#x2F;div&gt;\\n&lt;&#x2F;div&gt;\\n&lt;div class=\\\&quot;row\\\&quot;&gt;\\n  &lt;div class=\\\&quot;col-lg-12\\\&quot;&gt;\&quot;.freeze); \n; \n; \n; ismobile = (params[:static] != nil); \n; @_out_buf &lt;&lt; (\&quot;\\n    &lt;table class=\\\&quot;cell-border compact display dt-responsive\\\&quot; id=\\\&quot;main_table\\\&quot; width=\\\&quot;100%\\\&quot;&gt;\\n      &lt;thead&gt;\\n        &lt;tr&gt;\\n          &lt;th&gt;\\n            S-Title\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\\n            No.\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\\n            Key.Tr\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\\n            Title\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((ltype == \&quot;list\&quot; ? \&quot;Singer [Backup]\&quot; : \&quot;List\&quot;), true, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\\n            Beat [Tempo]\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\\n            Perf Video&#x2F;Loops\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;\\n            Note\\n          &lt;&#x2F;th&gt;\\n          &lt;th&gt;&lt;&#x2F;th&gt;\\n        &lt;&#x2F;tr&gt;\\n      &lt;&#x2F;thead&gt;\\n      &lt;tbody&gt;\&quot;.freeze); \n; \n; \n; \n; \n; async = params[:static] ? &#x27;false&#x27; : &#x27;true&#x27;; \n; content[:__list].reject{|r| r[:disable]}.each_with_index do |e, index|; \n; @_out_buf &lt;&lt; (\&quot;\\n        &lt;tr&gt;\&quot;.freeze); \n; perf_url = e[:perf_url] || &#x27;&#x27;; \n; yt_video = nil; \n; tempo = e[:perf_tempo] || e[:tempo]; \n; @_out_buf &lt;&lt; (\&quot;\\n          &lt;td&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:stitle]), true, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((index+2), true, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\\n            &lt;div class=\\\&quot;d-grid gap-2\\\&quot;&gt;\&quot;.freeze); \n; \n; if (le = extra[index]) &amp;&amp; le[:lyric] &amp;&amp; !le[:lyric].empty?; \n; color = tempo_color(tempo); \n; @_out_buf &lt;&lt; (\&quot;\\n              &lt;button class=\\\&quot;btn btn-sm btn-outline-secondary mtooltip\\\&quot; onClick=\\\&quot;get_lyric(&amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((program))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;, \&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((index + range[0]))).to_s); @_out_buf &lt;&lt; (\&quot;, \&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((async))).to_s); @_out_buf &lt;&lt; (\&quot;)\\\&quot; style=\\\&quot;background-color:\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((color))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot; title=\\\&quot;Lyric for: \&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((e[:title]))).to_s); @_out_buf &lt;&lt; (\&quot;, tempo: \&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((tempo))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;&gt;&lt;b&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic(((e[:key] &amp;&amp; !e[:key].empty?) ? e[:key] : &#x27;?&#x27;), false, \&quot;\\n                  \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;b&gt;\&quot;.freeze); if e[:transpose]; \n; @_out_buf &lt;&lt; (\&quot;&lt;span class=\\\&quot;transpose\\\&quot; title=\\\&quot;Transpose\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:transpose]), false, \&quot;\\n                  \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;span&gt;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;&lt;span\&quot;.freeze); _temple_html_attributeremover1 = \&quot;\&quot;; if !_temple_html_attributeremover1.empty?; @_out_buf &lt;&lt; (\&quot; class=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((_temple_html_attributeremover1).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:lead] ? \&quot; (\#{e[:lead]})\&quot; : \&quot;\&quot;), false, \&quot;\\n                  \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;span&gt;&lt;&#x2F;button&gt;\&quot;.freeze); else; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic(((e[:key] &amp;&amp; !e[:key].empty?) ? e[:key] : &#x27;?&#x27;), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; if e[:transpose]; \n; @_out_buf &lt;&lt; (\&quot;&lt;span class=\\\&quot;transpose\\\&quot; title=\\\&quot;Transpose\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:transpose]), false, \&quot;\\n                \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;span&gt;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;\\n            &lt;&#x2F;div&gt;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:continue] ? \&quot;++\&quot; : \&quot;\&quot;), true, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; if e[:play_url]; \n; if ismobile; \n; @_out_buf &lt;&lt; (\&quot;&lt;a\&quot;.freeze); _slim_codeattributes6 = e[:play_url]; if _slim_codeattributes6; if _slim_codeattributes6 == true; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes6))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot; title=\\\&quot;Source lyrics\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:title]), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;a&gt;\&quot;.freeze); else; \n; @_out_buf &lt;&lt; (\&quot;&lt;a\&quot;.freeze); _slim_codeattributes7 = e[:play_url]; if _slim_codeattributes7; if _slim_codeattributes7 == true; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes7))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot; target=\\\&quot;Play\\\&quot; title=\\\&quot;Source lyrics\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:title]), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;a&gt;\&quot;.freeze); end; else; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:title]), false, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; end; if e[:note] &amp;&amp; !(@isIPhone || @isIPad); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((\&quot; (\#{e[:note][0..9]})\&quot;), false, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; end; if e[:has_style]; \n; @_out_buf &lt;&lt; (\&quot;&amp;nbsp;&lt;i class=\\\&quot;fa fa-guitar\\\&quot;&gt;&lt;&#x2F;i&gt;\&quot;.freeze); \n; \n; end; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\&quot;.freeze); \n; if ltype == \&quot;list\&quot;; \n; singer = capwords(to_stitle(e[:singer])); \n; unless singer.empty?; \n; @_out_buf &lt;&lt; (\&quot;\\n            &lt;button class=\\\&quot;btn\\\&quot; onClick=\\\&quot;return dt_search(&amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((singer))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;)\\\&quot;&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((\&quot;\#{singer}\&quot; + (e[:backup] ? \&quot; [\#{e[:backup]}]\&quot; : \&quot;\&quot;)), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;button&gt;\&quot;.freeze); if !(@isIPad || @isIPhone); \n; @_out_buf &lt;&lt; (\&quot;&lt;a class=\\\&quot;chord\\\&quot; href=\\\&quot;..&#x2F;singer&#x2F;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((singer.downcase))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;&gt;Singer&lt;&#x2F;a&gt;\&quot;.freeze); \n; end; end; else; \n; list = e[:singer]; \n; @_out_buf &lt;&lt; (\&quot;&lt;button class=\\\&quot;btn\\\&quot; onClick=\\\&quot;return dt_search(&amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((singer))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;)\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((list), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;button&gt;&lt;a class=\\\&quot;chord\\\&quot; href=\\\&quot;..&#x2F;list&#x2F;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((list))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;&gt;List&lt;&#x2F;a&gt;\&quot;.freeze); \n; end; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td class=\\\&quot;dt-right\\\&quot;&gt;\\n            &lt;button class=\\\&quot;btn\\\&quot; onClick=\\\&quot;return dt_search(&amp;#39;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((e[:beat]))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;)\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:beat]), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;button&gt;\&quot;.freeze); if tempo &amp;&amp; !(@iPhone || @iPad); \n; @_out_buf &lt;&lt; (\&quot;&lt;span class=\\\&quot;transpose text-right\\\&quot; title=\\\&quot;Tempo\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((tempo), false, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;&lt;&#x2F;span&gt;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\&quot;.freeze); \n; perf_url = e[:perf_url] || &#x27;&#x27;; \n; if (yt_video = extract_yt_video(perf_url)); \n; title = e[:title].gsub(&#x2F;&#x27;&#x2F;, &#x27;&#x27;); \n; @_out_buf &lt;&lt; (\&quot;\\n            &lt;button class=\\\&quot;btn btn-sm mtooltip\\\&quot; onClick=\\\&quot;return play_on_youtube(&amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((yt_video))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;, &amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((title))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;, 0, 0)\\\&quot; title=\\\&quot;Play Video\\\&quot;&gt;&lt;i class=\\\&quot;fa-solid fa-video\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;\&quot;.freeze); \n; \n; (e[:perf_loop] || []).each do |els|; \n; el = els.split(\&quot;-\&quot;).map{|f| f.to_i}; \n; @_out_buf &lt;&lt; (\&quot;&lt;button class=\\\&quot;btn btn-sm mtooltip\\\&quot; onClick=\\\&quot;return play_on_youtube(&amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((yt_video))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;, &amp;#39;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((title))).to_s); @_out_buf &lt;&lt; (\&quot;&amp;#39;, \&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((el[0]))).to_s); @_out_buf &lt;&lt; (\&quot;, \&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((el[1]))).to_s); @_out_buf &lt;&lt; (\&quot;)\\\&quot; title=\\\&quot;Play loops\\\&quot;&gt;&lt;i class=\\\&quot;fa-solid fa-undo\\\&quot;&gt;&lt;&#x2F;i&gt;\\n              &lt;div class=\\\&quot;loopstyle\\\&quot;&gt;\&quot;.freeze); \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((\&quot;\#{el[0]}.\#{el[1]-el[0]}\&quot;), true, \&quot;\\n                \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;\\n              &lt;&#x2F;div&gt;\\n            &lt;&#x2F;button&gt;\&quot;.freeze); end; elsif perf_url.start_with?(&#x27;https:&#x2F;&#x2F;&#x27;); \n; @_out_buf &lt;&lt; (\&quot;&lt;a\&quot;.freeze); _slim_codeattributes8 = perf_url; if _slim_codeattributes8; if _slim_codeattributes8 == true; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; href=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes8))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot; target=\\\&quot;Listen (not embed)\\\&quot;&gt;Link&lt;&#x2F;a&gt;\&quot;.freeze); \n; else; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((perf_url), false, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; end; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((e[:note] || e[:perf_note]), true, \&quot;\\n            \&quot;, _temple_html_pretty1)))).to_s); \n; @_out_buf &lt;&lt; (\&quot;\\n          &lt;&#x2F;td&gt;\\n          &lt;td&gt;\\n            &lt;div class=\\\&quot;hidden\\\&quot;&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((index), true, \&quot;\\n              \&quot;, _temple_html_pretty1)))).to_s); \n; \n; @_out_buf &lt;&lt; (\&quot;\\n            &lt;&#x2F;div&gt;\\n          &lt;&#x2F;td&gt;\\n        &lt;&#x2F;tr&gt;\&quot;.freeze); end; @_out_buf &lt;&lt; (\&quot;\\n      &lt;&#x2F;tbody&gt;\\n    &lt;&#x2F;table&gt;\\n    &lt;button class=\\\&quot;btn btn-sm btn-outline-secondary\\\&quot; onClick=\\\&quot;reset_order()\\\&quot;&gt;Reset Order &lt;&#x2F;button&gt;\&quot;.freeze); \n; unless params[:static]; \n; @_out_buf &lt;&lt; (\&quot;&lt;button class=\\\&quot;btn btn-sm btn-outline-secondary\\\&quot; onClick=\\\&quot;sv_save_order()\\\&quot;&gt;Save to Server&lt;&#x2F;button&gt;\&quot;.freeze); \n; \n; end; @_out_buf &lt;&lt; (\&quot;\\n  &lt;&#x2F;div&gt;\\n&lt;&#x2F;div&gt;\\n&lt;div class=\\\&quot;qrcode\\\&quot;&gt;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.indent_dynamic((qrcode), true, \&quot;\\n  \&quot;, _temple_html_pretty1)).to_s); \n; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;&#x2F;div&gt;\\n&lt;script&gt;\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.indent_dynamic((\&quot;extra = \&quot; + extra.to_json), true, \&quot;\\n  \&quot;, _temple_html_pretty1)).to_s); \n; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;&#x2F;script&gt;\&quot;.freeze); content_for :javascript do; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;script src=\\\&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;iframe_api\\\&quot;&gt;&lt;&#x2F;script&gt;\\n&lt;script&gt;\\n  var main_table;\\n  var myModal;\\n  \\n  $(function() {\\n  \\n    $(&#x27;.mtooltip&#x27;).tooltip()\\n  \\n    main_table = new DataTable(&#x27;#main_table&#x27;, {\\n      layout: {\\n        topStart:    &#x27;search&#x27;,\\n        bottomStart: &#x27;info&#x27;,\\n      },\\n      search: {\\n        search: &#x27;\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((params[:search]), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;,\\n        caseInsensitive: true,\\n      },\\n      responsive: true,\\n      paging:     false,\\n      columns: [null, {data: &#x27;id&#x27;}, null, {data: &#x27;title&#x27;},\\n                null, null, null, null],\\n      order:  [[ 1, \\\&quot;asc\\\&quot; ]],\\n      columnDefs: [\\n        { target: 0, visible: false, searchable: true },\\n        { target: 2, visible: true,  searchable: false },\\n        { target: 7, visible: false, searchable: true },\\n        { target: 8, visible: true,  searchable: false },\\n      ],\\n      rowReorder: {\\n        dataSrc: &#x27;id&#x27;,\\n      },\\n      initComplete: function(settings, json) {\\n        var newkey  = &#x27;&#x27;\\n        for (let value of $(&#x27;#main_table tbody tr&#x27;)) {\\n          newkey += value.childNodes[4].innerText.replace(&#x2F;[\\\\(\\\\) ]&#x2F;g, \\\&quot;\\\&quot;)\\n        }\\n        let curkey = localStorage.getItem(&#x27;pagekey.\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;)\\n        &#x2F;&#x2F; console.log(`\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; curkey: ${curkey}`)\\n        &#x2F;&#x2F; console.log(`\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; newkey: ${newkey}`)\\n        localStorage.setItem(\\\&quot;pagekey.\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;, newkey)\\n        if (curkey == newkey) {\\n          restore_order()\\n        }\\n      }\\n    });\\n  \\n    main_table.on(&#x27;row-reorder&#x27;, (e, diff, edit) =&gt; {\\n      setTimeout(() =&gt; { save_order() }, 100)\\n    })\\n  \\n    myModal  = new bootstrap.Modal(document.getElementById(&#x27;lybox&#x27;))\\n  });\\n  \\n  function reset_order() {\\n    localStorage.removeItem(\\\&quot;pageorder.\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;)\\n    location.reload()\\n  }\\n  \\n  function current_order() {\\n    var olist = []\\n    for (value of $(&#x27;#main_table tbody tr&#x27;)) {\\n      olist.push(value.childNodes[15].innerText)\\n    }\\n    return olist\\n  }\\n  \\n  &#x2F;&#x2F; Save order to localstore (per device only)\\n  function save_order() {\\n    var olist = current_order()\\n    console.log(&#x27;new_list: &#x27;, olist)\\n    localStorage.setItem(\\\&quot;pageorder.\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;, JSON.stringify(olist))\\n  }\\n  \\n  &#x2F;&#x2F; Save order to server (so it could be shared)\\n  function sv_save_order() {\\n    var olist = current_order()\\n    var url = `..&#x2F;reorder&#x2F;\&quot;.freeze); \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x2F;${olist.join(&#x27;,&#x27;)}`\\n    jQuery.ajax({\\n      url:      url,\\n      method:   &#x27;POST&#x27;,\\n      async:    false,\\n      dataType: &#x27;json&#x27;,\\n      success:  location.reload(),\\n    });\\n  }\\n  \\n  function restore_order() {\\n    let item = localStorage.getItem(\\\&quot;pageorder.\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((program), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;)\\n    if (item == null) {\\n      console.log(\\\&quot;No order to restore\\\&quot;)\\n      return\\n    }\\n  \\n    let olist   = JSON.parse(item)\\n    let dt_rows = $(&#x27;#main_table tbody tr&#x27;)\\n    var offset  = 2\\n    console.log(`Restore olist: ${olist}`)\\n  \\n    for (rowno of olist) {\\n      &#x2F;&#x2F; console.log(&#x27;rowno: &#x27;, rowno)\\n      &#x2F;&#x2F; console.log(&#x27;dtrow: &#x27;, dt_rows[rowno])\\n  \\n      if (dt_rows[rowno] == null) {\\n        continue\\n      }\\n      let listno = dt_rows[rowno].childNodes[2].innerText\\n      dt_rows[rowno].childNodes[2].innerText = offset\\n      offset += 1\\n    }\\n  \\n    setTimeout(() =&gt; {\\n      main_table.rows().invalidate().draw()\\n    }, 100)\\n  }\\n&lt;&#x2F;script&gt;\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; end; @_out_buf; ensure; @_out_buf = _temple_generators_stringbuffer1; end&quot;&gt;, [:slim, :_pl_player, {:template_engine=&gt;:slim, :outvar=&gt;&quot;@_out_buf&quot;, :default_encoding=&gt;&quot;utf-8&quot;}, &quot;&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&quot;]=&gt;#&lt;Slim::Template:0x00007f37b5a60dd0 @options={:template_engine=&gt;:slim, :outvar=&gt;&quot;@_out_buf&quot;}, @line=1, @file=&quot;&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;_pl_player.slim&quot;, @compiled_method={[PlaylistPortal, [:height, :id, :width]]=&gt;#&lt;UnboundMethod: Tilt::CompiledTemplates#__tilt_17540(locals) &#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;_pl_player.slim:-4&gt;}, @default_encoding=&quot;utf-8&quot;, @skip_compiled_encoding_detection=nil, @data=&quot;- # Using YT iFrame API, more flexible but cannot deployed as static file\n\n- vtitle  = \&quot;\#{id}-title\&quot;\n- vplayer = \&quot;\#{id}-player\&quot;\n- vcloser = \&quot;\#{id}-closer\&quot;\n\n- content_for :css do\n  css:\n    #\#{vplayer} {\n      width:    \#{width};\n      height:   \#{height};\n      opacity:  0.4;\n    }\n    #\#{vcloser} {\n      position: absolute;\n      top:      0;\n      right:    0;\n      z-index:  99;\n    }\n\ndiv id=id\n  div\n    a id=vcloser href=&#x27;#&#x27; onClick=\&quot;cancel_play(); return false\&quot;\n      i.fa.fa-window-close\n    span id=vtitle style=\&quot;font-size:60%\&quot;\n  div id=vplayer\n\n- content_for :javascript do\n  javascript:\n    var player = null;\n    var play_timer = null;\n\n    &#x2F;&#x2F; This function will be called when the API is ready\n    function onYouTubeIframeAPIReady() {\n      console.log(\&quot;Frame API ready\&quot;)\n      player = new YT.Player(&#x27;\#{vplayer}&#x27;, {\n        videoId: &#x27;&#x27;,\n        playerVars: {\n            autoplay:       1,\n            controls:       0,\n            showinfo:       0,\n            modestbranding: 1,\n        },\n      });\n    }\n\n    function cancel_play() {\n      cancel_play_timer()\n      player.stopVideo();\n      $(&#x27;#\#{id}&#x27;).hide();\n    }\n\n    function cancel_play_timer() {\n      if (play_timer) {\n        clearTimeout(play_timer);\n        play_timer = null\n      }\n    }\n\n    function loopPlay(stime, etime) {\n      console.log(`Seeking to ${stime}. Play for ${etime - stime}`)\n\n      &#x2F;&#x2F; In case a loop play precede.  Must cancel any play timer\n      cancel_play_timer();\n      player.seekTo(stime, true)\n      if (etime &lt;= stime) {\n        return\n      }\n\n      &#x2F;&#x2F; Looping play\n      var duration = etime - stime\n      play_timer = setTimeout(function() {\n        loopPlay(stime, etime);\n      }, duration*1000);\n      &#x2F;&#x2F; console.log(&#x27;Starting timer: &#x27;, play_timer, &#x27; duration: &#x27;, duration)\n    }\n\n    function play_on_youtube(video, title, stime, etime) {\n      if (player == null) {\n        alert(\&quot;Youtube player is not ready\&quot;)\n        return\n      }\n      var href = `https:&#x2F;&#x2F;www.youtube.com&#x2F;embed&#x2F;${video}?autoplay=1&amp;playsinline=1`;\n      console.log(href, stime, etime)\n\n      $(&#x27;#\#{vtitle}&#x27;)[0].innerHTML = title\n      player.loadVideoById(video, stime)\n      player.seekTo(stime, true)\n\n      &#x2F;* Slow down player *&#x2F;\n      if (etime &gt; 0) {\n        const prate = 1\n        player.setPlaybackRate(prate);\n        etime2 = stime + ((etime - stime)&#x2F;prate);\n      }\n\n      &#x2F;&#x2F; 1st seek somehow have to wait a bit ...\n      setTimeout(function() {\n        player.unMute()\n        $(&#x27;#\#{id}&#x27;).show();\n        loopPlay(stime, etime);\n      }, 500)\n    }\n\n  -# Script must be loaded last after trigger is in place\n\n  script src=\&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;iframe_api\&quot;\n&quot;, @src=&quot;begin; _temple_generators_stringbuffer1 = @_out_buf if defined?(@_out_buf); @_out_buf = &#x27;&#x27;.dup; _temple_html_pretty1 = &#x2F;&lt;code|&lt;pre|&lt;textarea&#x2F;; # Using YT iFrame API, more flexible but cannot deployed as static file; \n; \n; vtitle  = \&quot;\#{id}-title\&quot;; \n; vplayer = \&quot;\#{id}-player\&quot;; \n; vcloser = \&quot;\#{id}-closer\&quot;; \n; \n; content_for :css do; \n; @_out_buf &lt;&lt; (\&quot;&lt;style&gt;\\n  #\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vplayer), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; {\\n    width:    \&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((width), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;;\\n    height:   \&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((height), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;;\\n    opacity:  0.4;\\n  }\\n  #\&quot;.freeze); \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vcloser), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; {\\n    position: absolute;\\n    top:      0;\\n    right:    0;\\n    z-index:  99;\\n  }\\n&lt;&#x2F;style&gt;\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; end; @_out_buf &lt;&lt; (\&quot;\\n&lt;div\&quot;.freeze); _slim_codeattributes1 = id; if _slim_codeattributes1; if _slim_codeattributes1 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes1))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;\\n  &lt;div&gt;\\n    &lt;a href=\\\&quot;#\\\&quot;\&quot;.freeze); \n; \n; _slim_codeattributes2 = vcloser; if _slim_codeattributes2; if _slim_codeattributes2 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes2))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot; onClick=\\\&quot;cancel_play(); return false\\\&quot;&gt;&lt;i class=\\\&quot;fa fa-window-close\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;a&gt;&lt;span\&quot;.freeze); \n; \n; _slim_codeattributes3 = vtitle; if _slim_codeattributes3; if _slim_codeattributes3 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes3))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot; style=\\\&quot;font-size:60%\\\&quot;&gt;&lt;&#x2F;span&gt;\\n  &lt;&#x2F;div&gt;\\n  &lt;div\&quot;.freeze); \n; _slim_codeattributes4 = vplayer; if _slim_codeattributes4; if _slim_codeattributes4 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes4))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;&lt;&#x2F;div&gt;\\n&lt;&#x2F;div&gt;\&quot;.freeze); \n; \n; content_for :javascript do; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;script&gt;\\n  var player = null;\\n  var play_timer = null;\\n  \\n  &#x2F;&#x2F; This function will be called when the API is ready\\n  function onYouTubeIframeAPIReady() {\\n    console.log(\\\&quot;Frame API ready\\\&quot;)\\n    player = new YT.Player(&#x27;\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vplayer), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;, {\\n      videoId: &#x27;&#x27;,\\n      playerVars: {\\n          autoplay:       1,\\n          controls:       0,\\n          showinfo:       0,\\n          modestbranding: 1,\\n      },\\n    });\\n  }\\n  \\n  function cancel_play() {\\n    cancel_play_timer()\\n    player.stopVideo();\\n    $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((id), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;).hide();\\n  }\\n  \\n  function cancel_play_timer() {\\n    if (play_timer) {\\n      clearTimeout(play_timer);\\n      play_timer = null\\n    }\\n  }\\n  \\n  function loopPlay(stime, etime) {\\n    console.log(`Seeking to ${stime}. Play for ${etime - stime}`)\\n  \\n    &#x2F;&#x2F; In case a loop play precede.  Must cancel any play timer\\n    cancel_play_timer();\\n    player.seekTo(stime, true)\\n    if (etime &lt;= stime) {\\n      return\\n    }\\n  \\n    &#x2F;&#x2F; Looping play\\n    var duration = etime - stime\\n    play_timer = setTimeout(function() {\\n      loopPlay(stime, etime);\\n    }, duration*1000);\\n    &#x2F;&#x2F; console.log(&#x27;Starting timer: &#x27;, play_timer, &#x27; duration: &#x27;, duration)\\n  }\\n  \\n  function play_on_youtube(video, title, stime, etime) {\\n    if (player == null) {\\n      alert(\\\&quot;Youtube player is not ready\\\&quot;)\\n      return\\n    }\\n    var href = `https:&#x2F;&#x2F;www.youtube.com&#x2F;embed&#x2F;${video}?autoplay=1&amp;playsinline=1`;\\n    console.log(href, stime, etime)\\n  \\n    $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vtitle), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;)[0].innerHTML = title\\n    player.loadVideoById(video, stime)\\n    player.seekTo(stime, true)\\n  \\n    &#x2F;* Slow down player *&#x2F;\\n    if (etime &gt; 0) {\\n      const prate = 1\\n      player.setPlaybackRate(prate);\\n      etime2 = stime + ((etime - stime)&#x2F;prate);\\n    }\\n  \\n    &#x2F;&#x2F; 1st seek somehow have to wait a bit ...\\n    setTimeout(function() {\\n      player.unMute()\\n      $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((id), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;).show();\\n      loopPlay(stime, etime);\\n    }, 500)\\n  }\\n&lt;&#x2F;script&gt;\&quot;.freeze); \n; \n; \n; \n; \n; # Script must be loaded last after trigger is in place; \n; \n; @_out_buf &lt;&lt; (\&quot;\\n&lt;script src=\\\&quot;https:&#x2F;&#x2F;www.youtube.com&#x2F;iframe_api\\\&quot;&gt;&lt;&#x2F;script&gt;\&quot;.freeze); \n; end; @_out_buf; ensure; @_out_buf = _temple_generators_stringbuffer1; end&quot;&gt;, [:slim, :_lyric_box, {:template_engine=&gt;:slim, :outvar=&gt;&quot;@_out_buf&quot;, :default_encoding=&gt;&quot;utf-8&quot;}, &quot;&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&quot;]=&gt;#&lt;Slim::Template:0x00007f37b5b0b2d0 @options={:template_engine=&gt;:slim, :outvar=&gt;&quot;@_out_buf&quot;}, @line=1, @file=&quot;&#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;_lyric_box.slim&quot;, @compiled_method={[PlaylistPortal, [:id, :ltype]]=&gt;#&lt;UnboundMethod: Tilt::CompiledTemplates#__tilt_17540(locals) &#x2F;app&#x2F;controllers&#x2F;..&#x2F;views&#x2F;_lyric_box.slim:-3&gt;}, @default_encoding=&quot;utf-8&quot;, @skip_compiled_encoding_detection=nil, @data=&quot;- ltitle   = \&quot;\#{id}-title\&quot;\n- ldebug   = \&quot;\#{id}-debug\&quot;\n- lheader  = \&quot;\#{id}-header\&quot;\n- lcontent = \&quot;\#{id}-content\&quot;\n- vctl     = \&quot;\#{id}-vctl\&quot;\n\n- content_for :css do\n  css:\n    .chord {\n      color:            #aa5;\n      vertical-align:   12px;\n      font-family:      monospace;\n      font-weight:      800;\n      padding:          2px;\n      border-left:      1px solid #888;\n      border-bottom:    1px solid #888;\n      font-size:        80%;\n      background-color: #ffc;\n    }\n    #\#{ltitle} {\n      font-size: 80%;\n    }\n    #\#{ldebug} {\n      font-size: 50%;\n    }\n\n&#x2F;! Lyric modal - hidden until brought up\n.modal.fade id=id tabindex=-1\n  .modal-dialog.modal-dialog-centered.modal-dialog-scrollable.modal-xl style=\&quot;max-width:100%; max-height:100%\&quot;\n    .modal-content\n      .modal-header\n        div.small id=lheader\n        div.small id=ldebug\n        div id=vctl\n          button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;play_song()\&quot; title=\&quot;Play full video\&quot;\n            i.fa-solid.fa-headphones\n          button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;play_intro()\&quot; title=\&quot;Play intro\&quot;\n            i.fa-solid.fa-undo\n          button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;cancel_play()\&quot; title=\&quot;Stop plauing\&quot;\n            i.fa-solid.fa-stop\n      .modal-body\n        div id=lcontent\n      .modal-footer\n        div id=ltitle\n        - async = params[:static] ? &#x27;false&#x27; : &#x27;true&#x27;\n        button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;load_lyric(\#{async}, -1)\&quot; title=\&quot;Previous Page\&quot;\n          i.fa.fa-backward\n        - unless params[:static]\n          button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;load_lyric(\#{async}, 0)\&quot; title=\&quot;Reload Page\&quot;\n            i.fa-solid.fa-undo\n        button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;singer_toggle()\&quot; title=\&quot;Toogle chord\&quot;\n          i.fa.fa-music\n        button.btn.btn-secondary type=\&quot;button\&quot; onClick=\&quot;load_lyric(\#{async}, 1)\&quot; title=\&quot;Next Page\&quot;\n          i.fa.fa-forward\n        button.btn.btn-warning type=\&quot;button\&quot; data-bs-dismiss=\&quot;modal\&quot; title=\&quot;Close\&quot;\n          i.fa.fa-sign-out\n\njavascript:\n  function singer_toggle() {\n    $(&#x27;.chord&#x27;).toggle()\n    $(&#x27;#\#{id} .modal-header&#x27;).toggle()\n  }\n\n  function dblog(msg) {\n    console.log(msg)\n    &#x2F;&#x2F; var dbhandle = $(&#x27;#\#{ldebug}&#x27;)\n    &#x2F;&#x2F; dbhandle.html(dbhandle.html() + ` - ${msg}`)\n  }\n\n  function load_lyric(async = true, offset = 0) {\n    var olist = current_order()\n\n    var cur_ofs = olist.indexOf(myModal.item.toString())\n    var new_ofs = cur_ofs + offset\n\n    if ((new_ofs &lt; 0) || (new_ofs &gt;= olist.length)) {\n      return\n    }\n    get_lyric(myModal.program, olist[new_ofs], async)\n  }\n  function play_intro() {\n    var lvideo = $(&#x27;#\#{vctl}&#x27;)\n    var video  = lvideo.attr(&#x27;my_video&#x27;)\n    var stime  = parseInt(lvideo.attr(&#x27;my_vstart&#x27;))\n    var etime  = parseInt(lvideo.attr(&#x27;my_vend&#x27;))\n    var title  = lvideo.attr(&#x27;my_title&#x27;)\n    play_on_youtube(video, title, stime, etime)\n  }\n  function play_song() {\n    var lvideo = $(&#x27;#\#{vctl}&#x27;)\n    var video = lvideo.attr(&#x27;my_video&#x27;)\n    var title = lvideo.attr(&#x27;my_title&#x27;)\n    play_on_youtube(video, title, 0, 0)\n  }\n  function get_lyric(program, item, async = true) {\n    myModal.program = program\n    myModal.item    = item\n\n    dblog(`Getting item # ${myModal.item}`)\n\n    if (async) {\n      var url = `..&#x2F;lyric&#x2F;${program}&#x2F;${item}?type=\#{ltype}`\n      jQuery.ajax({\n        url:      url,\n        async:    true,\n        dataType: &#x27;json&#x27;,\n        success:  show_lyric,\n      });\n    } else {\n      var content  = extra[item]\n      if (content != null) {\n        show_lyric(content)\n      }\n    }\n  }\n  function show_lyric(content) {\n    console.log(&#x27;content &#x27;, content)\n    var lvideo = $(&#x27;#\#{vctl}&#x27;)\n\n    &#x2F;&#x2F; If vintro exist - create button for play&#x2F;stop intro\n    lvideo.attr(&#x27;my_video&#x27;,  content[&#x27;video&#x27;])\n    lvideo.attr(&#x27;my_title&#x27;,  content[&#x27;title&#x27;])\n    lvideo.attr(&#x27;my_item&#x27;,   content[&#x27;item_no&#x27;])\n\n    if (content[&#x27;vintro&#x27;] != null) {\n      lvideo.attr(&#x27;my_vstart&#x27;, content[&#x27;vintro&#x27;][0])\n      lvideo.attr(&#x27;my_vend&#x27;,   content[&#x27;vintro&#x27;][1])\n    }\n    lvideo.show()\n\n    var lyric = content[&#x27;lyric&#x27;].replaceAll(&#x27;\\n&#x27;, &#x27;&lt;br&gt;&#x27;)\n    $(&#x27;#\#{lcontent}&#x27;).html(&#x27;&lt;center&gt;&lt;b&gt;&#x27; + lyric)\n    $(&#x27;#\#{lheader}&#x27;).html(`${content[&#x27;beat&#x27;]}: ${content[&#x27;tokey&#x27;]}.${content[&#x27;transpose&#x27;]}\#${content[&#x27;tempo&#x27;]} - Intro: ${content[&#x27;intro&#x27;]}`)\n    $(&#x27;#\#{ltitle}&#x27;).html(content[&#x27;title&#x27;].substring(0, 19))\n    $(&#x27;.modal-header&#x27;).show()\n    myModal.show()\n  }\n\n\n\n&quot;, @src=&quot;begin; _temple_generators_stringbuffer1 = @_out_buf if defined?(@_out_buf); @_out_buf = &#x27;&#x27;.dup; _temple_html_pretty1 = &#x2F;&lt;code|&lt;pre|&lt;textarea&#x2F;; ltitle   = \&quot;\#{id}-title\&quot;; \n; ldebug   = \&quot;\#{id}-debug\&quot;; \n; lheader  = \&quot;\#{id}-header\&quot;; \n; lcontent = \&quot;\#{id}-content\&quot;; \n; vctl     = \&quot;\#{id}-vctl\&quot;; \n; \n; content_for :css do; \n; @_out_buf &lt;&lt; (\&quot;&lt;style&gt;\\n  .chord {\\n    color:            #aa5;\\n    vertical-align:   12px;\\n    font-family:      monospace;\\n    font-weight:      800;\\n    padding:          2px;\\n    border-left:      1px solid #888;\\n    border-bottom:    1px solid #888;\\n    font-size:        80%;\\n    background-color: #ffc;\\n  }\\n  #\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((ltitle), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; {\\n    font-size: 80%;\\n  }\\n  #\&quot;.freeze); \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((ldebug), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; {\\n    font-size: 50%;\\n  }\\n&lt;&#x2F;style&gt;\&quot;.freeze); \n; \n; \n; \n; end; @_out_buf &lt;&lt; (\&quot;\\n&lt;!--Lyric modal - hidden until brought up--&gt;\\n&lt;div class=\\\&quot;modal fade\\\&quot;\&quot;.freeze); \n; _slim_codeattributes1 = id; if _slim_codeattributes1; if _slim_codeattributes1 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes1))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; _slim_codeattributes2 = -1; if _slim_codeattributes2; if _slim_codeattributes2 == true; @_out_buf &lt;&lt; (\&quot; tabindex=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; tabindex=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes2))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;\\n  &lt;div class=\\\&quot;modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl\\\&quot; style=\\\&quot;max-width:100%; max-height:100%\\\&quot;&gt;\\n    &lt;div class=\\\&quot;modal-content\\\&quot;&gt;\\n      &lt;div class=\\\&quot;modal-header\\\&quot;&gt;\\n        &lt;div class=\\\&quot;small\\\&quot;\&quot;.freeze); \n; \n; \n; \n; _slim_codeattributes3 = lheader; if _slim_codeattributes3; if _slim_codeattributes3 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes3))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;&lt;&#x2F;div&gt;\\n        &lt;div class=\\\&quot;small\\\&quot;\&quot;.freeze); \n; _slim_codeattributes4 = ldebug; if _slim_codeattributes4; if _slim_codeattributes4 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes4))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;&lt;&#x2F;div&gt;\\n        &lt;div\&quot;.freeze); \n; _slim_codeattributes5 = vctl; if _slim_codeattributes5; if _slim_codeattributes5 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes5))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;\\n          &lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;play_song()\\\&quot; title=\\\&quot;Play full video\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa-solid fa-headphones\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;&lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;play_intro()\\\&quot; title=\\\&quot;Play intro\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa-solid fa-undo\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;&lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;cancel_play()\\\&quot; title=\\\&quot;Stop plauing\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa-solid fa-stop\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;\\n        &lt;&#x2F;div&gt;\\n      &lt;&#x2F;div&gt;\\n      &lt;div class=\\\&quot;modal-body\\\&quot;&gt;\\n        &lt;div\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; _slim_codeattributes6 = lcontent; if _slim_codeattributes6; if _slim_codeattributes6 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes6))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;&lt;&#x2F;div&gt;\\n      &lt;&#x2F;div&gt;\\n      &lt;div class=\\\&quot;modal-footer\\\&quot;&gt;\\n        &lt;div\&quot;.freeze); \n; \n; _slim_codeattributes7 = ltitle; if _slim_codeattributes7; if _slim_codeattributes7 == true; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\\\&quot;\&quot;.freeze); else; @_out_buf &lt;&lt; (\&quot; id=\\\&quot;\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((_slim_codeattributes7))).to_s); @_out_buf &lt;&lt; (\&quot;\\\&quot;\&quot;.freeze); end; end; @_out_buf &lt;&lt; (\&quot;&gt;&lt;&#x2F;div&gt;\&quot;.freeze); \n; async = params[:static] ? &#x27;false&#x27; : &#x27;true&#x27;; \n; @_out_buf &lt;&lt; (\&quot;\\n        &lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;load_lyric(\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((async))).to_s); @_out_buf &lt;&lt; (\&quot;, -1)\\\&quot; title=\\\&quot;Previous Page\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa fa-backward\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;\&quot;.freeze); \n; \n; unless params[:static]; \n; @_out_buf &lt;&lt; (\&quot;&lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;load_lyric(\&quot;.freeze); @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((async))).to_s); @_out_buf &lt;&lt; (\&quot;, 0)\\\&quot; title=\\\&quot;Reload Page\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa-solid fa-undo\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;\&quot;.freeze); \n; \n; end; @_out_buf &lt;&lt; (\&quot;&lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;singer_toggle()\\\&quot; title=\\\&quot;Toogle chord\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa fa-music\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;&lt;button class=\\\&quot;btn btn-secondary\\\&quot; onClick=\\\&quot;load_lyric(\&quot;.freeze); \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((async))).to_s); @_out_buf &lt;&lt; (\&quot;, 1)\\\&quot; title=\\\&quot;Next Page\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa fa-forward\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;&lt;button class=\\\&quot;btn btn-warning\\\&quot; data-bs-dismiss=\\\&quot;modal\\\&quot; title=\\\&quot;Close\\\&quot; type=\\\&quot;button\\\&quot;&gt;&lt;i class=\\\&quot;fa fa-sign-out\\\&quot;&gt;&lt;&#x2F;i&gt;&lt;&#x2F;button&gt;\\n      &lt;&#x2F;div&gt;\\n    &lt;&#x2F;div&gt;\\n  &lt;&#x2F;div&gt;\\n&lt;&#x2F;div&gt;\\n&lt;script&gt;\\n  function singer_toggle() {\\n    $(&#x27;.chord&#x27;).toggle()\\n    $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((id), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot; .modal-header&#x27;).toggle()\\n  }\\n  \\n  function dblog(msg) {\\n    console.log(msg)\\n    &#x2F;&#x2F; var dbhandle = $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((ldebug), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;)\\n    &#x2F;&#x2F; dbhandle.html(dbhandle.html() + ` - ${msg}`)\\n  }\\n  \\n  function load_lyric(async = true, offset = 0) {\\n    var olist = current_order()\\n  \\n    var cur_ofs = olist.indexOf(myModal.item.toString())\\n    var new_ofs = cur_ofs + offset\\n  \\n    if ((new_ofs &lt; 0) || (new_ofs &gt;= olist.length)) {\\n      return\\n    }\\n    get_lyric(myModal.program, olist[new_ofs], async)\\n  }\\n  function play_intro() {\\n    var lvideo = $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vctl), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;)\\n    var video  = lvideo.attr(&#x27;my_video&#x27;)\\n    var stime  = parseInt(lvideo.attr(&#x27;my_vstart&#x27;))\\n    var etime  = parseInt(lvideo.attr(&#x27;my_vend&#x27;))\\n    var title  = lvideo.attr(&#x27;my_title&#x27;)\\n    play_on_youtube(video, title, stime, etime)\\n  }\\n  function play_song() {\\n    var lvideo = $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vctl), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;)\\n    var video = lvideo.attr(&#x27;my_video&#x27;)\\n    var title = lvideo.attr(&#x27;my_title&#x27;)\\n    play_on_youtube(video, title, 0, 0)\\n  }\\n  function get_lyric(program, item, async = true) {\\n    myModal.program = program\\n    myModal.item    = item\\n  \\n    dblog(`Getting item # ${myModal.item}`)\\n  \\n    if (async) {\\n      var url = `..&#x2F;lyric&#x2F;${program}&#x2F;${item}?type=\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((ltype), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;`\\n      jQuery.ajax({\\n        url:      url,\\n        async:    true,\\n        dataType: &#x27;json&#x27;,\\n        success:  show_lyric,\\n      });\\n    } else {\\n      var content  = extra[item]\\n      if (content != null) {\\n        show_lyric(content)\\n      }\\n    }\\n  }\\n  function show_lyric(content) {\\n    console.log(&#x27;content &#x27;, content)\\n    var lvideo = $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((vctl), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;)\\n  \\n    &#x2F;&#x2F; If vintro exist - create button for play&#x2F;stop intro\\n    lvideo.attr(&#x27;my_video&#x27;,  content[&#x27;video&#x27;])\\n    lvideo.attr(&#x27;my_title&#x27;,  content[&#x27;title&#x27;])\\n    lvideo.attr(&#x27;my_item&#x27;,   content[&#x27;item_no&#x27;])\\n  \\n    if (content[&#x27;vintro&#x27;] != null) {\\n      lvideo.attr(&#x27;my_vstart&#x27;, content[&#x27;vintro&#x27;][0])\\n      lvideo.attr(&#x27;my_vend&#x27;,   content[&#x27;vintro&#x27;][1])\\n    }\\n    lvideo.show()\\n  \\n    var lyric = content[&#x27;lyric&#x27;].replaceAll(&#x27;\\\\n&#x27;, &#x27;&lt;br&gt;&#x27;)\\n    $(&#x27;#\&quot;.freeze); \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((lcontent), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;).html(&#x27;&lt;center&gt;&lt;b&gt;&#x27; + lyric)\\n    $(&#x27;#\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((lheader), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;).html(`${content[&#x27;beat&#x27;]}: ${content[&#x27;tokey&#x27;]}.${content[&#x27;transpose&#x27;]}\\\#${content[&#x27;tempo&#x27;]} - Intro: ${content[&#x27;intro&#x27;]}`)\\n    $(&#x27;#\&quot;.freeze); \n; @_out_buf &lt;&lt; ((::Temple::Utils.escape_html((::Temple::Utils.indent_dynamic((ltitle), false, \&quot;\\n  \&quot;, _temple_html_pretty1)))).to_s); @_out_buf &lt;&lt; (\&quot;&#x27;).html(content[&#x27;title&#x27;].substring(0, 19))\\n    $(&#x27;.modal-header&#x27;).show()\\n    myModal.show()\\n  }\\n&lt;&#x2F;script&gt;\&quot;.freeze); \n; \n; \n; \n; @_out_buf; ensure; @_out_buf = _temple_generators_stringbuffer1; end&quot;&gt;}&gt;, @pinned_response=false, @env={&quot;rack.version&quot;=&gt;[1, 6], &quot;rack.errors&quot;=&gt;#&lt;Object:0x00007f37b6b59010&gt;, &quot;rack.multithread&quot;=&gt;true, &quot;rack.multiprocess&quot;=&gt;false, &quot;rack.run_once&quot;=&gt;false, &quot;rack.url_scheme&quot;=&gt;&quot;http&quot;, &quot;SCRIPT_NAME&quot;=&gt;&quot;&#x2F;playlist&quot;, &quot;QUERY_STRING&quot;=&gt;&quot;static=1&amp;iPad=1&quot;, &quot;SERVER_SOFTWARE&quot;=&gt;&quot;puma 6.4.2 The Eagle of Durango&quot;, &quot;GATEWAY_INTERFACE&quot;=&gt;&quot;CGI&#x2F;1.2&quot;, &quot;REQUEST_METHOD&quot;=&gt;&quot;GET&quot;, &quot;REQUEST_PATH&quot;=&gt;&quot;&#x2F;playlist&#x2F;singer&#x2F;thien&quot;, &quot;REQUEST_URI&quot;=&gt;&quot;&#x2F;playlist&#x2F;singer&#x2F;thien?static=1&amp;iPad=1&quot;, &quot;SERVER_PROTOCOL&quot;=&gt;&quot;HTTP&#x2F;1.1&quot;, &quot;HTTP_HOST&quot;=&gt;&quot;localhost:4570&quot;, &quot;HTTP_USER_AGENT&quot;=&gt;&quot;Go-http-client&#x2F;1.1&quot;, &quot;HTTP_ACCEPT_ENCODING&quot;=&gt;&quot;gzip&quot;, &quot;puma.request_body_wait&quot;=&gt;0.006211996078491211, &quot;SERVER_NAME&quot;=&gt;&quot;localhost&quot;, &quot;SERVER_PORT&quot;=&gt;&quot;4570&quot;, &quot;PATH_INFO&quot;=&gt;&quot;&#x2F;singer&#x2F;thien&quot;, &quot;REMOTE_ADDR&quot;=&gt;&quot;127.0.0.1&quot;, &quot;HTTP_VERSION&quot;=&gt;&quot;HTTP&#x2F;1.1&quot;, &quot;puma.socket&quot;=&gt;#&lt;TCPSocket:fd 13, AF_INET, 127.0.0.1, 4570&gt;, &quot;rack.hijack?&quot;=&gt;true, &quot;rack.hijack&quot;=&gt;#&lt;Proc:0x00007f37b4b8fd38 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;lint.rb:553&gt;, &quot;rack.input&quot;=&gt;#&lt;Rack::Lint::InputWrapper:0x00007f37b4b8fc98 @input=#&lt;Puma::NullIO:0x00007f37b51c2ac0&gt;&gt;, &quot;rack.after_reply&quot;=&gt;[], &quot;puma.config&quot;=&gt;#&lt;Puma::Configuration:0x00007f37b4bbc9a0 @options=#&lt;Puma::UserFileDefaultOptions:0x00007f37b53329a0 @user_options={:environment=&gt;&quot;development&quot;, :pid=&gt;nil, :Port=&gt;&quot;4570&quot;, :Host=&gt;&quot;0.0.0.0&quot;, :AccessLog=&gt;[], :config=&gt;&quot;&#x2F;app&#x2F;config.ru&quot;, :quiet=&gt;true, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:4570&quot;], :app=&gt;#&lt;Rack::ContentLength:0x00007f37b52d9620 @app=#&lt;Rack::ShowExceptions:0x00007f37b53105a8 @app=#&lt;Rack::Lint:0x00007f37b5310670 @app=#&lt;Rack::TempfileReaper:0x00007f37b5310738 @app=#&lt;Rack::URLMap:0x00007f37b5b215d0 @known_hosts=#&lt;Set: {}&gt;, @mapping=[[nil, &quot;&#x2F;playlist&quot;, &#x2F;^\&#x2F;+playlist(.*)&#x2F;n, #&lt;PlaylistPortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;images&quot;, &#x2F;^\&#x2F;+images(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d09c0 &#x2F;app&#x2F;config.ru:12 (lambda)&gt;], [nil, &quot;&#x2F;smule&quot;, &#x2F;^\&#x2F;+smule(.*)&#x2F;n, #&lt;SmulePortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;js&quot;, &#x2F;^\&#x2F;+js(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d1028 &#x2F;app&#x2F;config.ru:9 (lambda)&gt;]]&gt;&gt;, @content_length=nil&gt;&gt;&gt;, :log_writer=&gt;#&lt;Puma::LogWriter:0x00007f37b4bbc950 @formatter=#&lt;Puma::LogWriter::DefaultFormatter:0x00007f37b5331848&gt;, @custom_logger=nil, @stdout=#&lt;IO:&lt;STDOUT&gt;&gt;, @stderr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false, @error_logger=#&lt;Puma::ErrorLogger:0x00007f37b5331820 @ioerr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false&gt;&gt;}, @file_options={}, @default_options={:auto_trim_time=&gt;30, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:9292&quot;], :clean_thread_locals=&gt;false, :debug=&gt;false, :early_hints=&gt;nil, :environment=&gt;&quot;development&quot;, :first_data_timeout=&gt;30, :idle_timeout=&gt;nil, :io_selector_backend=&gt;:auto, :log_requests=&gt;false, :logger=&gt;#&lt;IO:&lt;STDOUT&gt;&gt;, :max_fast_inline=&gt;10, :max_threads=&gt;5, :min_threads=&gt;0, :mode=&gt;:http, :mutate_stdout_and_stderr_to_sync_on_write=&gt;true, :out_of_band=&gt;[], :persistent_timeout=&gt;20, :queue_requests=&gt;true, :rackup=&gt;&quot;config.ru&quot;, :raise_exception_on_sigterm=&gt;true, :reaping_time=&gt;1, :remote_address=&gt;:socket, :silence_single_worker_warning=&gt;false, :silence_fork_callback_warning=&gt;false, :tag=&gt;&quot;app&quot;, :tcp_host=&gt;&quot;0.0.0.0&quot;, :tcp_port=&gt;9292, :wait_for_less_busy_worker=&gt;0.005, :worker_boot_timeout=&gt;60, :worker_check_interval=&gt;5, :worker_culling_strategy=&gt;:youngest, :worker_shutdown_timeout=&gt;30, :worker_timeout=&gt;60, :workers=&gt;0, :http_content_length_limit=&gt;nil, :Verbose=&gt;false, :Silent=&gt;false, :events=&gt;#&lt;Puma::Events:0x00007f37b5332e28 @hooks={:state=&gt;[], :on_booted=&gt;[]}&gt;, :preload_app=&gt;false}&gt;, @plugins=#&lt;Puma::PluginLoader:0x00007f37b53328d8 @instances=[]&gt;, @user_dsl=#&lt;Puma::DSL:0x00007f37b53327e8 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={:environment=&gt;&quot;development&quot;, :pid=&gt;nil, :Port=&gt;&quot;4570&quot;, :Host=&gt;&quot;0.0.0.0&quot;, :AccessLog=&gt;[], :config=&gt;&quot;&#x2F;app&#x2F;config.ru&quot;, :quiet=&gt;true, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:4570&quot;], :app=&gt;#&lt;Rack::ContentLength:0x00007f37b52d9620 @app=#&lt;Rack::ShowExceptions:0x00007f37b53105a8 @app=#&lt;Rack::Lint:0x00007f37b5310670 @app=#&lt;Rack::TempfileReaper:0x00007f37b5310738 @app=#&lt;Rack::URLMap:0x00007f37b5b215d0 @known_hosts=#&lt;Set: {}&gt;, @mapping=[[nil, &quot;&#x2F;playlist&quot;, &#x2F;^\&#x2F;+playlist(.*)&#x2F;n, #&lt;PlaylistPortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;images&quot;, &#x2F;^\&#x2F;+images(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d09c0 &#x2F;app&#x2F;config.ru:12 (lambda)&gt;], [nil, &quot;&#x2F;smule&quot;, &#x2F;^\&#x2F;+smule(.*)&#x2F;n, #&lt;SmulePortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;js&quot;, &#x2F;^\&#x2F;+js(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d1028 &#x2F;app&#x2F;config.ru:9 (lambda)&gt;]]&gt;&gt;, @content_length=nil&gt;&gt;&gt;, :log_writer=&gt;#&lt;Puma::LogWriter:0x00007f37b4bbc950 @formatter=#&lt;Puma::LogWriter::DefaultFormatter:0x00007f37b5331848&gt;, @custom_logger=nil, @stdout=#&lt;IO:&lt;STDOUT&gt;&gt;, @stderr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false, @error_logger=#&lt;Puma::ErrorLogger:0x00007f37b5331820 @ioerr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false&gt;&gt;}, @plugins=[]&gt;, @file_dsl=#&lt;Puma::DSL:0x00007f37b5332720 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={}, @plugins=[]&gt;, @default_dsl=#&lt;Puma::DSL:0x00007f37b5332680 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={:auto_trim_time=&gt;30, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:9292&quot;], :clean_thread_locals=&gt;false, :debug=&gt;false, :early_hints=&gt;nil, :environment=&gt;&quot;development&quot;, :first_data_timeout=&gt;30, :idle_timeout=&gt;nil, :io_selector_backend=&gt;:auto, :log_requests=&gt;false, :logger=&gt;#&lt;IO:&lt;STDOUT&gt;&gt;, :max_fast_inline=&gt;10, :max_threads=&gt;5, :min_threads=&gt;0, :mode=&gt;:http, :mutate_stdout_and_stderr_to_sync_on_write=&gt;true, :out_of_band=&gt;[], :persistent_timeout=&gt;20, :queue_requests=&gt;true, :rackup=&gt;&quot;config.ru&quot;, :raise_exception_on_sigterm=&gt;true, :reaping_time=&gt;1, :remote_address=&gt;:socket, :silence_single_worker_warning=&gt;false, :silence_fork_callback_warning=&gt;false, :tag=&gt;&quot;app&quot;, :tcp_host=&gt;&quot;0.0.0.0&quot;, :tcp_port=&gt;9292, :wait_for_less_busy_worker=&gt;0.005, :worker_boot_timeout=&gt;60, :worker_check_interval=&gt;5, :worker_culling_strategy=&gt;:youngest, :worker_shutdown_timeout=&gt;30, :worker_timeout=&gt;60, :workers=&gt;0, :http_content_length_limit=&gt;nil, :Verbose=&gt;false, :Silent=&gt;false, :events=&gt;#&lt;Puma::Events:0x00007f37b5332e28 @hooks={:state=&gt;[], :on_booted=&gt;[]}&gt;, :preload_app=&gt;false}, @plugins=[]&gt;&gt;, &quot;rack.tempfiles&quot;=&gt;[], &quot;sinatra.commonlogger&quot;=&gt;true, &quot;rack.logger&quot;=&gt;#&lt;Logger:0x00007f37b5902628 @level=1, @progname=nil, @default_formatter=#&lt;Logger::Formatter:0x00007f37b4b8fb30 @datetime_format=nil&gt;, @formatter=nil, @logdev=#&lt;Logger::LogDevice:0x00007f37b5001600 @shift_period_suffix=nil, @shift_size=nil, @shift_age=nil, @filename=nil, @dev=#&lt;Rack::Lint::ErrorWrapper:0x00007f37b4b8fc70 @error=#&lt;IO:&lt;STDERR&gt;&gt;&gt;, @binmode=false, @mon_data=#&lt;Monitor:0x00007f37b4b8fae0&gt;, @mon_data_owner_object_id=18000&gt;&gt;, &quot;rack.session&quot;=&gt;{&quot;session_id&quot;=&gt;&quot;60b74e15fca8c3792a7679bd7f877f68e64be7263502697594bfbf75e29d0aab&quot;, &quot;csrf&quot;=&gt;&quot;K7SMyJrG_R5TwdId-MRmbYhnrrh5tDZvHRSBPEClbYA=&quot;, &quot;tracking&quot;=&gt;{&quot;HTTP_USER_AGENT&quot;=&gt;&quot;go-http-client&#x2F;1.1&quot;}}, &quot;rack.session.options&quot;=&gt;{:path=&gt;&quot;&#x2F;&quot;, :domain=&gt;nil, :expire_after=&gt;nil, :secure=&gt;false, :httponly=&gt;true, :defer=&gt;false, :renew=&gt;false, :sidbits=&gt;128, :secure_random=&gt;SecureRandom, :secret=&gt;&quot;3497f17e60d812214822aaa69830915a7adc20136c728baa59803aaacb18d243d19434db5f77bcdddb196b400b71f10be8b76ed1ee80205ad01c48d304566336&quot;, :coder=&gt;#&lt;Rack::Protection::EncryptedCookie::Marshal:0x00007f37b5b2d768&gt;}, &quot;rack.request.cookie_hash&quot;=&gt;{}, &quot;rack.session.unpacked_cookie_data&quot;=&gt;{&quot;session_id&quot;=&gt;&quot;60b74e15fca8c3792a7679bd7f877f68e64be7263502697594bfbf75e29d0aab&quot;}, &quot;rack.request.query_string&quot;=&gt;&quot;static=1&amp;iPad=1&quot;, &quot;rack.request.query_hash&quot;=&gt;{&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;}, &quot;sinatra.route&quot;=&gt;&quot;GET &#x2F;singer&#x2F;:singer&quot;, &quot;sinatra.error.params&quot;=&gt;{&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;, &quot;singer&quot;=&gt;&quot;thien&quot;}, &quot;sinatra.error&quot;=&gt;#&lt;NameError: undefined local variable or method `qrcode&#x27; for #&lt;PlaylistPortal:0x00007f37b5001380 ...&gt;&gt;, &quot;sinatra.accept&quot;=&gt;[#&lt;Sinatra::Request::AcceptEntry:0x00007f37b69e9d38 @entry=&quot;*&#x2F;*&quot;, @type=&quot;*&#x2F;*&quot;, @params={}, @q=1.0&gt;]}, @params={&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;, &quot;singer&quot;=&gt;&quot;thien&quot;}, @request=#&lt;Sinatra::Request:0x00007f37b4b8f310 @params={&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;}, @env={&quot;rack.version&quot;=&gt;[1, 6], &quot;rack.errors&quot;=&gt;#&lt;Object:0x00007f37b6b59010&gt;, &quot;rack.multithread&quot;=&gt;true, &quot;rack.multiprocess&quot;=&gt;false, &quot;rack.run_once&quot;=&gt;false, &quot;rack.url_scheme&quot;=&gt;&quot;http&quot;, &quot;SCRIPT_NAME&quot;=&gt;&quot;&#x2F;playlist&quot;, &quot;QUERY_STRING&quot;=&gt;&quot;static=1&amp;iPad=1&quot;, &quot;SERVER_SOFTWARE&quot;=&gt;&quot;puma 6.4.2 The Eagle of Durango&quot;, &quot;GATEWAY_INTERFACE&quot;=&gt;&quot;CGI&#x2F;1.2&quot;, &quot;REQUEST_METHOD&quot;=&gt;&quot;GET&quot;, &quot;REQUEST_PATH&quot;=&gt;&quot;&#x2F;playlist&#x2F;singer&#x2F;thien&quot;, &quot;REQUEST_URI&quot;=&gt;&quot;&#x2F;playlist&#x2F;singer&#x2F;thien?static=1&amp;iPad=1&quot;, &quot;SERVER_PROTOCOL&quot;=&gt;&quot;HTTP&#x2F;1.1&quot;, &quot;HTTP_HOST&quot;=&gt;&quot;localhost:4570&quot;, &quot;HTTP_USER_AGENT&quot;=&gt;&quot;Go-http-client&#x2F;1.1&quot;, &quot;HTTP_ACCEPT_ENCODING&quot;=&gt;&quot;gzip&quot;, &quot;puma.request_body_wait&quot;=&gt;0.006211996078491211, &quot;SERVER_NAME&quot;=&gt;&quot;localhost&quot;, &quot;SERVER_PORT&quot;=&gt;&quot;4570&quot;, &quot;PATH_INFO&quot;=&gt;&quot;&#x2F;singer&#x2F;thien&quot;, &quot;REMOTE_ADDR&quot;=&gt;&quot;127.0.0.1&quot;, &quot;HTTP_VERSION&quot;=&gt;&quot;HTTP&#x2F;1.1&quot;, &quot;puma.socket&quot;=&gt;#&lt;TCPSocket:fd 13, AF_INET, 127.0.0.1, 4570&gt;, &quot;rack.hijack?&quot;=&gt;true, &quot;rack.hijack&quot;=&gt;#&lt;Proc:0x00007f37b4b8fd38 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;lint.rb:553&gt;, &quot;rack.input&quot;=&gt;#&lt;Rack::Lint::InputWrapper:0x00007f37b4b8fc98 @input=#&lt;Puma::NullIO:0x00007f37b51c2ac0&gt;&gt;, &quot;rack.after_reply&quot;=&gt;[], &quot;puma.config&quot;=&gt;#&lt;Puma::Configuration:0x00007f37b4bbc9a0 @options=#&lt;Puma::UserFileDefaultOptions:0x00007f37b53329a0 @user_options={:environment=&gt;&quot;development&quot;, :pid=&gt;nil, :Port=&gt;&quot;4570&quot;, :Host=&gt;&quot;0.0.0.0&quot;, :AccessLog=&gt;[], :config=&gt;&quot;&#x2F;app&#x2F;config.ru&quot;, :quiet=&gt;true, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:4570&quot;], :app=&gt;#&lt;Rack::ContentLength:0x00007f37b52d9620 @app=#&lt;Rack::ShowExceptions:0x00007f37b53105a8 @app=#&lt;Rack::Lint:0x00007f37b5310670 @app=#&lt;Rack::TempfileReaper:0x00007f37b5310738 @app=#&lt;Rack::URLMap:0x00007f37b5b215d0 @known_hosts=#&lt;Set: {}&gt;, @mapping=[[nil, &quot;&#x2F;playlist&quot;, &#x2F;^\&#x2F;+playlist(.*)&#x2F;n, #&lt;PlaylistPortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;images&quot;, &#x2F;^\&#x2F;+images(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d09c0 &#x2F;app&#x2F;config.ru:12 (lambda)&gt;], [nil, &quot;&#x2F;smule&quot;, &#x2F;^\&#x2F;+smule(.*)&#x2F;n, #&lt;SmulePortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;js&quot;, &#x2F;^\&#x2F;+js(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d1028 &#x2F;app&#x2F;config.ru:9 (lambda)&gt;]]&gt;&gt;, @content_length=nil&gt;&gt;&gt;, :log_writer=&gt;#&lt;Puma::LogWriter:0x00007f37b4bbc950 @formatter=#&lt;Puma::LogWriter::DefaultFormatter:0x00007f37b5331848&gt;, @custom_logger=nil, @stdout=#&lt;IO:&lt;STDOUT&gt;&gt;, @stderr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false, @error_logger=#&lt;Puma::ErrorLogger:0x00007f37b5331820 @ioerr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false&gt;&gt;}, @file_options={}, @default_options={:auto_trim_time=&gt;30, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:9292&quot;], :clean_thread_locals=&gt;false, :debug=&gt;false, :early_hints=&gt;nil, :environment=&gt;&quot;development&quot;, :first_data_timeout=&gt;30, :idle_timeout=&gt;nil, :io_selector_backend=&gt;:auto, :log_requests=&gt;false, :logger=&gt;#&lt;IO:&lt;STDOUT&gt;&gt;, :max_fast_inline=&gt;10, :max_threads=&gt;5, :min_threads=&gt;0, :mode=&gt;:http, :mutate_stdout_and_stderr_to_sync_on_write=&gt;true, :out_of_band=&gt;[], :persistent_timeout=&gt;20, :queue_requests=&gt;true, :rackup=&gt;&quot;config.ru&quot;, :raise_exception_on_sigterm=&gt;true, :reaping_time=&gt;1, :remote_address=&gt;:socket, :silence_single_worker_warning=&gt;false, :silence_fork_callback_warning=&gt;false, :tag=&gt;&quot;app&quot;, :tcp_host=&gt;&quot;0.0.0.0&quot;, :tcp_port=&gt;9292, :wait_for_less_busy_worker=&gt;0.005, :worker_boot_timeout=&gt;60, :worker_check_interval=&gt;5, :worker_culling_strategy=&gt;:youngest, :worker_shutdown_timeout=&gt;30, :worker_timeout=&gt;60, :workers=&gt;0, :http_content_length_limit=&gt;nil, :Verbose=&gt;false, :Silent=&gt;false, :events=&gt;#&lt;Puma::Events:0x00007f37b5332e28 @hooks={:state=&gt;[], :on_booted=&gt;[]}&gt;, :preload_app=&gt;false}&gt;, @plugins=#&lt;Puma::PluginLoader:0x00007f37b53328d8 @instances=[]&gt;, @user_dsl=#&lt;Puma::DSL:0x00007f37b53327e8 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={:environment=&gt;&quot;development&quot;, :pid=&gt;nil, :Port=&gt;&quot;4570&quot;, :Host=&gt;&quot;0.0.0.0&quot;, :AccessLog=&gt;[], :config=&gt;&quot;&#x2F;app&#x2F;config.ru&quot;, :quiet=&gt;true, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:4570&quot;], :app=&gt;#&lt;Rack::ContentLength:0x00007f37b52d9620 @app=#&lt;Rack::ShowExceptions:0x00007f37b53105a8 @app=#&lt;Rack::Lint:0x00007f37b5310670 @app=#&lt;Rack::TempfileReaper:0x00007f37b5310738 @app=#&lt;Rack::URLMap:0x00007f37b5b215d0 @known_hosts=#&lt;Set: {}&gt;, @mapping=[[nil, &quot;&#x2F;playlist&quot;, &#x2F;^\&#x2F;+playlist(.*)&#x2F;n, #&lt;PlaylistPortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;images&quot;, &#x2F;^\&#x2F;+images(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d09c0 &#x2F;app&#x2F;config.ru:12 (lambda)&gt;], [nil, &quot;&#x2F;smule&quot;, &#x2F;^\&#x2F;+smule(.*)&#x2F;n, #&lt;SmulePortal app_file=&quot;&#x2F;app&#x2F;controllers&#x2F;my_portal.rb&quot;&gt;], [nil, &quot;&#x2F;js&quot;, &#x2F;^\&#x2F;+js(.*)&#x2F;n, #&lt;Proc:0x00007f37b71d1028 &#x2F;app&#x2F;config.ru:9 (lambda)&gt;]]&gt;&gt;, @content_length=nil&gt;&gt;&gt;, :log_writer=&gt;#&lt;Puma::LogWriter:0x00007f37b4bbc950 @formatter=#&lt;Puma::LogWriter::DefaultFormatter:0x00007f37b5331848&gt;, @custom_logger=nil, @stdout=#&lt;IO:&lt;STDOUT&gt;&gt;, @stderr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false, @error_logger=#&lt;Puma::ErrorLogger:0x00007f37b5331820 @ioerr=#&lt;IO:&lt;STDERR&gt;&gt;, @debug=false&gt;&gt;}, @plugins=[]&gt;, @file_dsl=#&lt;Puma::DSL:0x00007f37b5332720 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={}, @plugins=[]&gt;, @default_dsl=#&lt;Puma::DSL:0x00007f37b5332680 @config=#&lt;Puma::Configuration:0x00007f37b4bbc9a0 ...&gt;, @options={:auto_trim_time=&gt;30, :binds=&gt;[&quot;tcp:&#x2F;&#x2F;0.0.0.0:9292&quot;], :clean_thread_locals=&gt;false, :debug=&gt;false, :early_hints=&gt;nil, :environment=&gt;&quot;development&quot;, :first_data_timeout=&gt;30, :idle_timeout=&gt;nil, :io_selector_backend=&gt;:auto, :log_requests=&gt;false, :logger=&gt;#&lt;IO:&lt;STDOUT&gt;&gt;, :max_fast_inline=&gt;10, :max_threads=&gt;5, :min_threads=&gt;0, :mode=&gt;:http, :mutate_stdout_and_stderr_to_sync_on_write=&gt;true, :out_of_band=&gt;[], :persistent_timeout=&gt;20, :queue_requests=&gt;true, :rackup=&gt;&quot;config.ru&quot;, :raise_exception_on_sigterm=&gt;true, :reaping_time=&gt;1, :remote_address=&gt;:socket, :silence_single_worker_warning=&gt;false, :silence_fork_callback_warning=&gt;false, :tag=&gt;&quot;app&quot;, :tcp_host=&gt;&quot;0.0.0.0&quot;, :tcp_port=&gt;9292, :wait_for_less_busy_worker=&gt;0.005, :worker_boot_timeout=&gt;60, :worker_check_interval=&gt;5, :worker_culling_strategy=&gt;:youngest, :worker_shutdown_timeout=&gt;30, :worker_timeout=&gt;60, :workers=&gt;0, :http_content_length_limit=&gt;nil, :Verbose=&gt;false, :Silent=&gt;false, :events=&gt;#&lt;Puma::Events:0x00007f37b5332e28 @hooks={:state=&gt;[], :on_booted=&gt;[]}&gt;, :preload_app=&gt;false}, @plugins=[]&gt;&gt;, &quot;rack.tempfiles&quot;=&gt;[], &quot;sinatra.commonlogger&quot;=&gt;true, &quot;rack.logger&quot;=&gt;#&lt;Logger:0x00007f37b5902628 @level=1, @progname=nil, @default_formatter=#&lt;Logger::Formatter:0x00007f37b4b8fb30 @datetime_format=nil&gt;, @formatter=nil, @logdev=#&lt;Logger::LogDevice:0x00007f37b5001600 @shift_period_suffix=nil, @shift_size=nil, @shift_age=nil, @filename=nil, @dev=#&lt;Rack::Lint::ErrorWrapper:0x00007f37b4b8fc70 @error=#&lt;IO:&lt;STDERR&gt;&gt;&gt;, @binmode=false, @mon_data=#&lt;Monitor:0x00007f37b4b8fae0&gt;, @mon_data_owner_object_id=18000&gt;&gt;, &quot;rack.session&quot;=&gt;{&quot;session_id&quot;=&gt;&quot;60b74e15fca8c3792a7679bd7f877f68e64be7263502697594bfbf75e29d0aab&quot;, &quot;csrf&quot;=&gt;&quot;K7SMyJrG_R5TwdId-MRmbYhnrrh5tDZvHRSBPEClbYA=&quot;, &quot;tracking&quot;=&gt;{&quot;HTTP_USER_AGENT&quot;=&gt;&quot;go-http-client&#x2F;1.1&quot;}}, &quot;rack.session.options&quot;=&gt;{:path=&gt;&quot;&#x2F;&quot;, :domain=&gt;nil, :expire_after=&gt;nil, :secure=&gt;false, :httponly=&gt;true, :defer=&gt;false, :renew=&gt;false, :sidbits=&gt;128, :secure_random=&gt;SecureRandom, :secret=&gt;&quot;3497f17e60d812214822aaa69830915a7adc20136c728baa59803aaacb18d243d19434db5f77bcdddb196b400b71f10be8b76ed1ee80205ad01c48d304566336&quot;, :coder=&gt;#&lt;Rack::Protection::EncryptedCookie::Marshal:0x00007f37b5b2d768&gt;}, &quot;rack.request.cookie_hash&quot;=&gt;{}, &quot;rack.session.unpacked_cookie_data&quot;=&gt;{&quot;session_id&quot;=&gt;&quot;60b74e15fca8c3792a7679bd7f877f68e64be7263502697594bfbf75e29d0aab&quot;}, &quot;rack.request.query_string&quot;=&gt;&quot;static=1&amp;iPad=1&quot;, &quot;rack.request.query_hash&quot;=&gt;{&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;}, &quot;sinatra.route&quot;=&gt;&quot;GET &#x2F;singer&#x2F;:singer&quot;, &quot;sinatra.error.params&quot;=&gt;{&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;, &quot;singer&quot;=&gt;&quot;thien&quot;}, &quot;sinatra.error&quot;=&gt;#&lt;NameError: undefined local variable or method `qrcode&#x27; for #&lt;PlaylistPortal:0x00007f37b5001380 ...&gt;&gt;, &quot;sinatra.accept&quot;=&gt;[#&lt;Sinatra::Request::AcceptEntry:0x00007f37b69e9d38 @entry=&quot;*&#x2F;*&quot;, @type=&quot;*&#x2F;*&quot;, @params={}, @q=1.0&gt;]}&gt;, @response=#&lt;Sinatra::Response:0x00007f37b59023a8 @status=500, @headers={&quot;Access-Control-Allow-Origin&quot;=&gt;&quot;*&quot;}, @writer=#&lt;Method: Sinatra::Response(Rack::Response::Helpers)#append(chunk) &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;rack-2.2.9&#x2F;lib&#x2F;rack&#x2F;response.rb:287&gt;, @block=nil, @body=[], @buffered=true, @length=0&gt;, @isIPhone=nil, @isIPad=&quot;1&quot;, @_out_buf=nil, @content_blocks={:css=&gt;[#&lt;Proc:0x00007f37b38c3e20 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-contrib-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;capture.rb:108&gt;, #&lt;Proc:0x00007f37b5eb4d28 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-contrib-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;capture.rb:108&gt;, #&lt;Proc:0x00007f37b37d8718 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-contrib-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;capture.rb:108&gt;], :javascript=&gt;[#&lt;Proc:0x00007f37b5f4d370 &#x2F;usr&#x2F;lib&#x2F;ruby&#x2F;gems&#x2F;3.2.0&#x2F;gems&#x2F;sinatra-contrib-3.2.0&#x2F;lib&#x2F;sinatra&#x2F;capture.rb:108&gt;]}&gt;&gt;</div></td>
         </tr>
         
         <tr>
           <td>sinatra.error.params</td>
           <td class="code"><div>{&quot;static&quot;=&gt;&quot;1&quot;, &quot;iPad&quot;=&gt;&quot;1&quot;, &quot;singer&quot;=&gt;&quot;thien&quot;}</div></td>
         </tr>
         
         <tr>
           <td>sinatra.route</td>
           <td class="code"><div>GET &#x2F;singer&#x2F;:singer</div></td>
         </tr>
         
      </table>
      <div class="clear"></div>
    </div> <!-- /RACK ENV -->

    <p id="explanation">You're seeing this error because you have
enabled the <code>show_exceptions</code> setting.</p>
  </div> <!-- /WRAP -->
  </body>
</html>
